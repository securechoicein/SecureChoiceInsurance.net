<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colorado Relief Options ‚Äî Home &amp; Auto Insurance</title>
  <meta name="description" content="Colorado residents: explore flexible home &amp; auto insurance options designed to protect your budget and peace of mind. Bundle, save, and see if you qualify for custom rate relief or flexible payments." />

  <!-- ================= QUICK SETUP =================
  REQUIRED FILES IN SAME FOLDER:
  - index.html
  - hero-securechoice-wildfire-hail-phone.png
  ================================================== -->

  <script>
    // === REQUIRED: paste your deployed Google Apps Script Web App URL here ===
    window.GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyWoyQwiNZGLj7Bh-8Hap2rceF-3XWTP5mqpkjRpN5MwWmKLY1eQcDSmrw_IjS5avJ_XA/exec"; // e.g. https://script.google.com/macros/s/XXXX/exec

    // Optional separate LLM endpoint (usually leave blank to reuse GAS)
    window.POLICYPRO_LLM_ENDPOINT = "";

    // ‚úÖ Default: run PolicyPro in LOCAL mode (no API keys required)
    // To use a secure server later, set: window.POLICYPRO_MODE = "remote" and window.POLICYPRO_LLM_ENDPOINT = "https://..."
    window.POLICYPRO_MODE = "local";

    // Tracking (optional)
    window.GA4_MEASUREMENT_ID = "";
    window.GOOGLE_ADS_ID = "";
    window.GOOGLE_ADS_CONVERSION_LABEL = "";
    window.META_PIXEL_ID = "";

    window.AGENT_EMAIL = "securechoicein@gmail.com";

    // === ClickFunnels (recommended for "Check My Options") ===
    // Paste your ClickFunnels page URL here. If set, the CTA will open ClickFunnels instead of the on-page modal.
    window.CLICKFUNNEL_URL = ""; // e.g. https://yourfunnel.clickfunnels.com/step1
  </script>

  <!-- Preload hero image to reduce flashes / failed paints -->
<!-- NOTE: If your file accidentally became .jpg.png (common on Windows), the JS below will auto-detect it. -->
<link rel="preload" as="image" href="hero-securechoice-wildfire-hail-phone.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{--card:#0f172a;--line:rgba(148,196,255,.35);--brand:#38bdf8;--brand2:#0ea5e9;--ok:#22c55e;--warn:#facc15;--hero-image:url('hero-securechoice-wildfire-hail-phone.png');}

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:#0b1323;
      color:#e5e7eb;
    }

    /* HERO */
    .hero{
      position:relative;
      min-height:90vh;
      display:flex;
      align-items:center;
      padding:48px;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(rgba(5,10,25,.75),rgba(5,10,25,.75)),var(--hero-image) center/cover no-repeat;
    }
    .hero-content{position:relative;max-width:680px;z-index:2}
    .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:rgba(56,189,248,.15);border:1px solid rgba(56,189,248,.4);font-size:12px;font-weight:700;color:#c7e9ff}
    h1{font-size:clamp(32px,5vw,52px);margin:18px 0;line-height:1.1}
    p{font-size:18px;color:#cbd5e1;max-width:56ch}
    .cta{margin-top:24px;padding:14px 28px;font-size:16px;font-weight:800;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(180deg,#38bdf8,#0ea5e9);color:#020617}

    /* Alert */
    .alert-box{position:absolute;right:10%;bottom:35%;width:240px;background:rgba(15,23,42,.95);border-radius:14px;padding:14px;border:1px solid rgba(148,196,255,.6);box-shadow:0 20px 50px rgba(0,0,0,.6);z-index:3}
    .alert-title{font-size:11px;text-transform:uppercase;letter-spacing:.14em;color:#facc15;margin-bottom:6px}
    .alert-text{font-size:13px;color:#e5e7eb;line-height:1.35}

    /* Chat launcher ‚Äî make it the visual highlight */
    .chat-launcher{
      position:absolute;
      right:10%;
      bottom:22%; /* sits just beneath the Wildfires & Hail Damage alert */
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(148,196,255,.55);
      padding:16px 18px;
      border-radius:999px;
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      z-index:4;
      box-shadow:0 28px 90px rgba(0,0,0,.78);
      backdrop-filter:blur(10px);
      transition:transform .18s ease, filter .18s ease, box-shadow .18s ease;
      isolation:isolate;
      user-select:none;
    }
    .chat-launcher::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:999px;
      background:radial-gradient(120px 60px at 20% 10%, rgba(56,189,248,.55), transparent 60%),
                 radial-gradient(120px 60px at 85% 80%, rgba(34,197,94,.35), transparent 60%),
                 linear-gradient(90deg, rgba(56,189,248,.45), rgba(34,197,94,.28));
      filter:blur(10px);
      opacity:.75;
      z-index:-1;
      animation:ppGlow 2.6s ease-in-out infinite;
    }
    .chat-launcher::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:999px;
      border:1px solid rgba(56,189,248,.45);
      pointer-events:none;
      opacity:.55;
    }
    .chat-launcher:hover{
      transform:translateY(-2px) scale(1.035);
      filter:brightness(1.06);
      box-shadow:0 34px 120px rgba(0,0,0,.82);
    }
    .chat-launcher:active{
      transform:translateY(0) scale(0.99);
    }

    .chat-avatar{
      width:44px;
      height:44px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      color:#020617;
      letter-spacing:.02em;
      position:relative;
      background:radial-gradient(circle at 30% 20%, rgba(255,255,255,.8), rgba(255,255,255,0) 45%),
                 linear-gradient(180deg,#22c55e,#0ea5e9);
      box-shadow:0 18px 44px rgba(0,0,0,.35);
    }
    /* Holographic ring */
    .chat-avatar::before{
      content:"";
      position:absolute;
      inset:-6px;
      border-radius:999px;
      background:conic-gradient(from 180deg, rgba(56,189,248,.0), rgba(56,189,248,.85), rgba(34,197,94,.65), rgba(56,189,248,.0));
      filter:blur(.2px);
      opacity:.9;
      mask:radial-gradient(circle at center, transparent 62%, #000 64%);
      animation:ringSpin 2.8s linear infinite;
    }
    .chat-avatar::after{
      content:"";
      position:absolute;
      inset:-12px;
      border-radius:999px;
      border:1px solid rgba(56,189,248,.25);
      opacity:.55;
      animation:pulse 2.2s ease-in-out infinite;
    }

    .chat-label{font-size:12px;opacity:.85;font-weight:800;color:#e2e8f0}
    .chat-name{font-weight:1000;font-size:14px;letter-spacing:.02em;color:#ffffff}

    .pp-spark{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.55);
      border:1px solid rgba(148,196,255,.35);
      font-weight:1000;
      font-size:12px;
      color:#e5e7eb;
      box-shadow:0 14px 34px rgba(0,0,0,.35);
    }
    .pp-dot{
      width:10px;height:10px;border-radius:999px;
      background:rgba(56,189,248,.95);
      box-shadow:0 0 0 0 rgba(56,189,248,.45);
      animation:notify 1.6s ease-in-out infinite;
    }

    @keyframes ringSpin{to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:.55}50%{transform:scale(1.06);opacity:.25}}
    @keyframes notify{0%,100%{box-shadow:0 0 0 0 rgba(56,189,248,.45);transform:scale(1)}50%{box-shadow:0 0 0 12px rgba(56,189,248,0);transform:scale(1.05)}}
    @keyframes ppGlow{0%,100%{opacity:.65}50%{opacity:.95}}

    /* ================= MOBILE LAYOUT FIXES ================= */
    @media (max-width: 900px){
      /* Overall hero spacing */
      .hero{
        padding:18px;
        min-height:100vh;
        align-items:flex-start;
        padding-top:72px;
        gap:18px;
      }

      .hero-content{max-width:100%;}

      h1{font-size:clamp(28px,8vw,42px);margin:14px 0 12px;}
      p{font-size:16px;line-height:1.55;margin-bottom:18px;}

      .cta{width:100%;max-width:520px;margin-top:10px;}

      .alert-box{
        position:relative;
        right:auto;bottom:auto;
        width:100%;
        max-width:520px;
        margin-top:18px;
      }

      .chat-launcher{
        position:fixed;
        right:14px;
        bottom:calc(70px + env(safe-area-inset-bottom));
        left:14px;
        max-width:520px;
        margin:0 auto;
        z-index:25000;
      }

      .chat-window{
        left:12px;
        right:12px;
        width:auto;
        bottom:calc(140px + env(safe-area-inset-bottom));
        max-height:78vh;
      }

      .disc-btn{
        position:fixed;
        right:14px;
        bottom:calc(14px + env(safe-area-inset-bottom));
        left:auto;
        top:auto;
        z-index:26000;
      }
    }

      .hero-content{max-width:100%;}

      h1{font-size:clamp(28px,8vw,42px);margin:14px 0 12px;}
      p{font-size:16px;line-height:1.55;margin-bottom:18px;}

      /* Primary CTA full width */
      .cta{width:100%;max-width:520px;margin-top:10px;}

      /* Put alert in normal flow so it never overlaps */
      .alert-box{
        position:relative;
        right:auto;bottom:auto;
        width:100%;
        max-width:520px;
        margin-top:18px;
      }

      /* PolicyPro launcher becomes a floating sticky pill on mobile */
      .chat-launcher{
        position:fixed;
        right:14px;
        bottom:calc(14px + env(safe-area-inset-bottom));
        left:14px;
        width:auto;
        max-width:520px;
        margin:0 auto;
        z-index:25000;
      }
      .chat-launcher:hover{transform:none;}
      .chat-launcher:active{transform:none;}

      /* Chat window: edge-to-edge friendly on small screens */
      .chat-window{
        left:12px;
        right:12px;
        width:auto;
        bottom:calc(74px + env(safe-area-inset-bottom)); /* leave room for sticky PolicyPro pill */
        max-height:78vh;
      }

      /* Move Disclaimer away from the CTA on mobile */
      .disc-btn{
        left:auto;
        bottom:auto;
        right:12px;
        top:12px;
        z-index:26000;
      }
    }

    /* Funnel modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:20000;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:21000;}
    .card{width:min(760px,96vw);background:#ffffff;color:#0b1323;border-radius:18px;box-shadow:0 40px 100px rgba(0,0,0,.8);overflow:hidden;border:1px solid #e5e7eb;}
    .card-head{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:#f8fafc;border-bottom:1px solid #e5e7eb;}
    .card-head h2{margin:0;font-size:16px;font-weight:900;}
    .card-head p{margin:2px 0 0;font-size:12px;color:#475569;max-width:none;}
    .icon-btn{background:transparent;border:none;font-size:18px;cursor:pointer;color:#475569;}
    .card-body{padding:14px 16px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:740px){.grid{grid-template-columns:1fr;}}
    .field{display:grid;gap:6px;}
    .field label{font-size:12px;font-weight:900;color:#0f172a;}
    .field input,.field select,.field textarea{padding:12px;border-radius:12px;border:1px solid #cbd5e1;font-size:14px;}
    .field textarea{resize:vertical;min-height:90px;}
    .hint{font-size:11px;color:#64748b;font-weight:700;}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px;}
    .btn{padding:12px 14px;border-radius:12px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:900;}
    .btn-primary{border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;}
    .status{display:none;margin-top:10px;font-size:12px;font-weight:800;}
    .status.ok{color:#166534;}
    .status.err{color:#b91c1c;}

    /* Disclaimer button */
    .disc-btn{position:fixed;left:18px;bottom:18px;z-index:15000;background:rgba(15,23,42,.85);backdrop-filter:blur(10px);border:1px solid rgba(148,196,255,.45);color:#e5e7eb;padding:10px 14px;border-radius:999px;font-weight:900;font-size:12px;cursor:pointer;box-shadow:0 16px 50px rgba(0,0,0,.6)}
    .disc-btn:hover{filter:brightness(1.06)}

    /* Disclaimer modal */
    .disc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:30000;}
    .disc-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:31000;overflow:auto;}
    .disc-card{width:min(880px,96vw);max-height:86vh;background:#ffffff;color:#0b1323;border-radius:22px;box-shadow:0 50px 130px rgba(0,0,0,.85);overflow:hidden;border:1px solid rgba(148,196,255,.35);position:relative;}
    .disc-card::before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(1200px 500px at 20% -10%, rgba(56,189,248,.18), transparent 55%),radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.14), transparent 55%);}
    .disc-head{position:relative;display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:linear-gradient(180deg,#0b1120,#0f172a);border-bottom:1px solid rgba(148,196,255,.25);color:#e5e7eb;}
    .disc-head h2{margin:0;font-size:16px;font-weight:900;letter-spacing:.01em;}
    .disc-kicker{margin:4px 0 0;font-size:12px;color:rgba(226,232,240,.9);font-weight:800;max-width:66ch;line-height:1.35;}
    .disc-icon{width:34px;height:34px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;border:1px solid rgba(148,196,255,.45);background:rgba(15,23,42,.5);box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:900;}
    .disc-head-left{display:flex;gap:12px;align-items:flex-start;}
    .disc-close{background:rgba(248,250,252,.06);border:1px solid rgba(148,196,255,.35);color:#e5e7eb;border-radius:12px;padding:8px 10px;font-weight:900;cursor:pointer;}
    .disc-close:hover{filter:brightness(1.08)}

    .disc-body{position:relative;padding:14px 16px 12px;font-size:14px;line-height:1.55;color:#0b1120;overflow:auto;max-height:calc(86vh - 62px - 74px);font-weight:700;}
    .disc-body p{margin:0 0 10px;font-weight:700;color:#0b1120;}
    .disc-body strong{font-weight:900;color:#020617;}
    .disc-sections{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:860px){.disc-sections{grid-template-columns:1fr;}}

    .disc-section{border:1px solid #e5e7eb;border-radius:16px;background:#ffffff;box-shadow:0 10px 26px rgba(0,0,0,.06);overflow:hidden;}
    .disc-sec-head{display:flex;gap:10px;align-items:flex-start;padding:12px 12px;background:linear-gradient(180deg,#ffffff,#f8fafc);border-bottom:1px solid #e5e7eb;}
    .disc-sec-badge{width:30px;height:30px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#0b1120;border:1px solid rgba(56,189,248,.35);background:rgba(56,189,248,.12);}
    .disc-sec-title{margin:0;font-size:13px;font-weight:900;color:#0b1120;}
    .disc-sec-sub{margin:2px 0 0;font-size:11px;color:#64748b;font-weight:800;line-height:1.35;}
    .disc-sec-body{padding:12px 12px 10px;font-size:13px;color:#0b1120;}
    .disc-sec-body ul{margin:0;padding-left:18px;display:grid;gap:8px;}
    .disc-sec-body li{margin:0;}

    .disc-footer-note{margin-top:12px;padding:12px;border-radius:16px;border:1px dashed rgba(15,23,42,.25);background:rgba(248,250,252,.9);font-size:12px;color:#0f172a;font-weight:800;}

    .disc-actions{position:relative;display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;background:linear-gradient(180deg,#f8fafc,#ffffff);border-top:1px solid #e5e7eb;}
    .disc-actions .btn{min-width:140px}
    .btn-accept{border:1px solid rgba(34,197,94,.35);background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.08));color:#0b1120;}
    .btn-accept:hover{filter:brightness(1.03)}

    /* Chat window */
    .chat-window{display:none;position:fixed;right:20px;bottom:100px;width:410px;max-height:72vh;background:#fff;color:#020617;border-radius:18px;box-shadow:0 40px 90px rgba(0,0,0,.8);overflow:hidden;z-index:10000;border:1px solid #e5e7eb}
    .chat-header{
      padding:12px 14px;
      background:linear-gradient(180deg,#0b1120,#0f172a);
      border-bottom:1px solid rgba(148,196,255,.25);
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:#e5e7eb;
    }
    .chat-header strong{font-weight:1000;letter-spacing:.02em}
    .chat-sub{font-size:11px;color:rgba(226,232,240,.85);font-weight:900;margin-top:2px}
    .close{background:rgba(248,250,252,.06);border:1px solid rgba(148,196,255,.35);color:#e5e7eb;border-radius:12px;padding:8px 10px;font-weight:1000;cursor:pointer}
    .close:hover{filter:brightness(1.08)}

    .chat-main{display:flex;flex-direction:column;height:calc(72vh - 52px);min-height:380px}
    .chat-messages{padding:12px;overflow:auto;flex:1;background:radial-gradient(900px 420px at 15% 0%, rgba(56,189,248,.08), transparent 55%), linear-gradient(180deg,#ffffff,#f8fafc)}
    .msg{display:flex;margin:10px 0}
    .msg.user{justify-content:flex-end}
    .msg.bot{justify-content:flex-start}
    .bubble{max-width:82%;padding:10px 12px;border-radius:14px;font-size:13.5px;line-height:1.45;box-shadow:0 10px 26px rgba(0,0,0,.08)}
    .bubble.user{background:#0b1120;color:#e5e7eb;border-top-right-radius:6px}
    .bubble.bot{background:#ffffff;color:#0f172a;border:1px solid #e5e7eb;border-top-left-radius:6px}
    .meta{font-size:10px;color:#64748b;font-weight:900;margin-top:6px}
    .chat-inputbar{padding:10px;border-top:1px solid #e5e7eb;background:#fff;display:flex;gap:10px;align-items:center}
    .chat-input{flex:1;padding:12px 12px;border-radius:14px;border:1px solid #cbd5e1;font-size:14px;outline:none}
    .chat-input:focus{border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.15)}
    .send-btn{padding:12px 14px;border-radius:14px;border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;font-weight:1000;cursor:pointer}
    .send-btn:disabled{opacity:.55;cursor:not-allowed}

    /* Chat lead capture */
    .lead-nudge{margin:10px 0 0;}
    .lead-card{border:1px solid #e5e7eb;background:#ffffff;border-radius:14px;padding:10px 10px;box-shadow:0 10px 26px rgba(0,0,0,.06)}
    .lead-title{font-weight:900;font-size:12.5px;color:#0b1120;margin:0 0 6px}
    .lead-sub{font-weight:800;font-size:11px;color:#64748b;margin:0 0 8px;line-height:1.35}
    .lead-row{display:flex;gap:8px;align-items:center}
    .lead-email{flex:1;padding:10px 10px;border-radius:12px;border:1px solid #cbd5e1;font-size:13px;outline:none}
    .lead-email:focus{border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.12)}
    .lead-btn{padding:10px 12px;border-radius:12px;border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;font-weight:900;cursor:pointer;white-space:nowrap}
    .lead-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;background:#f8fafc;color:#0b1120;border-radius:999px;padding:8px 10px;font-weight:900;font-size:12px;cursor:pointer}
    .chip:hover{filter:brightness(1.02)}
    .lead-ok{font-weight:900;font-size:11px;color:#166534;margin-top:8px;display:none}
    .lead-err{font-weight:900;font-size:11px;color:#b91c1c;margin-top:8px;display:none}

    .typing{display:inline-flex;gap:4px;align-items:center}
    .dot{width:6px;height:6px;border-radius:999px;background:#94a3b8;animation:bounce 1.1s infinite}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.3s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.5}40%{transform:translateY(-4px);opacity:1}}

    .close{background:none;border:none;font-size:18px;cursor:pointer}
  </style>
</head>

<body>

<section class="hero">
  <div class="hero-content">
    <span class="badge">Colorado home &amp; auto insurance</span>
    <h1>Get flexible home &amp; auto options that fit your budget and protect what matters.</h1>
    <p>Wildfires, hail, and severe weather are driving more claims across Colorado. We help you understand coverage options and smarter ways to stay protected.</p>
    <button class="cta" id="openFunnel" type="button">Check My Options</button>
  </div>

  <div class="alert-box">
    <div class="alert-title">Wildfires &amp; Hail Damage</div>
    <div class="alert-text">Colorado homes and cars are seeing more wildfire, hail, and severe-weather damage claims. Make sure you're covered for both to stay ahead of rising risks.</div>
  </div>

  <!-- PolicyPro positioned beneath alert -->
  <div class="chat-launcher" id="chatBtn" aria-label="Open PolicyPro chat" title="Ask PolicyPro‚Ñ¢ a question">
    <div class="chat-avatar">PP</div>
    <div>
      <div class="chat-label">Ask our</div>
      <div class="chat-name">PolicyPro‚Ñ¢</div>
    </div>
    <div class="pp-spark" aria-hidden="true"><span class="pp-dot"></span>Live help</div>
  </div>
</section>

<!-- Lead Funnel Modal (kept as fallback if CLICKFUNNEL_URL is blank) -->
<div class="modal-overlay" id="modalOverlay"></div>
<div class="modal" id="modal">
  <div class="card" role="dialog" aria-label="Options pre-check form">
    <div class="card-head">
      <div>
        <h2>Quick Options Pre‚ÄëCheck</h2>
        <p>2 minutes. Not a quote. A licensed agent reviews and follows up with carrier‚Äëagnostic options.</p>
      </div>
      <button class="icon-btn" id="closeModal" type="button">‚úï</button>
    </div>
    <div class="card-body">
      <form id="leadForm">
        <div class="grid">
          <div class="field">
            <label for="firstName">First name *</label>
            <input id="firstName" name="firstName" autocomplete="given-name" required />
          </div>
          <div class="field">
            <label for="lastName">Last name *</label>
            <input id="lastName" name="lastName" autocomplete="family-name" required />
          </div>
          <div class="field">
            <label for="zip">ZIP *</label>
            <input id="zip" name="zip" inputmode="numeric" pattern="[0-9]{5}" placeholder="81501" required />
            <div class="hint">Example reference ZIP: 81501</div>
          </div>
          <div class="field">
            <label for="email">Email *</label>
            <input id="email" name="email" type="email" autocomplete="email" required />
          </div>
          <div class="field">
            <label for="phone">Mobile phone *</label>
            <input id="phone" name="phone" type="tel" autocomplete="tel" required />
          </div>
          <div class="field">
            <label for="homeowner">Home status *</label>
            <select id="homeowner" name="homeowner" required>
              <option value="">Select‚Ä¶</option>
              <option>Own</option>
              <option>Rent</option>
              <option>Buying soon</option>
            </select>
          </div>
          <div class="field">
            <label for="roofAge">Roof age</label>
            <select id="roofAge" name="roofAge">
              <option value="">Select‚Ä¶</option>
              <option>0-5</option><option>6-10</option><option>11-15</option><option>16-20</option><option>21+</option><option>Not sure</option>
            </select>
          </div>
          <div class="field">
            <label for="vehicles">Vehicles insured *</label>
            <select id="vehicles" name="vehicles" required>
              <option value="">Select‚Ä¶</option>
              <option>1</option><option>2</option><option>3</option><option>4+</option>
            </select>
          </div>
          <div class="field">
            <label for="timeframe">When do you need this? *</label>
            <select id="timeframe" name="timeframe" required>
              <option value="">Select‚Ä¶</option>
              <option>ASAP</option>
              <option>Within 7 days</option>
              <option>Within 30 days</option>
              <option>Just exploring</option>
            </select>
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" name="notes" placeholder="Any details that help (hail claim history, wildfire concerns, bundling, etc.)"></textarea>
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label style="display:flex;gap:10px;align-items:flex-start;font-weight:800;color:#0f172a;">
              <input id="consent" type="checkbox" required style="margin-top:2px;" />
              I agree to be contacted by phone, SMS, and email about insurance options. Msg &amp; data rates may apply.
            </label>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="cancelBtn" type="button">Cancel</button>
          <button class="btn btn-primary" id="submitBtn" type="submit">Submit</button>
        </div>
        <div class="status" id="formStatus"></div>
      </form>
    </div>
  </div>
</div>


<!-- Disclaimer launcher -->
<button class="disc-btn" id="openDisclaimer" type="button">Disclaimer</button>

<!-- Disclaimer modal -->
<div class="disc-overlay" id="discOverlay"></div>
<div class="disc-modal" id="discModal" role="dialog" aria-label="Legal disclaimer">
  <div class="disc-card">
    <div class="disc-head">
      <div class="disc-head-left">
        <div class="disc-icon">‚öñ</div>
        <div>
          <h2>Legal Disclaimer</h2>
          <div class="disc-kicker">Please review. This site includes AI-assisted information. <b>Human review is required</b> before any quote, application, binding, or policy change.</div>
        </div>
      </div>
      <button class="disc-close" id="discClose" type="button" aria-label="Close disclaimer">Close ‚úï</button>
    </div>
    <div class="disc-body">
      <div class="disc-sections">

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">i</div>
            <div>
              <p class="disc-sec-title">General information only</p>
              <p class="disc-sec-sub">Not legal, tax, or financial advice</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>This page and <strong>PolicyPro‚Ñ¢</strong> provide <strong>general educational information</strong> about insurance concepts.</li>
              <li>Nothing here is legal advice, tax advice, or a substitute for professional guidance.</li>
              <li>Examples (including ZIP <strong>81501</strong>) are <strong>illustrative only</strong>.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">AI</div>
            <div>
              <p class="disc-sec-title">AI disclosure</p>
              <p class="disc-sec-sub">AI output can be wrong or incomplete</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li><strong>PolicyPro‚Ñ¢</strong> includes automated and artificial‚Äëintelligence‚Äìgenerated responses for general informational purposes.</li>
              <li>AI output may be incomplete, inaccurate, or outdated and must not be relied upon as a definitive statement of coverage, pricing, underwriting eligibility, or claim outcome.</li>
              <li>AI responses do <strong>not</strong> replace advice from a licensed insurance producer.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">‚úì</div>
            <div>
              <p class="disc-sec-title">Human review required</p>
              <p class="disc-sec-sub">Before quotes, applications, or changes</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Any quote indications, coverage discussions, or next steps require <strong>review and confirmation</strong> by a licensed insurance agent before any application is submitted or coverage is bound.</li>
              <li>Nothing on this page constitutes an offer to sell insurance or bind coverage.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">üõ°</div>
            <div>
              <p class="disc-sec-title">Coverage &amp; claims limitations</p>
              <p class="disc-sec-sub">Carrier rules and policy terms control</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Coverage, eligibility, rates, discounts, underwriting, and availability vary by carrier and are subject to policy terms, conditions, exclusions, limits, and deductibles.</li>
              <li>Claim scenario walkthroughs are general and may not apply to your situation. Always follow your policy and carrier instructions. If there is immediate danger, call emergency services.</li>
            </ul>
          </div>
        </section>

      </div>

      <div class="disc-footer-note">
        <strong>Consent &amp; privacy:</strong> By submitting your information, you authorize contact by phone, SMS, and email about insurance options (msg &amp; data rates may apply). Information may be stored in a secure Google Sheet and emailed to the business inbox for follow‚Äëup. Do not submit sensitive information you do not want transmitted electronically.
      </div>
    </div>

    <div class="disc-actions">
      <button class="btn btn-accept" id="discAccept" type="button">I Accept</button>
      <button class="btn btn-primary" id="discClose2" type="button">Close</button>
    </div>
  </div>
</div>

<div class="chat-window" id="chatWindow">
  <div class="chat-header">
    <div>
      <strong>PolicyPro‚Ñ¢</strong>
      <div class="chat-sub">Ask a home or auto insurance question</div>
    </div>
    <button class="close" id="closeChat" aria-label="Close chat" type="button">‚úï</button>
  </div>

  <div class="chat-main">
    <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

    <!-- Lead capture inside chat (shown until email captured) -->
    <div class="lead-nudge" id="chatLeadNudge" style="display:none; padding: 0 12px 12px;">
      <div class="lead-card">
        <p class="lead-title">Want a personalized coverage checklist?</p>
        <p class="lead-sub">Drop your email and we‚Äôll send your hail + wildfire endorsements guide. Or click <b>Check My Options</b> for a fast pre‚Äëcheck.</p>
        <div class="lead-row">
          <input class="lead-email" id="chatLeadEmail" type="email" placeholder="you@email.com" autocomplete="email" />
          <button class="lead-btn" id="chatLeadSave" type="button">Send guide</button>
        </div>
        <div class="lead-actions">
          <button class="chip" id="chatLeadOpenFunnel" type="button">‚úÖ Check My Options</button>
          <button class="chip" id="chatLeadNotNow" type="button">Not now</button>
        </div>
        <div class="lead-ok" id="chatLeadOk">‚úÖ Got it ‚Äî check your inbox shortly.</div>
        <div class="lead-err" id="chatLeadErr">‚ö† Please enter a valid email.</div>
      </div>
    </div>

    <form class="chat-inputbar" id="chatForm" autocomplete="off">
      <input class="chat-input" id="chatInput" type="text" placeholder="Ask about hail deductibles, wildfire coverage, bundling‚Ä¶" />
      <button class="send-btn" id="chatSend" type="submit">Send</button>
    </form>
  </div>
</div>

<script>
  // ===== Hero image auto-detect (fixes accidental double extensions like .jpg.png) =====
  (function(){
    var candidates = [
      'hero-securechoice-wildfire-hail-phone.png',
      'hero-securechoice-wildfire-hail-phone.jpg',
      'hero-securechoice-wildfire-hail-phone.jpeg',
      'hero-securechoice-wildfire-hail-phone.webp',
      // Common mistake when Windows hides extensions:
      'hero-securechoice-wildfire-hail-phone.jpg.png'
    ];

    function setHero(url){
      try{ document.documentElement.style.setProperty('--hero-image', "url('" + url + "')"); }catch(e){}
    }

    function tryNext(i){
      if(i >= candidates.length) return;
      var img = new Image();
      img.onload = function(){ setHero(candidates[i]); };
      img.onerror = function(){ tryNext(i+1); };
      img.src = candidates[i] + '?v=' + Date.now();
    }

    tryNext(0);
  })();

  // ===== Lead funnel + Google Apps Script backend =====
  var GAS = window.GAS_WEBAPP_URL || "";
  var CLICKFUNNEL_URL = (window.CLICKFUNNEL_URL || '').trim();

  var openFunnelBtn = document.getElementById('openFunnel');
  var modalOverlay = document.getElementById('modalOverlay');
  var modal = document.getElementById('modal');
  var closeModalBtn = document.getElementById('closeModal');
  var cancelBtn = document.getElementById('cancelBtn');
  var leadForm = document.getElementById('leadForm');
  var formStatus = document.getElementById('formStatus');

  function showModal(){ modalOverlay.style.display='block'; modal.style.display='flex'; }
  function hideModal(){ modalOverlay.style.display='none'; modal.style.display='none'; }

  if(closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
  if(cancelBtn) cancelBtn.addEventListener('click', hideModal);
  if(modalOverlay) modalOverlay.addEventListener('click', hideModal);

  function postToGAS(url, payload){
    // IMPORTANT: GitHub Pages -> Apps Script JSON fetch triggers CORS preflight.
    // This sends a "simple" form-encoded POST with mode:no-cors so the browser will allow the request.
    // We can't read the response in no-cors mode, so treat a successful fetch() as "submitted".
    var params = new URLSearchParams();
    params.set('payload', JSON.stringify(payload || {}));

    return fetch(url, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: params.toString()
    });
  }

  function leadScore(zip, timeframe){
    var score = 0;
    if(timeframe === 'ASAP') score += 35;
    else if(timeframe === 'Within 7 days') score += 25;
    else if(timeframe === 'Within 30 days') score += 10;

    if(zip === '81501') score += 20;
    else if(zip && zip.length === 5) score += 8;

    if(score > 100) score = 100;
    var label = (score >= 70) ? 'HOT' : (score >= 40 ? 'WARM' : 'COOL');
    return { score: score, label: label };
  }

  // ===== PolicyPro chat (UI + optional backend) =====
  var chatBtn = document.getElementById('chatBtn');
  var chatWindow = document.getElementById('chatWindow');
  var closeChat = document.getElementById('closeChat');
  var chatMessages = document.getElementById('chatMessages');
  var chatForm = document.getElementById('chatForm');
  var chatInput = document.getElementById('chatInput');
  var chatSend = document.getElementById('chatSend');

  // Where to send chat requests.
  // ‚úÖ No API key required: PolicyPro runs in LOCAL mode by default (rule-based + curated insurance guidance).
  // If you ever add a secure server endpoint later, set window.POLICYPRO_LLM_ENDPOINT to https://... and change POLICYPRO_MODE to 'remote'.
  var POLICYPRO_MODE = ((window.POLICYPRO_MODE || '') + '').trim().toLowerCase() || 'local';
  var CHAT_ENDPOINT = (POLICYPRO_MODE === 'remote')
    ? (((window.POLICYPRO_LLM_ENDPOINT || '').trim() || (window.GAS_WEBAPP_URL || '').trim()))
    : '';

  var chatHistory = []; // minimal local memory

  // Lead capture state for chat
  var chatLeadNudge = document.getElementById('chatLeadNudge');
  var chatLeadEmail = document.getElementById('chatLeadEmail');
  var chatLeadSave = document.getElementById('chatLeadSave');
  var chatLeadOpenFunnel = document.getElementById('chatLeadOpenFunnel');
  var chatLeadNotNow = document.getElementById('chatLeadNotNow');
  var chatLeadOk = document.getElementById('chatLeadOk');
  var chatLeadErr = document.getElementById('chatLeadErr');

  function getStoredEmail_(){
    try{ return (localStorage.getItem('sc_chat_email') || '').trim(); }catch(e){ return ''; }
  }
  function setStoredEmail_(email){
    try{ localStorage.setItem('sc_chat_email', String(email||'')); }catch(e){}
  }
  function isEmail_(email){
    email = String(email||'').trim();
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function maybeShowChatLeadNudge_(){
    if(!chatLeadNudge) return;
    var stored = getStoredEmail_();
    if(stored){ chatLeadNudge.style.display = 'none'; return; }
    chatLeadNudge.style.display = 'block';
  }

  function hideChatLeadNudge_(){
    if(chatLeadNudge) chatLeadNudge.style.display = 'none';
  }

  function showLeadOk_(msg){
    if(chatLeadErr) chatLeadErr.style.display = 'none';
    if(chatLeadOk){
      chatLeadOk.textContent = msg || '‚úÖ Got it ‚Äî check your inbox shortly.';
      chatLeadOk.style.display = 'block';
    }
  }
  function showLeadErr_(msg){
    if(chatLeadOk) chatLeadOk.style.display = 'none';
    if(chatLeadErr){
      chatLeadErr.textContent = msg || '‚ö† Please enter a valid email.';
      chatLeadErr.style.display = 'block';
    }
  }

  function submitChatEmailToBackend_(email){
    // Sends a lightweight "chat lead" so Apps Script can email a PDF/guide
    if(!GAS || GAS.indexOf('http') !== 0) return Promise.resolve({ ok:true, skipped:true });

    var payload = {
      action: 'chat_lead',
      source: 'GitHub Landing Page',
      channel: 'PolicyPro Chat',
      timestamp: new Date().toISOString(),
      email: email,
      aiConsent: true,
      deliverKit: true,
      kitType: 'FIRE_HAIL_ENDORSEMENTS'
    };

    return postToGAS(GAS, payload);
  }

  function handleChatLeadSubmit_(){
    var email = chatLeadEmail ? chatLeadEmail.value : '';
    if(!isEmail_(email)){
      showLeadErr_('‚ö† Please enter a valid email (example: name@email.com).');
      return;
    }

    setStoredEmail_(email);
    showLeadOk_('‚úÖ Thanks! Sending your guide to ' + email + '‚Ä¶');

    submitChatEmailToBackend_(email).then(function(resp){
      if(resp && resp.ok === false) throw new Error(resp.error || 'Backend error');
      showLeadOk_('‚úÖ Sent! Check ' + email + ' (and spam/promotions).');
      setTimeout(hideChatLeadNudge_, 1200);
    }).catch(function(){
      showLeadOk_('‚úÖ Saved! We\'ll follow up at ' + email + '.');
      setTimeout(hideChatLeadNudge_, 1200);
    });
  }

  if(chatLeadSave) chatLeadSave.addEventListener('click', handleChatLeadSubmit_);
  if(chatLeadEmail) chatLeadEmail.addEventListener('keydown', function(e){
    if(e && e.key === 'Enter'){ e.preventDefault(); handleChatLeadSubmit_(); }
  });
  if(chatLeadOpenFunnel) chatLeadOpenFunnel.addEventListener('click', function(){
    hideChatLeadNudge_();
    if(openFunnelBtn) openFunnelBtn.click();
  });
  if(chatLeadNotNow) chatLeadNotNow.addEventListener('click', function(){
    hideChatLeadNudge_();
    try{ localStorage.setItem('sc_chat_nudge_dismissed', String(Date.now())); }catch(e){}
  });

  function esc_(s){
    s = String(s == null ? '' : s);
    return s.replace(/[&<>"']/g, function(c){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c] || c;
    });
  }

  function addMsg_(role, html){
    if(!chatMessages) return;
    var wrap = document.createElement('div');
    wrap.className = 'msg ' + (role === 'user' ? 'user' : 'bot');

    var b = document.createElement('div');
    b.className = 'bubble ' + (role === 'user' ? 'user' : 'bot');
    b.innerHTML = html;

    wrap.appendChild(b);
    chatMessages.appendChild(wrap);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function addTyping_(){
    addMsg_('bot', '<span class="typing" aria-label="PolicyPro is typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>');
  }

  function replaceLastBot_(html){
    if(!chatMessages) return;
    var items = chatMessages.querySelectorAll('.msg.bot .bubble');
    if(!items || !items.length) return;
    items[items.length-1].innerHTML = html;
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function seedChat_(){
    if(!chatMessages || chatMessages.childElementCount) return;
    addMsg_('bot',
      '<div><b>Hi ‚Äî I\'m PolicyPro‚Ñ¢.</b> Ask me anything about Colorado home or auto insurance (hail deductibles, wildfire coverage, bundling, switching, etc.).</div>' +
      '<div class="meta">Example ZIP reference: <b>81501</b> (example only) ‚Ä¢ General info ‚Ä¢ Human review required</div>'
    );
    maybeShowChatLeadNudge_();
  }

  function openChat_(){
    if(chatWindow){ chatWindow.style.display = 'block'; }
    seedChat_();
    setTimeout(function(){ if(chatInput) chatInput.focus(); }, 50);
  }

  function closeChat_(){
    if(chatWindow){ chatWindow.style.display = 'none'; }
  }
    if(chatBtn){ chatBtn.style.display = 'flex'; }
  }

  if(chatBtn) chatBtn.addEventListener('click', function(){
    // Toggle behavior so the PolicyPro pill can stay visible on mobile
    var isOpen = (chatWindow && chatWindow.style.display === 'block');
    if(isOpen) closeChat_();
    else openChat_();
  });
  if(closeChat) closeChat.addEventListener('click', closeChat_);

  function classifyIntent_(q){
    var s = String(q||'').toLowerCase();
    var has = function(){
      for(var i=0;i<arguments.length;i++){
        if(s.indexOf(String(arguments[i]).toLowerCase()) !== -1) return true;
      }
      return false;
    };

    // Perils / topics
    if(has('hail')) return 'hail';
    if(has('wildfire','fire','smoke','embers')) return 'wildfire';
    if(has('wind','storm')) return 'wind';
    if(has('water backup','sump','sewer','drain','backup')) return 'water_backup';
    if(has('flood')) return 'flood';

    // Money / policy mechanics
    if(has('deductible')) return 'deductible';
    if(has('replacement cost','rcv')) return 'replacement_cost';
    if(has('actual cash value','acv')) return 'acv';
    if(has('roof','shingles','roof age','hail deductible')) return 'roof';
    if(has('endorsement','rider','extra coverage','add-on')) return 'endorsements';
    if(has('limit','coverage amount','how much coverage')) return 'limits';

    // Home policy components
    if(has('dwelling','coverage a','home value','rebuild')) return 'dwelling';
    if(has('personal property','contents','coverage c')) return 'personal_property';
    if(has('loss of use','ale','additional living expense','temporary housing')) return 'loss_of_use';
    if(has('liability','coverage e','bodily injury','property damage')) return 'liability';
    if(has('medical payments','med pay','coverage f')) return 'medpay';
    if(has('rent','renter','apartment')) return 'renters';

    // Auto policy components
    if(has('comprehensive','comp','theft','vandalism','animal','deer')) return 'auto_comp';
    if(has('collision','at fault','crash')) return 'auto_collision';
    if(has('uninsured','underinsured','um','uim')) return 'um_uim';
    if(has('pip')) return 'pip';
    if(has('sr-22','sr22')) return 'sr22';

    // Shopping / switching
    if(has('umbrella')) return 'umbrella';
    if(has('cancel','lapse','renewal','switch','shopping')) return 'switching';
    if(has('bundle','multi-policy')) return 'bundle';
    if(has('claim','file a claim','claims','denied')) return 'claims';
    if(has('cheapest','save','lower','rate','premium','expensive')) return 'price';

    return 'general';
  }

  function fallbackAnswer_(q){
    // LOCAL mode: curated, carrier-agnostic guidance (no API key, no external calls)
    var intent = classifyIntent_(q);

    if(intent === 'hail'){
      return (
        '<b>Hail coverage‚Äîwhat to check first:</b><br>' +
        '‚Ä¢ <b>Home:</b> many CO policies use a separate <b>wind/hail deductible</b> (often a % of Coverage A). Also check roof settlement: <b>Replacement Cost</b> vs <b>ACV/roof schedule</b>.<br>' +
        '‚Ä¢ <b>Auto:</b> hail is typically under <b>Comprehensive</b> (not Collision), subject to your comp deductible.<br><br>' +
        '<b>Quick win:</b> comparing wind/hail deductible + roof terms often matters more than the headline premium in hail-prone areas (ZIP <b>81501</b> is an example only).<br><br>' +
        '<b>1 question:</b> Is your home wind/hail deductible a flat $ amount or a %?'
      );
    }

    if(intent === 'roof'){
      return (
        '<b>Roof coverage (CO)‚Äî2 items change claim payouts the most:</b><br>' +
        '‚Ä¢ <b>Roof settlement:</b> <b>Replacement Cost</b> pays to replace (after deductible + depreciation recovered). <b>ACV/roof schedule</b> reduces payment for age/wear.<br>' +
        '‚Ä¢ <b>Wind/Hail deductible:</b> often separate and can be a % of Coverage A.<br><br>' +
        '<b>Ask your agent/carrier:</b> ‚ÄúIs my roof on RCV or ACV/schedule? What is my wind/hail deductible?‚Äù<br><br>' +
        '<b>1 question:</b> About how old is the roof (0‚Äì5, 6‚Äì10, 11‚Äì15, 16+)?'
      );
    }

    if(intent === 'wildfire'){
      return (
        '<b>Wildfire/smoke‚Äîfocus on these coverage parts:</b><br>' +
        '‚Ä¢ <b>Dwelling (Coverage A)</b> adequacy + any <b>extended replacement</b> option<br>' +
        '‚Ä¢ <b>Loss of use / ALE</b> for temporary housing<br>' +
        '‚Ä¢ <b>Ordinance or Law</b> (code upgrades after a covered loss)<br>' +
        '‚Ä¢ Underwriting items: <b>defensible space</b>, roof condition, and proximity to brush can impact eligibility in some areas.<br><br>' +
        '<b>Auto note:</b> fire/embers/smoke-related vehicle damage is typically <b>Comprehensive</b> (deductible applies).<br><br>' +
        '<b>1 question:</b> Homeowner, condo, or renter?'
      );
    }

    if(intent === 'water_backup'){
      return (
        '<b>Water backup (sewer/drain/sump) is usually NOT covered by default.</b><br><br>' +
        'Most homeowners/renters policies exclude sewer/drain backup unless you add a <b>water backup endorsement</b> (with a separate limit, e.g., $5k‚Äì$25k depending on carrier).<br><br>' +
        '<b>Tip:</b> confirm the endorsement limit, whether finished basement contents are included, and if there are maintenance requirements.<br><br>' +
        '<b>1 question:</b> Are you asking about a future add-on or an active loss/claim?'
      );
    }

    if(intent === 'flood'){
      return (
        '<b>Flood is typically separate from homeowners/renters.</b><br><br>' +
        'Most standard policies exclude flood (rising water / surface water). Flood coverage is usually purchased as a separate policy.<br><br>' +
        '<b>1 question:</b> Is your concern river/flash flooding, or water backup from a drain/sewer?'
      );
    }

    if(intent === 'deductible'){
      return (
        '<b>Deductibles‚Äîstraight breakdown:</b><br>' +
        '‚Ä¢ <b>Home:</b> often multiple deductibles (All Other Perils + separate wind/hail %). Lower wind/hail deductible can raise premium in CO.<br>' +
        '‚Ä¢ <b>Auto:</b> Collision and Comprehensive deductibles are separate. Higher deductibles lower premium but increase out-of-pocket.<br><br>' +
        '<b>Rule of thumb:</b> pick a deductible you can comfortably pay tomorrow, then shop for better roof terms/eligibility.<br><br>' +
        '<b>1 question:</b> Are you trying to lower premium or reduce out-of-pocket on hail losses?'
      );
    }

    if(intent === 'replacement_cost'){
      return (
        '<b>Replacement Cost vs ACV (simple):</b><br>' +
        '‚Ä¢ <b>Replacement Cost</b>: pays to repair/replace with like kind/quality (deductible applies).<br>' +
        '‚Ä¢ <b>ACV</b>: replacement cost <i>minus depreciation</i>‚Äîlower payout for older items/roofs.<br><br>' +
        '<b>On roofs:</b> some carriers use an ACV/scheduled roof approach in hail-heavy areas‚Äîthis is a big deal on claims.<br><br>' +
        '<b>1 question:</b> Are you asking about your roof or personal property/contents?'
      );
    }

    if(intent === 'acv'){
      return (
        '<b>ACV (Actual Cash Value) means depreciation applies.</b><br><br>' +
        'If something is settled on ACV, the insurer reduces payout for age/wear. This most commonly surprises people on <b>older roofs</b> and sometimes personal property categories.<br><br>' +
        '<b>Action:</b> ask if you can upgrade roof settlement to Replacement Cost (if available) and what it does to premium/eligibility.<br><br>' +
        '<b>1 question:</b> What item are you worried about (roof, TV/furniture, etc.)?'
      );
    }

    if(intent === 'liability'){
      return (
        '<b>Liability coverage‚Äîwhat it does:</b><br>' +
        'It helps if you‚Äôre legally responsible for injury/property damage to others (home or auto, depending on policy). Limits matter most (e.g., $100k/$300k, $300k, $500k, etc.).<br><br>' +
        '<b>Common upgrade path:</b> increase underlying liability limits and consider an <b>umbrella</b> if you have assets/income to protect.<br><br>' +
        '<b>1 question:</b> Are you asking about home liability or auto liability?'
      );
    }

    if(intent === 'um_uim'){
      return (
        '<b>UM/UIM (uninsured/underinsured motorist):</b><br>' +
        'Helps cover injuries (and sometimes property damage, depending on state/options) if the at-fault driver has no insurance or not enough.<br><br>' +
        '<b>Why it matters:</b> it protects you when someone else can‚Äôt pay for the damage they caused.<br><br>' +
        '<b>1 question:</b> Are you mainly worried about medical bills/injuries or vehicle damage?'
      );
    }

    if(intent === 'renters'){
      return (
        '<b>Renters insurance (Colorado):</b> usually covers your personal property, liability, and loss-of-use (temporary housing). It does <b>not</b> insure the building.<br><br>' +
        '<b>Wildfire/smoke angle:</b> loss-of-use limits are important if you must evacuate or can‚Äôt live there during repairs.<br><br>' +
        '<b>1 question:</b> Do you want lowest cost or stronger liability + loss-of-use?'
      );
    }

    if(intent === 'endorsements'){
      return (
        '<b>Common add-ons that help in hail + fire scenarios:</b><br>' +
        '‚Ä¢ <b>Ordinance or Law</b> (code upgrades)<br>' +
        '‚Ä¢ <b>Water backup</b> (sewer/drain/sump)<br>' +
        '‚Ä¢ <b>Roof settlement upgrade</b> (RCV vs ACV/schedule, if offered)<br>' +
        '‚Ä¢ <b>Scheduled valuables</b> (jewelry, firearms, etc.) if you have high-value items<br><br>' +
        '<b>1 question:</b> Is your priority hail/roof, wildfire/evacuation, or water backup?'
      );
    }

    if(intent === 'bundle'){
      return (
        '<b>Bundling home + auto:</b> can reduce premium and sometimes help eligibility, but only if coverage terms stay strong.<br><br>' +
        '<b>Compare these before you switch:</b><br>' +
        '‚Ä¢ Home wind/hail deductible + roof settlement method<br>' +
        '‚Ä¢ Auto liability limits + comp/collision deductibles<br>' +
        '‚Ä¢ Any required programs (telematics, inspections, roof age rules)<br><br>' +
        '<b>1 question:</b> When is your renewal date (rough month is fine)?'
      );
    }

    if(intent === 'switching'){
      return (
        '<b>Switching carriers‚Äîsafe sequence:</b><br>' +
        '1) Bind the new policy first (confirm effective date + coverage).<br>' +
        '2) Confirm lender/escrow and financed-vehicle requirements.<br>' +
        '3) Cancel the old policy only after the new one is active to avoid a lapse.<br><br>' +
        '<b>Watch-outs in CO:</b> wind/hail deductibles and roof settlement can change dramatically between carriers.<br><br>' +
        '<b>1 question:</b> Are you switching because of premium, coverage terms, or a non-renewal?'
      );
    }

    if(intent === 'claims'){
      return (
        '<b>Claims‚Äîbest practice (general):</b><br>' +
        '‚Ä¢ Document damage (photos/video), protect property from further damage, and report promptly per policy terms.<br>' +
        '‚Ä¢ Keep receipts for emergency repairs/temporary living costs (if applicable).<br>' +
        '‚Ä¢ For hail: get a reputable inspection and understand depreciation/deductible effects before authorizing major work.<br><br>' +
        '<b>Important:</b> for an active loss, follow your carrier‚Äôs claim instructions and seek emergency help if unsafe.<br><br>' +
        '<b>1 question:</b> Is this a home hail claim, wildfire/smoke, or auto claim?'
      );
    }

    if(intent === 'price'){
      return (
        '<b>Ways people usually lower premium (without wrecking coverage):</b><br>' +
        '‚Ä¢ Right-size deductibles (especially wind/hail vs all-other-perils)<br>' +
        '‚Ä¢ Bundle home + auto where it doesn‚Äôt weaken roof terms<br>' +
        '‚Ä¢ Verify discounts (protective devices, claim-free, paid-in-full, telematics where comfortable)<br>' +
        '‚Ä¢ Review limits intelligently (don‚Äôt underinsure dwelling; consider liability needs)<br><br>' +
        '<b>Heads-up:</b> the cheapest quote can come with an ACV/scheduled roof and a large hail deductible in CO.<br><br>' +
        '<b>1 question:</b> Is your main goal ‚Äúlowest monthly payment‚Äù or ‚Äúbest hail/roof terms‚Äù?'
      );
    }

    // Default / general
    return (
      '<b>I can help with general home &amp; auto insurance questions.</b><br><br>' +
      '<b>Common Colorado topics:</b> wind/hail deductibles, roof settlement (RCV vs ACV), wildfire/defensible space, bundling, and switching without a lapse.<br><br>' +
      '<b>Ask me something like:</b> ‚ÄúIs hail covered on auto?‚Äù, ‚ÄúWhat is a wind/hail deductible?‚Äù, ‚ÄúDo I need water backup?‚Äù<br><br>' +
      '<b>1 question:</b> Are you asking about home, auto, renters, or umbrella?'
    );
  }

  function sendChat_(text){
    var q = (text||'').trim();
    if(!q) return;

    addMsg_('user', esc_(q));
    chatHistory.push({ role:'user', content:q });

    addTyping_();

    // After the user engages, show the email/CTA nudge if we don't have their email yet
    setTimeout(maybeShowChatLeadNudge_, 250);

    // ‚úÖ Default behavior: LOCAL answers (no API key, no external calls)
    // If you later set POLICYPRO_MODE='remote' AND provide a secure endpoint, this will try it.
    if(CHAT_ENDPOINT && CHAT_ENDPOINT.indexOf('http') === 0){
      var payloadChat = {
        action: 'chat',
        message: q,
        history: chatHistory.slice(-12),
        channel: 'PolicyPro Chat',
        // Safety: keep answers general; binding/quotes require human review
        policy: 'GENERAL_INFO_ONLY'
      };

      fetch(CHAT_ENDPOINT, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payloadChat)
      }).then(function(res){
        return res.text().then(function(t){
          var obj;
          try{ obj = JSON.parse(t); }catch(e){ obj = null; }
          if(!res.ok) throw new Error('HTTP ' + res.status);

          var reply = '';
          if(obj){
            if(typeof obj.reply === 'string') reply = obj.reply;
            else if(typeof obj.message === 'string') reply = obj.message;
            else if(typeof obj.output_text === 'string') reply = obj.output_text;
            else if(obj.choices && obj.choices[0] && obj.choices[0].message && typeof obj.choices[0].message.content === 'string') reply = obj.choices[0].message.content;
          }
          if(!reply) reply = fallbackAnswer_(q);

          chatHistory.push({ role:'assistant', content: String(reply) });

          // IMPORTANT: newline-to-<br> must use a valid regex literal.
          // This fixes the "Invalid regular expression: missing /" runtime error.
          replaceLastBot_(esc_(reply).replace(/\r?\n/g, '<br>') + '<div class="meta">General info ‚Ä¢ Not a quote ‚Ä¢ Human review required</div>');
        });
      }).catch(function(){
        var ansRemoteFail = fallbackAnswer_(q);
        chatHistory.push({ role:'assistant', content: ansRemoteFail.replace(/<[^>]*>/g,'') });
        replaceLastBot_(ansRemoteFail + '<div class="meta">General info ‚Ä¢ Not a quote ‚Ä¢ Human review required</div>');
      });
      return;
    }

    // Local answer
    var ans = fallbackAnswer_(q);
    chatHistory.push({ role:'assistant', content: ans.replace(/<[^>]*>/g,'') });
    replaceLastBot_(ans + '<div class="meta">General info ‚Ä¢ Not a quote ‚Ä¢ Human review required</div>');
  }

  if(chatForm){
    chatForm.addEventListener('submit', function(e){
      e.preventDefault();
      if(chatSend) chatSend.disabled = true;
      var q = chatInput ? chatInput.value : '';
      if(chatInput) chatInput.value = '';
      sendChat_(q);
      setTimeout(function(){ if(chatSend) chatSend.disabled = false; if(chatInput) chatInput.focus(); }, 50);
    });
  }

  // ===== Disclaimer modal =====
  var openDisclaimer = document.getElementById('openDisclaimer');
  var discOverlay = document.getElementById('discOverlay');
  var discModal = document.getElementById('discModal');
  var discClose = document.getElementById('discClose');
  var discClose2 = document.getElementById('discClose2');
  var discAccept = document.getElementById('discAccept');

  function showDisclaimer(){
    discOverlay.style.display = 'block';
    discModal.style.display = 'flex';
  }
  function hideDisclaimer(){
    discOverlay.style.display = 'none';
    discModal.style.display = 'none';
  }
  function acceptDisclaimer(){
    try{ localStorage.setItem('sc_disclaimer_accepted','1'); }catch(e){}
    hideDisclaimer();

    // If the user clicked a gated action (like "Check My Options"), continue after acceptance.
    if(window.__sc_pendingOpenOptions){
      window.__sc_pendingOpenOptions = false;
      openOptionsFlow_();
    }
  }

  // Track whether we should continue into the lead flow after the user accepts.
  window.__sc_pendingOpenOptions = false;

  if(openDisclaimer) openDisclaimer.addEventListener('click', showDisclaimer);
  if(discOverlay) discOverlay.addEventListener('click', hideDisclaimer);
  if(discClose) discClose.addEventListener('click', hideDisclaimer);
  if(discClose2) discClose2.addEventListener('click', hideDisclaimer);
  if(discAccept) discAccept.addEventListener('click', acceptDisclaimer);

  // Require disclaimer acceptance before opening the lead form OR ClickFunnels
  function openOptionsFlow_(){
    // If ClickFunnels is configured, open that (recommended). Otherwise fall back to the on-page modal.
    if(CLICKFUNNEL_URL && CLICKFUNNEL_URL.indexOf('http') === 0){
      // Open in same tab for mobile friendliness. Change to window.open(...) if you prefer new tab.
      window.location.href = CLICKFUNNEL_URL;
      return;
    }
    showModal();
  }

  if(openFunnelBtn) openFunnelBtn.addEventListener('click', function(){
    var accepted = false;
    try{ accepted = (localStorage.getItem('sc_disclaimer_accepted') === '1'); }catch(e){ accepted = false; }

    if(!accepted){
      // Only show the disclaimer when it's required (before opening the lead flow)
      window.__sc_pendingOpenOptions = true;
      showDisclaimer();
      return;
    }

    openOptionsFlow_();
  });

  // NOTE: We do NOT auto-show the disclaimer on page load.
  // It appears only when needed (before "Check My Options") or when the user clicks the Disclaimer button.

  if(leadForm){
    leadForm.addEventListener('submit', function(e){
      e.preventDefault();
      formStatus.style.display='block';
      formStatus.className='status';

      if(!GAS || GAS.indexOf('http') !== 0){
        formStatus.className='status err';
        formStatus.textContent='Backend not connected yet. Paste your Apps Script Web App URL into window.GAS_WEBAPP_URL at the top of this file.';
        return;
      }

      var payloadLead = {
        action: 'lead',
        source: 'GitHub Landing Page',
        channel: 'CTA Funnel',
        timestamp: new Date().toISOString(),
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        homeowner: document.getElementById('homeowner').value,
        roofAge: document.getElementById('roofAge').value,
        vehicles: document.getElementById('vehicles').value,
        timeframe: document.getElementById('timeframe').value,
        notes: document.getElementById('notes').value.trim(),
        consent: true,
        aiConsent: true,
        deliverKit: true,
        kitType: 'FIRE_HAIL_ENDORSEMENTS'
      };

      var scored = leadScore(payloadLead.zip, payloadLead.timeframe);
      payloadLead.leadScore = scored.score;
      payloadLead.leadLabel = scored.label;

      formStatus.textContent='Submitting‚Ä¶';

      postToGAS(GAS, payloadLead).then(function(){
        formStatus.className='status ok';
        formStatus.textContent='‚úÖ Submitted! Check your email for your coverage guide.';
        leadForm.reset();
        setTimeout(hideModal, 900);
      }).catch(function(err){
        formStatus.className='status err';
        formStatus.textContent='‚ö† Could not submit (network error). Double-check the Apps Script URL and that it is deployed as a Web App. (' + (err && err.message ? err.message : 'Error') + ')';
      });
    });
  }

  // ===== Tiny self-tests (safe in production; only logs to console) =====
  (function(){
    try{
      console.assert(esc_('<>&"\'') === '&lt;&gt;&amp;&quot;&#39;', 'esc_ should escape HTML');
      console.assert(isEmail_('a@b.co') === true, 'isEmail_ basic should pass');
      console.assert(isEmail_('nope') === false, 'isEmail_ basic should fail');

      // Existing newline test
      var sample = 'a\n b\r\n c';
      var out = sample.replace(/\r?\n/g, '<br>');
      console.assert(out.indexOf('<br>') !== -1, 'newline regex should work');

      // ‚úÖ Added tests to ensure regex never becomes invalid / split across lines
      console.assert('x\n'.replace(/\r?\n/g,'<br>') === 'x<br>', 'LF should replace');
      console.assert('x\r\n'.replace(/\r?\n/g,'<br>') === 'x<br>', 'CRLF should replace');

      var lsOk = true;
      try{ localStorage.setItem('_t','1'); localStorage.removeItem('_t'); }catch(e){ lsOk = false; }
      console.assert(lsOk === true || lsOk === false, 'localStorage check ran');
    }catch(e){ /* no-op */ }
  })();
</script>

</body>
</html>
