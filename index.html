<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colorado Relief Options â€” Home &amp; Auto Insurance</title>
  <meta name="description" content="Colorado residents: explore flexible home &amp; auto insurance options designed to protect your budget and peace of mind. Bundle, save, and see if you qualify for custom rate relief or flexible payments." />

  <!-- ================= QUICK SETUP =================
  REQUIRED FILES IN SAME FOLDER:
  - index.html
  - hero-securechoice-wildfire-hail-phone.jpg
  ================================================== -->

  <script>
    // === REQUIRED: paste your deployed Google Apps Script Web App URL here ===
    window.GAS_WEBAPP_URL = ""; // e.g. https://script.google.com/macros/s/XXXX/exec

    // Optional separate LLM endpoint (usually leave blank to reuse GAS)
    window.POLICYPRO_LLM_ENDPOINT = "";

    // Tracking (optional)
    window.GA4_MEASUREMENT_ID = "";
    window.GOOGLE_ADS_ID = "";
    window.GOOGLE_ADS_CONVERSION_LABEL = "";
    window.META_PIXEL_ID = "";

    window.AGENT_EMAIL = "securechoicein@gmail.com";

    // === ClickFunnels (recommended for "Check My Options") ===
    // Paste your ClickFunnels page URL here. If set, the CTA will open ClickFunnels instead of the on-page modal.
    window.CLICKFUNNEL_URL = ""; // e.g. https://yourfunnel.clickfunnels.com/step1
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{--card:#0f172a;--line:rgba(148,196,255,.35);--brand:#38bdf8;--brand2:#0ea5e9;--ok:#22c55e;--warn:#facc15;}

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:#0b1323;
      color:#e5e7eb;
    }

    /* HERO */
    .hero{
      position:relative;
      min-height:90vh;
      display:flex;
      align-items:center;
      padding:48px;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(rgba(5,10,25,.75),rgba(5,10,25,.75)),url('hero-securechoice-wildfire-hail-phone.jpg') center/cover no-repeat;
    }
    .hero-content{position:relative;max-width:680px;z-index:2}
    .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:rgba(56,189,248,.15);border:1px solid rgba(56,189,248,.4);font-size:12px;font-weight:700;color:#c7e9ff}
    h1{font-size:clamp(32px,5vw,52px);margin:18px 0;line-height:1.1}
    p{font-size:18px;color:#cbd5e1;max-width:56ch}
    .cta{margin-top:24px;padding:14px 28px;font-size:16px;font-weight:800;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(180deg,#38bdf8,#0ea5e9);color:#020617}

    /* Alert */
    .alert-box{position:absolute;right:10%;bottom:35%;width:240px;background:rgba(15,23,42,.95);border-radius:14px;padding:14px;border:1px solid rgba(148,196,255,.6);box-shadow:0 20px 50px rgba(0,0,0,.6);z-index:3}
    .alert-title{font-size:11px;text-transform:uppercase;letter-spacing:.14em;color:#facc15;margin-bottom:6px}
    .alert-text{font-size:13px;color:#e5e7eb;line-height:1.35}

    /* Chat launcher â€” make it the visual highlight */
    .chat-launcher{
      position:absolute;
      right:10%;
      bottom:22%; /* sits just beneath the Wildfires & Hail Damage alert */
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(148,196,255,.55);
      padding:16px 18px;
      border-radius:999px;
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      z-index:4;
      box-shadow:0 28px 90px rgba(0,0,0,.78);
      backdrop-filter:blur(10px);
      transition:transform .18s ease, filter .18s ease, box-shadow .18s ease;
      isolation:isolate;
      user-select:none;
    }
    .chat-launcher::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:999px;
      background:radial-gradient(120px 60px at 20% 10%, rgba(56,189,248,.55), transparent 60%),
                 radial-gradient(120px 60px at 85% 80%, rgba(34,197,94,.35), transparent 60%),
                 linear-gradient(90deg, rgba(56,189,248,.45), rgba(34,197,94,.28));
      filter:blur(10px);
      opacity:.75;
      z-index:-1;
      animation:ppGlow 2.6s ease-in-out infinite;
    }
    .chat-launcher::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:999px;
      border:1px solid rgba(56,189,248,.45);
      pointer-events:none;
      opacity:.55;
    }
    .chat-launcher:hover{
      transform:translateY(-50%) scale(1.035);
      filter:brightness(1.06);
      box-shadow:0 34px 120px rgba(0,0,0,.82);
    }
    .chat-launcher:active{
      transform:translateY(-50%) scale(0.99);
    }

    .chat-avatar{
      width:44px;
      height:44px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      color:#020617;
      letter-spacing:.02em;
      position:relative;
      background:radial-gradient(circle at 30% 20%, rgba(255,255,255,.8), rgba(255,255,255,0) 45%),
                 linear-gradient(180deg,#22c55e,#0ea5e9);
      box-shadow:0 18px 44px rgba(0,0,0,.35);
    }
    /* Holographic ring */
    .chat-avatar::before{
      content:"";
      position:absolute;
      inset:-6px;
      border-radius:999px;
      background:conic-gradient(from 180deg, rgba(56,189,248,.0), rgba(56,189,248,.85), rgba(34,197,94,.65), rgba(56,189,248,.0));
      filter:blur(.2px);
      opacity:.9;
      mask:radial-gradient(circle at center, transparent 62%, #000 64%);
      animation:ringSpin 2.8s linear infinite;
    }
    .chat-avatar::after{
      content:"";
      position:absolute;
      inset:-12px;
      border-radius:999px;
      border:1px solid rgba(56,189,248,.25);
      opacity:.55;
      animation:pulse 2.2s ease-in-out infinite;
    }

    .chat-label{font-size:12px;opacity:.85;font-weight:800;color:#e2e8f0}
    .chat-name{font-weight:1000;font-size:14px;letter-spacing:.02em;color:#ffffff}

    .pp-spark{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.55);
      border:1px solid rgba(148,196,255,.35);
      font-weight:1000;
      font-size:12px;
      color:#e5e7eb;
      box-shadow:0 14px 34px rgba(0,0,0,.35);
    }
    .pp-dot{
      width:10px;height:10px;border-radius:999px;
      background:rgba(56,189,248,.95);
      box-shadow:0 0 0 0 rgba(56,189,248,.45);
      animation:notify 1.6s ease-in-out infinite;
    }

    @keyframes ringSpin{to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:.55}50%{transform:scale(1.06);opacity:.25}}
    @keyframes notify{0%,100%{box-shadow:0 0 0 0 rgba(56,189,248,.45);transform:scale(1)}50%{box-shadow:0 0 0 12px rgba(56,189,248,0);transform:scale(1.05)}}
    @keyframes ppGlow{0%,100%{opacity:.65}50%{opacity:.95}}

    /* Funnel modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:20000;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:21000;}
    .card{width:min(760px,96vw);background:#ffffff;color:#0b1323;border-radius:18px;box-shadow:0 40px 100px rgba(0,0,0,.8);overflow:hidden;border:1px solid #e5e7eb;}
    .card-head{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:#f8fafc;border-bottom:1px solid #e5e7eb;}
    .card-head h2{margin:0;font-size:16px;font-weight:900;}
    .card-head p{margin:2px 0 0;font-size:12px;color:#475569;max-width:none;}
    .icon-btn{background:transparent;border:none;font-size:18px;cursor:pointer;color:#475569;}
    .card-body{padding:14px 16px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:740px){.grid{grid-template-columns:1fr;}}
    .field{display:grid;gap:6px;}
    .field label{font-size:12px;font-weight:900;color:#0f172a;}
    .field input,.field select,.field textarea{padding:12px;border-radius:12px;border:1px solid #cbd5e1;font-size:14px;}
    .field textarea{resize:vertical;min-height:90px;}
    .hint{font-size:11px;color:#64748b;font-weight:700;}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px;}
    .btn{padding:12px 14px;border-radius:12px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:900;}
    .btn-primary{border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;}
    .status{display:none;margin-top:10px;font-size:12px;font-weight:800;}
    .status.ok{color:#166534;}
    .status.err{color:#b91c1c;}

    /* Disclaimer button */
    .disc-btn{position:fixed;left:18px;bottom:18px;z-index:15000;background:rgba(15,23,42,.85);backdrop-filter:blur(10px);border:1px solid rgba(148,196,255,.45);color:#e5e7eb;padding:10px 14px;border-radius:999px;font-weight:900;font-size:12px;cursor:pointer;box-shadow:0 16px 50px rgba(0,0,0,.6)}
    .disc-btn:hover{filter:brightness(1.06)}

    /* Disclaimer modal */
    .disc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:30000;}
    .disc-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:31000;overflow:auto;}
    .disc-card{width:min(880px,96vw);max-height:86vh;background:#ffffff;color:#0b1323;border-radius:22px;box-shadow:0 50px 130px rgba(0,0,0,.85);overflow:hidden;border:1px solid rgba(148,196,255,.35);position:relative;}
    .disc-card::before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(1200px 500px at 20% -10%, rgba(56,189,248,.18), transparent 55%),radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.14), transparent 55%);}
    .disc-head{position:relative;display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:linear-gradient(180deg,#0b1120,#0f172a);border-bottom:1px solid rgba(148,196,255,.25);color:#e5e7eb;}
    .disc-head h2{margin:0;font-size:16px;font-weight:900;letter-spacing:.01em;}
    .disc-kicker{margin:4px 0 0;font-size:12px;color:rgba(226,232,240,.9);font-weight:800;max-width:66ch;line-height:1.35;}
    .disc-icon{width:34px;height:34px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;border:1px solid rgba(148,196,255,.45);background:rgba(15,23,42,.5);box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:900;}
    .disc-head-left{display:flex;gap:12px;align-items:flex-start;}
    .disc-close{background:rgba(248,250,252,.06);border:1px solid rgba(148,196,255,.35);color:#e5e7eb;border-radius:12px;padding:8px 10px;font-weight:900;cursor:pointer;}
    .disc-close:hover{filter:brightness(1.08)}

    .disc-body{position:relative;padding:14px 16px 12px;font-size:14px;line-height:1.55;color:#0b1120;overflow:auto;max-height:calc(86vh - 62px - 74px);font-weight:700;}
    .disc-body p{margin:0 0 10px;font-weight:700;color:#0b1120;}
    .disc-body strong{font-weight:900;color:#020617;}
    .disc-sections{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:860px){.disc-sections{grid-template-columns:1fr;}}

    .disc-section{border:1px solid #e5e7eb;border-radius:16px;background:#ffffff;box-shadow:0 10px 26px rgba(0,0,0,.06);overflow:hidden;}
    .disc-sec-head{display:flex;gap:10px;align-items:flex-start;padding:12px 12px;background:linear-gradient(180deg,#ffffff,#f8fafc);border-bottom:1px solid #e5e7eb;}
    .disc-sec-badge{width:30px;height:30px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#0b1120;border:1px solid rgba(56,189,248,.35);background:rgba(56,189,248,.12);}
    .disc-sec-title{margin:0;font-size:13px;font-weight:900;color:#0b1120;}
    .disc-sec-sub{margin:2px 0 0;font-size:11px;color:#64748b;font-weight:800;line-height:1.35;}
    .disc-sec-body{padding:12px 12px 10px;font-size:13px;color:#0b1120;}
    .disc-sec-body ul{margin:0;padding-left:18px;display:grid;gap:8px;}
    .disc-sec-body li{margin:0;}

    .disc-footer-note{margin-top:12px;padding:12px;border-radius:16px;border:1px dashed rgba(15,23,42,.25);background:rgba(248,250,252,.9);font-size:12px;color:#0f172a;font-weight:800;}

    .disc-actions{position:relative;display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;background:linear-gradient(180deg,#f8fafc,#ffffff);border-top:1px solid #e5e7eb;}
    .disc-actions .btn{min-width:140px}
    .btn-accept{border:1px solid rgba(34,197,94,.35);background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.08));color:#0b1120;}
    .btn-accept:hover{filter:brightness(1.03)}

    /* Chat window */
    .chat-window{display:none;position:fixed;right:20px;bottom:100px;width:410px;max-height:72vh;background:#fff;color:#020617;border-radius:18px;box-shadow:0 40px 90px rgba(0,0,0,.8);overflow:hidden;z-index:10000;border:1px solid #e5e7eb}
    .chat-header{
      padding:12px 14px;
      background:linear-gradient(180deg,#0b1120,#0f172a);
      border-bottom:1px solid rgba(148,196,255,.25);
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:#e5e7eb;
    }
    .chat-header strong{font-weight:1000;letter-spacing:.02em}
    .chat-sub{font-size:11px;color:rgba(226,232,240,.85);font-weight:900;margin-top:2px}
    .close{background:rgba(248,250,252,.06);border:1px solid rgba(148,196,255,.35);color:#e5e7eb;border-radius:12px;padding:8px 10px;font-weight:1000;cursor:pointer}
    .close:hover{filter:brightness(1.08)}

    .chat-main{display:flex;flex-direction:column;height:calc(72vh - 52px);min-height:380px}
    .chat-messages{padding:12px;overflow:auto;flex:1;background:radial-gradient(900px 420px at 15% 0%, rgba(56,189,248,.08), transparent 55%), linear-gradient(180deg,#ffffff,#f8fafc)}
    .msg{display:flex;margin:10px 0}
    .msg.user{justify-content:flex-end}
    .msg.bot{justify-content:flex-start}
    .bubble{max-width:82%;padding:10px 12px;border-radius:14px;font-size:13.5px;line-height:1.45;box-shadow:0 10px 26px rgba(0,0,0,.08)}
    .bubble.user{background:#0b1120;color:#e5e7eb;border-top-right-radius:6px}
    .bubble.bot{background:#ffffff;color:#0f172a;border:1px solid #e5e7eb;border-top-left-radius:6px}
    .meta{font-size:10px;color:#64748b;font-weight:900;margin-top:6px}
    .chat-inputbar{padding:10px;border-top:1px solid #e5e7eb;background:#fff;display:flex;gap:10px;align-items:center}
    .chat-input{flex:1;padding:12px 12px;border-radius:14px;border:1px solid #cbd5e1;font-size:14px;outline:none}
    .chat-input:focus{border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.15)}
    .send-btn{padding:12px 14px;border-radius:14px;border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;font-weight:1000;cursor:pointer}
    .send-btn:disabled{opacity:.55;cursor:not-allowed}

    /* Chat lead capture */
    .lead-nudge{margin:10px 0 0;}
    .lead-card{border:1px solid #e5e7eb;background:#ffffff;border-radius:14px;padding:10px 10px;box-shadow:0 10px 26px rgba(0,0,0,.06)}
    .lead-title{font-weight:900;font-size:12.5px;color:#0b1120;margin:0 0 6px}
    .lead-sub{font-weight:800;font-size:11px;color:#64748b;margin:0 0 8px;line-height:1.35}
    .lead-row{display:flex;gap:8px;align-items:center}
    .lead-email{flex:1;padding:10px 10px;border-radius:12px;border:1px solid #cbd5e1;font-size:13px;outline:none}
    .lead-email:focus{border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.12)}
    .lead-btn{padding:10px 12px;border-radius:12px;border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;font-weight:900;cursor:pointer;white-space:nowrap}
    .lead-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;background:#f8fafc;color:#0b1120;border-radius:999px;padding:8px 10px;font-weight:900;font-size:12px;cursor:pointer}
    .chip:hover{filter:brightness(1.02)}
    .lead-ok{font-weight:900;font-size:11px;color:#166534;margin-top:8px;display:none}
    .lead-err{font-weight:900;font-size:11px;color:#b91c1c;margin-top:8px;display:none}

    .typing{display:inline-flex;gap:4px;align-items:center}
    .dot{width:6px;height:6px;border-radius:999px;background:#94a3b8;animation:bounce 1.1s infinite}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.3s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.5}40%{transform:translateY(-4px);opacity:1}}

    .close{background:none;border:none;font-size:18px;cursor:pointer}
  </style>
</head>

<body>

<section class="hero">
  <div class="hero-content">
    <span class="badge">Colorado home &amp; auto insurance</span>
    <h1>Get flexible home &amp; auto options that fit your budget and protect what matters.</h1>
    <p>Wildfires, hail, and severe weather are driving more claims across Colorado. We help you understand coverage options and smarter ways to stay protected.</p>
    <button class="cta" id="openFunnel" type="button">Check My Options</button>
  </div>

  <div class="alert-box">
    <div class="alert-title">Wildfires &amp; Hail Damage</div>
    <div class="alert-text">Colorado homes and cars are seeing more wildfire, hail, and severe-weather damage claims. Make sure you're covered for both to stay ahead of rising risks.</div>
  </div>

  <!-- PolicyPro positioned beneath alert -->
  <div class="chat-launcher" id="chatBtn" aria-label="Open PolicyPro chat" title="Ask PolicyProâ„¢ a question">
    <div class="chat-avatar">PP</div>
    <div>
      <div class="chat-label">Ask our</div>
      <div class="chat-name">PolicyProâ„¢</div>
    </div>
    <div class="pp-spark" aria-hidden="true"><span class="pp-dot"></span>Live help</div>
  </div>
</section>

<!-- Lead Funnel Modal (kept as fallback if CLICKFUNNEL_URL is blank) -->
<div class="modal-overlay" id="modalOverlay"></div>
<div class="modal" id="modal">
  <div class="card" role="dialog" aria-label="Options pre-check form">
    <div class="card-head">
      <div>
        <h2>Quick Options Preâ€‘Check</h2>
        <p>2 minutes. Not a quote. A licensed agent reviews and follows up with carrierâ€‘agnostic options.</p>
      </div>
      <button class="icon-btn" id="closeModal" type="button">âœ•</button>
    </div>
    <div class="card-body">
      <form id="leadForm">
        <div class="grid">
          <div class="field">
            <label for="firstName">First name *</label>
            <input id="firstName" name="firstName" autocomplete="given-name" required />
          </div>
          <div class="field">
            <label for="lastName">Last name *</label>
            <input id="lastName" name="lastName" autocomplete="family-name" required />
          </div>
          <div class="field">
            <label for="zip">ZIP *</label>
            <input id="zip" name="zip" inputmode="numeric" pattern="[0-9]{5}" placeholder="81501" required />
            <div class="hint">Example reference ZIP: 81501</div>
          </div>
          <div class="field">
            <label for="email">Email *</label>
            <input id="email" name="email" type="email" autocomplete="email" required />
          </div>
          <div class="field">
            <label for="phone">Mobile phone *</label>
            <input id="phone" name="phone" type="tel" autocomplete="tel" required />
          </div>
          <div class="field">
            <label for="homeowner">Home status *</label>
            <select id="homeowner" name="homeowner" required>
              <option value="">Selectâ€¦</option>
              <option>Own</option>
              <option>Rent</option>
              <option>Buying soon</option>
            </select>
          </div>
          <div class="field">
            <label for="roofAge">Roof age</label>
            <select id="roofAge" name="roofAge">
              <option value="">Selectâ€¦</option>
              <option>0-5</option><option>6-10</option><option>11-15</option><option>16-20</option><option>21+</option><option>Not sure</option>
            </select>
          </div>
          <div class="field">
            <label for="vehicles">Vehicles insured *</label>
            <select id="vehicles" name="vehicles" required>
              <option value="">Selectâ€¦</option>
              <option>1</option><option>2</option><option>3</option><option>4+</option>
            </select>
          </div>
          <div class="field">
            <label for="timeframe">When do you need this? *</label>
            <select id="timeframe" name="timeframe" required>
              <option value="">Selectâ€¦</option>
              <option>ASAP</option>
              <option>Within 7 days</option>
              <option>Within 30 days</option>
              <option>Just exploring</option>
            </select>
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" name="notes" placeholder="Any details that help (hail claim history, wildfire concerns, bundling, etc.)"></textarea>
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label style="display:flex;gap:10px;align-items:flex-start;font-weight:800;color:#0f172a;">
              <input id="consent" type="checkbox" required style="margin-top:2px;" />
              I agree to be contacted by phone, SMS, and email about insurance options. Msg &amp; data rates may apply.
            </label>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="cancelBtn" type="button">Cancel</button>
          <button class="btn btn-primary" id="submitBtn" type="submit">Submit</button>
        </div>
        <div class="status" id="formStatus"></div>
      </form>
    </div>
  </div>
</div>


<!-- Disclaimer launcher -->
<button class="disc-btn" id="openDisclaimer" type="button">Disclaimer</button>

<!-- Disclaimer modal -->
<div class="disc-overlay" id="discOverlay"></div>
<div class="disc-modal" id="discModal" role="dialog" aria-label="Legal disclaimer">
  <div class="disc-card">
    <div class="disc-head">
      <div class="disc-head-left">
        <div class="disc-icon">âš–</div>
        <div>
          <h2>Legal Disclaimer</h2>
          <div class="disc-kicker">Please review. This site includes AI-assisted information. <b>Human review is required</b> before any quote, application, binding, or policy change.</div>
        </div>
      </div>
      <button class="disc-close" id="discClose" type="button" aria-label="Close disclaimer">Close âœ•</button>
    </div>
    <div class="disc-body">
      <div class="disc-sections">

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">i</div>
            <div>
              <p class="disc-sec-title">General information only</p>
              <p class="disc-sec-sub">Not legal, tax, or financial advice</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>This page and <strong>PolicyProâ„¢</strong> provide <strong>general educational information</strong> about insurance concepts.</li>
              <li>Nothing here is legal advice, tax advice, or a substitute for professional guidance.</li>
              <li>Examples (including ZIP <strong>81501</strong>) are <strong>illustrative only</strong>.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">AI</div>
            <div>
              <p class="disc-sec-title">AI disclosure</p>
              <p class="disc-sec-sub">AI output can be wrong or incomplete</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li><strong>PolicyProâ„¢</strong> includes automated and artificialâ€‘intelligenceâ€“generated responses for general informational purposes.</li>
              <li>AI output may be incomplete, inaccurate, or outdated and must not be relied upon as a definitive statement of coverage, pricing, underwriting eligibility, or claim outcome.</li>
              <li>AI responses do <strong>not</strong> replace advice from a licensed insurance producer.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">âœ“</div>
            <div>
              <p class="disc-sec-title">Human review required</p>
              <p class="disc-sec-sub">Before quotes, applications, or changes</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Any quote indications, coverage discussions, or next steps require <strong>review and confirmation</strong> by a licensed insurance agent before any application is submitted or coverage is bound.</li>
              <li>Nothing on this page constitutes an offer to sell insurance or bind coverage.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">ðŸ›¡</div>
            <div>
              <p class="disc-sec-title">Coverage &amp; claims limitations</p>
              <p class="disc-sec-sub">Carrier rules and policy terms control</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Coverage, eligibility, rates, discounts, underwriting, and availability vary by carrier and are subject to policy terms, conditions, exclusions, limits, and deductibles.</li>
              <li>Claim scenario walkthroughs are general and may not apply to your situation. Always follow your policy and carrier instructions. If there is immediate danger, call emergency services.</li>
            </ul>
          </div>
        </section>

      </div>

      <div class="disc-footer-note">
        <strong>Consent &amp; privacy:</strong> By submitting your information, you authorize contact by phone, SMS, and email about insurance options (msg &amp; data rates may apply). Information may be stored in a secure Google Sheet and emailed to the business inbox for followâ€‘up. Do not submit sensitive information you do not want transmitted electronically.
      </div>
    </div>

    <div class="disc-actions">
      <button class="btn btn-accept" id="discAccept" type="button">I Accept</button>
      <button class="btn btn-primary" id="discClose2" type="button">Close</button>
    </div>
  </div>
</div>

<div class="chat-window" id="chatWindow">
  <div class="chat-header">
    <div>
      <strong>PolicyProâ„¢</strong>
      <div class="chat-sub">Ask a home or auto insurance question</div>
    </div>
    <button class="close" id="closeChat" aria-label="Close chat" type="button">âœ•</button>
  </div>

  <div class="chat-main">
    <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

    <!-- Lead capture inside chat (shown until email captured) -->
    <div class="lead-nudge" id="chatLeadNudge" style="display:none; padding: 0 12px 12px;">
      <div class="lead-card">
        <p class="lead-title">Want a personalized coverage checklist?</p>
        <p class="lead-sub">Drop your email and weâ€™ll send your hail + wildfire endorsements guide. Or click <b>Check My Options</b> for a fast preâ€‘check.</p>
        <div class="lead-row">
          <input class="lead-email" id="chatLeadEmail" type="email" placeholder="you@email.com" autocomplete="email" />
          <button class="lead-btn" id="chatLeadSave" type="button">Send guide</button>
        </div>
        <div class="lead-actions">
          <button class="chip" id="chatLeadOpenFunnel" type="button">âœ… Check My Options</button>
          <button class="chip" id="chatLeadNotNow" type="button">Not now</button>
        </div>
        <div class="lead-ok" id="chatLeadOk">âœ… Got it â€” check your inbox shortly.</div>
        <div class="lead-err" id="chatLeadErr">âš  Please enter a valid email.</div>
      </div>
    </div>

    <form class="chat-inputbar" id="chatForm" autocomplete="off">
      <input class="chat-input" id="chatInput" type="text" placeholder="Ask about hail deductibles, wildfire coverage, bundlingâ€¦" />
      <button class="send-btn" id="chatSend" type="submit">Send</button>
    </form>
  </div>
</div>

<script>
  // ===== Lead funnel + Google Apps Script backend =====
  var GAS = window.GAS_WEBAPP_URL || "";
  var CLICKFUNNEL_URL = (window.CLICKFUNNEL_URL || '').trim();

  var openFunnelBtn = document.getElementById('openFunnel');
  var modalOverlay = document.getElementById('modalOverlay');
  var modal = document.getElementById('modal');
  var closeModalBtn = document.getElementById('closeModal');
  var cancelBtn = document.getElementById('cancelBtn');
  var leadForm = document.getElementById('leadForm');
  var formStatus = document.getElementById('formStatus');

  function showModal(){ modalOverlay.style.display='block'; modal.style.display='flex'; }
  function hideModal(){ modalOverlay.style.display='none'; modal.style.display='none'; }

  if(closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
  if(cancelBtn) cancelBtn.addEventListener('click', hideModal);
  if(modalOverlay) modalOverlay.addEventListener('click', hideModal);

  function postJSON(url, payload){
    return fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).then(function(res){
      return res.text().then(function(t){
        var data;
        try{ data = JSON.parse(t); }catch(e){ data = { ok:false, error:'Non-JSON response', raw:t }; }
        if(!res.ok) throw new Error('HTTP ' + res.status + ' ' + (data && data.error ? data.error : ''));
        return data;
      });
    });
  }

  function leadScore(zip, timeframe){
    var score = 0;
    if(timeframe === 'ASAP') score += 35;
    else if(timeframe === 'Within 7 days') score += 25;
    else if(timeframe === 'Within 30 days') score += 10;

    if(zip === '81501') score += 20;
    else if(zip && zip.length === 5) score += 8;

    if(score > 100) score = 100;
    var label = (score >= 70) ? 'HOT' : (score >= 40 ? 'WARM' : 'COOL');
    return { score: score, label: label };
  }

  // ===== PolicyPro chat (UI + optional backend) =====
  var chatBtn = document.getElementById('chatBtn');
  var chatWindow = document.getElementById('chatWindow');
  var closeChat = document.getElementById('closeChat');
  var chatMessages = document.getElementById('chatMessages');
  var chatForm = document.getElementById('chatForm');
  var chatInput = document.getElementById('chatInput');
  var chatSend = document.getElementById('chatSend');

  // Where to send chat requests (optional). If blank, we fall back to on-page guidance.
  var CHAT_ENDPOINT = (window.POLICYPRO_LLM_ENDPOINT || '').trim() || (window.GAS_WEBAPP_URL || '').trim();

  var chatHistory = []; // minimal local memory

  // Lead capture state for chat
  var chatLeadNudge = document.getElementById('chatLeadNudge');
  var chatLeadEmail = document.getElementById('chatLeadEmail');
  var chatLeadSave = document.getElementById('chatLeadSave');
  var chatLeadOpenFunnel = document.getElementById('chatLeadOpenFunnel');
  var chatLeadNotNow = document.getElementById('chatLeadNotNow');
  var chatLeadOk = document.getElementById('chatLeadOk');
  var chatLeadErr = document.getElementById('chatLeadErr');

  function getStoredEmail_(){
    try{ return (localStorage.getItem('sc_chat_email') || '').trim(); }catch(e){ return ''; }
  }
  function setStoredEmail_(email){
    try{ localStorage.setItem('sc_chat_email', String(email||'')); }catch(e){}
  }
  function isEmail_(email){
    email = String(email||'').trim();
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function maybeShowChatLeadNudge_(){
    if(!chatLeadNudge) return;
    var stored = getStoredEmail_();
    if(stored){ chatLeadNudge.style.display = 'none'; return; }
    chatLeadNudge.style.display = 'block';
  }

  function hideChatLeadNudge_(){
    if(chatLeadNudge) chatLeadNudge.style.display = 'none';
  }

  function showLeadOk_(msg){
    if(chatLeadErr) chatLeadErr.style.display = 'none';
    if(chatLeadOk){
      chatLeadOk.textContent = msg || 'âœ… Got it â€” check your inbox shortly.';
      chatLeadOk.style.display = 'block';
    }
  }
  function showLeadErr_(msg){
    if(chatLeadOk) chatLeadOk.style.display = 'none';
    if(chatLeadErr){
      chatLeadErr.textContent = msg || 'âš  Please enter a valid email.';
      chatLeadErr.style.display = 'block';
    }
  }

  function submitChatEmailToBackend_(email){
    // Sends a lightweight "chat lead" so Apps Script can email a PDF/guide
    if(!GAS || GAS.indexOf('http') !== 0) return Promise.resolve({ ok:true, skipped:true });

    var payload = {
      action: 'chat_lead',
      source: 'GitHub Landing Page',
      channel: 'PolicyPro Chat',
      timestamp: new Date().toISOString(),
      email: email,
      aiConsent: true,
      deliverKit: true,
      kitType: 'FIRE_HAIL_ENDORSEMENTS'
    };

    return postJSON(GAS, payload);
  }

  function handleChatLeadSubmit_(){
    var email = chatLeadEmail ? chatLeadEmail.value : '';
    if(!isEmail_(email)){
      showLeadErr_('âš  Please enter a valid email (example: name@email.com).');
      return;
    }

    setStoredEmail_(email);
    showLeadOk_('âœ… Thanks! Sending your guide to ' + email + 'â€¦');

    submitChatEmailToBackend_(email).then(function(resp){
      if(resp && resp.ok === false) throw new Error(resp.error || 'Backend error');
      showLeadOk_('âœ… Sent! Check ' + email + ' (and spam/promotions).');
      setTimeout(hideChatLeadNudge_, 1200);
    }).catch(function(){
      showLeadOk_('âœ… Saved! We\'ll follow up at ' + email + '.');
      setTimeout(hideChatLeadNudge_, 1200);
    });
  }

  if(chatLeadSave) chatLeadSave.addEventListener('click', handleChatLeadSubmit_);
  if(chatLeadEmail) chatLeadEmail.addEventListener('keydown', function(e){
    if(e && e.key === 'Enter'){ e.preventDefault(); handleChatLeadSubmit_(); }
  });
  if(chatLeadOpenFunnel) chatLeadOpenFunnel.addEventListener('click', function(){
    hideChatLeadNudge_();
    if(openFunnelBtn) openFunnelBtn.click();
  });
  if(chatLeadNotNow) chatLeadNotNow.addEventListener('click', function(){
    hideChatLeadNudge_();
    try{ localStorage.setItem('sc_chat_nudge_dismissed', String(Date.now())); }catch(e){}
  });

  function esc_(s){
    s = String(s == null ? '' : s);
    return s.replace(/[&<>"']/g, function(c){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c] || c;
    });
  }

  function addMsg_(role, html){
    if(!chatMessages) return;
    var wrap = document.createElement('div');
    wrap.className = 'msg ' + (role === 'user' ? 'user' : 'bot');

    var b = document.createElement('div');
    b.className = 'bubble ' + (role === 'user' ? 'user' : 'bot');
    b.innerHTML = html;

    wrap.appendChild(b);
    chatMessages.appendChild(wrap);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function addTyping_(){
    addMsg_('bot', '<span class="typing" aria-label="PolicyPro is typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>');
  }

  function replaceLastBot_(html){
    if(!chatMessages) return;
    var items = chatMessages.querySelectorAll('.msg.bot .bubble');
    if(!items || !items.length) return;
    items[items.length-1].innerHTML = html;
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function seedChat_(){
    if(!chatMessages || chatMessages.childElementCount) return;
    addMsg_('bot',
      '<div><b>Hi â€” I\'m PolicyProâ„¢.</b> Ask me anything about Colorado home or auto insurance (hail deductibles, wildfire coverage, bundling, switching, etc.).</div>' +
      '<div class="meta">Example ZIP reference: <b>81501</b> (example only) â€¢ General info â€¢ Human review required</div>'
    );
    maybeShowChatLeadNudge_();
  }

  function openChat_(){
    if(chatWindow){ chatWindow.style.display = 'block'; }
    if(chatBtn){ chatBtn.style.display = 'none'; }
    seedChat_();
    setTimeout(function(){ if(chatInput) chatInput.focus(); }, 50);
  }

  function closeChat_(){
    if(chatWindow){ chatWindow.style.display = 'none'; }
    if(chatBtn){ chatBtn.style.display = 'flex'; }
  }

  if(chatBtn) chatBtn.addEventListener('click', openChat_);
  if(closeChat) closeChat.addEventListener('click', closeChat_);

  function classifyIntent_(q){
    var s = String(q||'').toLowerCase();
    var has = function(w){ return s.indexOf(w) !== -1; };

    if(has('hail')) return 'hail';
    if(has('wildfire') || has('fire') || has('smoke')) return 'wildfire';
    if(has('deductible')) return 'deductible';
    if(has('comprehensive') || has('comp ')) return 'auto_comp';
    if(has('collision')) return 'auto_collision';
    if(has('liability') || has('bodily injury') || has('property damage')) return 'liability';
    if(has('endorsement') || has('rider') || has('extra coverage')) return 'endorsements';
    if(has('rent') || has('renter') || has('apartment')) return 'renters';
    if(has('umbrella')) return 'umbrella';
    if(has('cancel') || has('lapse') || has('renewal')) return 'switching';
    if(has('bundle')) return 'bundle';
    if(has('claim')) return 'claims';
    if(has('cheapest') || has('save') || has('lower') || has('rate')) return 'price';

    return 'general';
  }

  function fallbackAnswer_(q){
    var intent = classifyIntent_(q);

    if(intent === 'hail'){
      return (
        '<b>Hail coverageâ€”here\'s what matters most:</b><br>' +
        'â€¢ <b>Home:</b> check whether your policy has a separate <b>wind/hail deductible</b> (often a %), and whether the roof settles as <b>Replacement Cost</b> or <b>Actual Cash Value</b> / a roof schedule.<br>' +
        'â€¢ <b>Auto:</b> hail is typically covered under <b>Comprehensive</b> (not Collision), subject to your comp deductible.<br><br>' +
        '<b>Quick tip:</b> If you\'re in a hail-prone area (example ZIP <b>81501</b>, for illustration), comparing deductibles + roof terms usually matters more than the headline premium.<br><br>' +
        '<b>To tailor this:</b> do you know your current wind/hail deductible (flat $ vs %) and roof age?'
      );
    }

    if(intent === 'wildfire'){
      return (
        '<b>Wildfire/smoke protectionâ€”focus on these coverage parts:</b><br>' +
        'â€¢ <b>Dwelling replacement cost</b> (and any <b>extended replacement</b> option)<br>' +
        'â€¢ <b>Loss of use</b> (temporary housing) limits<br>' +
        'â€¢ <b>Ordinance or Law</b> (code upgrades after a loss)<br>' +
        'â€¢ Underwriting items like <b>defensible space</b> and roof condition can affect eligibility in some areas.<br><br>' +
        '<b>Auto note:</b> wildfire-related vehicle damage is typically <b>Comprehensive</b> (heat/embers/smoke), subject to your comp deductible.<br><br>' +
        '<b>To tailor this:</b> homeowner vs renter, and how old is the roof?'
      );
    }

    if(intent === 'deductible'){
      return (
        '<b>Deductiblesâ€”direct breakdown:</b><br>' +
        'â€¢ <b>Home:</b> you may have multiple deductibles (All Other Perils + a separate wind/hail %). Lowering a wind/hail deductible can raise premium in CO.<br>' +
        'â€¢ <b>Auto:</b> Collision and Comprehensive deductibles are separate; higher deductibles reduce premium but increase out-of-pocket for hail/theft (comp) or at-fault crashes (collision).<br><br>' +
        '<b>Rule of thumb:</b> choose a deductible you can comfortably pay tomorrow, then shop carriers for roof terms + eligibility.<br><br>' +
        'What deductible are you aiming for (home + auto), and is your priority lowest cost or best hail terms?'
      );
    }

    if(intent === 'bundle'){
      return (
        '<b>Bundling home + auto:</b> It can improve pricing and sometimes eligibility, but it\'s only a win if coverage terms don\'t degrade.<br><br>' +
        '<b>What to compare:</b><br>' +
        'â€¢ Home wind/hail deductible + roof settlement method<br>' +
        'â€¢ Auto liability limits + comp/collision deductibles<br>' +
        'â€¢ Discounts that require both policies (multi-policy, homeowner, telematics, etc.)<br><br>' +
        'If you tell me your renewal date and roof age, I\'ll outline the cleanest way to switch without a lapse.'
      );
    }

    if(intent === 'switching'){
      return (
        '<b>Switching carriers (safe sequence):</b><br>' +
        '1) Bind the new policy first (confirm effective date + coverage).<br>' +
        '2) Verify lender/financed vehicle requirements and any escrow needs.<br>' +
        '3) Cancel the old policy only after the new one is active to avoid a lapse.<br><br>' +
        '<b>Common pitfall:</b> saving money but ending up with a worse hail deductible or roof settlement.<br><br>' +
        'What\'s your renewal date and what\'s the #1 thing you want to improve?'
      );
    }

    if(intent === 'renters'){
      return (
        '<b>Renters insurance (Colorado):</b> It typically covers your personal property, liability, and loss-of-use. It does <b>not</b> insure the building (that\'s the landlord).<br><br>' +
        '<b>Wildfire/hail angle:</b> smoke damage and evacuation/temporary housing is where loss-of-use limits matter.<br><br>' +
        'Do you want lowest cost or stronger liability + loss-of-use limits?'
      );
    }

    if(intent === 'endorsements'){
      return (
        '<b>Endorsements that often matter for hail + fire protection:</b><br>' +
        'â€¢ <b>Ordinance or Law</b> (code upgrade coverage)<br>' +
        'â€¢ <b>Extended replacement</b> (where available)<br>' +
        'â€¢ <b>Roof settlement upgrade</b> (Replacement Cost vs schedule/ACV)<br>' +
        'â€¢ <b>Loss of use</b> adequacy (often overlooked)<br><br>' +
        'If you share homeowner vs renter + roof age, I\'ll prioritize what to ask for first.'
      );
    }

    return (
      '<b>I can helpâ€”what specific question do you have?</b><br><br>' +
      '<b>Example context (illustration only):</b> In ZIP <b>81501</b>, comparing wind/hail deductibles and roof terms can matter a lot because severe weather losses can impact pricing and eligibility.<br><br>' +
      '<b>To tailor your answer:</b> homeowner vs renter, roof age, and number of vehicles?'
    );
  }

  function sendChat_(text){
    var q = (text||'').trim();
    if(!q) return;

    addMsg_('user', esc_(q));
    chatHistory.push({ role:'user', content:q });

    addTyping_();

    // After the user engages, show the email/CTA nudge if we don't have their email yet
    setTimeout(maybeShowChatLeadNudge_, 250);

    if(!CHAT_ENDPOINT || CHAT_ENDPOINT.indexOf('http') !== 0){
      var ans = fallbackAnswer_(q);
      chatHistory.push({ role:'assistant', content: ans.replace(/<[^>]*>/g,'') });
      replaceLastBot_(ans + '<div class="meta">General info â€¢ Not a quote â€¢ Human review required</div>');
      return;
    }

    var systemPrompt = "You are PolicyProâ„¢, a licensed-insurance-agent style assistant for Colorado home & auto insurance. Give direct, professional, carrier-agnostic answers to the user's exact question. Avoid tables. Use short paragraphs + bullets when helpful. Always include: (1) the direct answer, (2) key limits/caveats (not a quote; human review required), and (3) at most 1â€“2 targeted follow-up questions if truly needed. Reference ZIP 81501 only as an illustrative example when relevant.";

    var payloadChat = {
      action: 'chat',
      system: systemPrompt,
      message: q,
      history: chatHistory.slice(-12),
      zipExample: '81501',
      channel: 'PolicyPro Chat'
    };

    fetch(CHAT_ENDPOINT, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payloadChat)
    }).then(function(res){
      return res.text().then(function(t){
        var obj;
        try{ obj = JSON.parse(t); }catch(e){ obj = null; }
        if(!res.ok) throw new Error('HTTP ' + res.status);

        var reply = '';
        if(obj){
          if(typeof obj.reply === 'string') reply = obj.reply;
          else if(typeof obj.message === 'string') reply = obj.message;
          else if(typeof obj.output_text === 'string') reply = obj.output_text;
          else if(obj.choices && obj.choices[0] && obj.choices[0].message && typeof obj.choices[0].message.content === 'string') reply = obj.choices[0].message.content;
        }
        if(!reply) reply = fallbackAnswer_(q);

        chatHistory.push({ role:'assistant', content: reply });
        replaceLastBot_(esc_(reply).replace(/\r?\n/g, '<br>') + '<div class="meta">General info â€¢ Not a quote â€¢ Human review required</div>');
      });
    }).catch(function(){
      var ans2 = fallbackAnswer_(q);
      chatHistory.push({ role:'assistant', content: ans2.replace(/<[^>]*>/g,'') });
      replaceLastBot_(ans2 + '<div class="meta">General info â€¢ Not a quote â€¢ Human review required</div>');
    });
  }

  if(chatForm){
    chatForm.addEventListener('submit', function(e){
      e.preventDefault();
      if(chatSend) chatSend.disabled = true;
      var q = chatInput ? chatInput.value : '';
      if(chatInput) chatInput.value = '';
      sendChat_(q);
      setTimeout(function(){ if(chatSend) chatSend.disabled = false; if(chatInput) chatInput.focus(); }, 50);
    });
  }

  // ===== Disclaimer modal =====
  var openDisclaimer = document.getElementById('openDisclaimer');
  var discOverlay = document.getElementById('discOverlay');
  var discModal = document.getElementById('discModal');
  var discClose = document.getElementById('discClose');
  var discClose2 = document.getElementById('discClose2');
  var discAccept = document.getElementById('discAccept');

  function showDisclaimer(){
    discOverlay.style.display = 'block';
    discModal.style.display = 'flex';
  }
  function hideDisclaimer(){
    discOverlay.style.display = 'none';
    discModal.style.display = 'none';
  }
  function acceptDisclaimer(){
    try{ localStorage.setItem('sc_disclaimer_accepted','1'); }catch(e){}
    hideDisclaimer();

    // If the user clicked a gated action (like "Check My Options"), continue after acceptance.
    if(window.__sc_pendingOpenOptions){
      window.__sc_pendingOpenOptions = false;
      openOptionsFlow_();
    }
  }

  // Track whether we should continue into the lead flow after the user accepts.
  window.__sc_pendingOpenOptions = false;

  if(openDisclaimer) openDisclaimer.addEventListener('click', showDisclaimer);
  if(discOverlay) discOverlay.addEventListener('click', hideDisclaimer);
  if(discClose) discClose.addEventListener('click', hideDisclaimer);
  if(discClose2) discClose2.addEventListener('click', hideDisclaimer);
  if(discAccept) discAccept.addEventListener('click', acceptDisclaimer);

  // Require disclaimer acceptance before opening the lead form OR ClickFunnels
  function openOptionsFlow_(){
    // If ClickFunnels is configured, open that (recommended). Otherwise fall back to the on-page modal.
    if(CLICKFUNNEL_URL && CLICKFUNNEL_URL.indexOf('http') === 0){
      // Open in same tab for mobile friendliness. Change to window.open(...) if you prefer new tab.
      window.location.href = CLICKFUNNEL_URL;
      return;
    }
    showModal();
  }

  if(openFunnelBtn) openFunnelBtn.addEventListener('click', function(){
    var accepted = false;
    try{ accepted = (localStorage.getItem('sc_disclaimer_accepted') === '1'); }catch(e){ accepted = false; }

    if(!accepted){
      // Only show the disclaimer when it's required (before opening the lead flow)
      window.__sc_pendingOpenOptions = true;
      showDisclaimer();
      return;
    }

    openOptionsFlow_();
  });

  // NOTE: We do NOT auto-show the disclaimer on page load.
  // It appears only when needed (before "Check My Options") or when the user clicks the Disclaimer button.

  if(leadForm){
    leadForm.addEventListener('submit', function(e){
      e.preventDefault();
      formStatus.style.display='block';
      formStatus.className='status';

      if(!GAS || GAS.indexOf('http') !== 0){
        formStatus.className='status err';
        formStatus.textContent='Backend not connected yet. Paste your Apps Script Web App URL into window.GAS_WEBAPP_URL at the top of this file.';
        return;
      }

      var payloadLead = {
        action: 'lead',
        source: 'GitHub Landing Page',
        channel: 'CTA Funnel',
        timestamp: new Date().toISOString(),
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        homeowner: document.getElementById('homeowner').value,
        roofAge: document.getElementById('roofAge').value,
        vehicles: document.getElementById('vehicles').value,
        timeframe: document.getElementById('timeframe').value,
        notes: document.getElementById('notes').value.trim(),
        consent: true,
        aiConsent: true,
        deliverKit: true,
        kitType: 'FIRE_HAIL_ENDORSEMENTS'
      };

      var scored = leadScore(payloadLead.zip, payloadLead.timeframe);
      payloadLead.leadScore = scored.score;
      payloadLead.leadLabel = scored.label;

      formStatus.textContent='Submittingâ€¦';

      postJSON(GAS, payloadLead).then(function(resp){
        if(resp && resp.ok === false) throw new Error(resp.error || 'Webhook error');
        formStatus.className='status ok';
        formStatus.textContent='âœ… Submitted! Check your email for your coverage guide.';
        leadForm.reset();
        setTimeout(hideModal, 900);
      }).catch(function(err){
        formStatus.className='status err';
        formStatus.textContent='âš  Could not submit. Verify Apps Script is deployed as a Web App with access set to â€œAnyoneâ€. (' + (err && err.message ? err.message : 'Error') + ')';
      });
    });
  }

  // ===== Tiny self-tests (safe in production; only logs to console) =====
  (function(){
    try{
      console.assert(esc_('<>&"\'') === '&lt;&gt;&amp;&quot;&#39;', 'esc_ should escape HTML');
      console.assert(isEmail_('a@b.co') === true, 'isEmail_ basic should pass');
      console.assert(isEmail_('nope') === false, 'isEmail_ basic should fail');
      var sample = 'a\n b\r\n c';
      var out = sample.replace(/\r?\n/g, '<br>');
      console.assert(out.indexOf('<br>') !== -1, 'newline regex should work');
      var lsOk = true;
      try{ localStorage.setItem('_t','1'); localStorage.removeItem('_t'); }catch(e){ lsOk = false; }
      console.assert(lsOk === true || lsOk === false, 'localStorage check ran');
    }catch(e){ /* no-op */ }
  })();
</script>

</body>
</html>
