<!DOCTYPE html>
<html lang="en" id="docHtml">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colorado Relief Options ‚Äî Home &amp; Auto Insurance</title>
  <meta name="description" content="Colorado residents: explore flexible home &amp; auto insurance options designed to protect your budget and peace of mind. Bundle, save, and see if you qualify for custom rate relief or flexible payments." />

  <!-- ================= QUICK SETUP =================
  REQUIRED FILES IN SAME FOLDER:
  - index.html
  - hero-house.jpg        (modern Colorado mountain home with pine trees + fire pit)
  - hero-auto.jpg         (SUV + truck in mountain setting)
  - hero-business.jpg     (business / commercial scene)
  ================================================== -->

  <script>
    // === REQUIRED: paste your deployed Google Apps Script Web App URL here ===
    window.GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyWoyQwiNZGLj7Bh-8Hap2rceF-3XWTP5mqpkjRpN5MwWmKLY1eQcDSmrw_IjS5avJ_XA/exec";

    // Optional separate LLM endpoint (usually leave blank to reuse GAS)
    window.POLICYPRO_LLM_ENDPOINT = "";

    // ‚úÖ Default: run PolicyPro in LOCAL mode (no API keys required)
    window.POLICYPRO_MODE = "local";

    // Tracking (optional)
    window.GA4_MEASUREMENT_ID = "";
    window.GOOGLE_ADS_ID = "";
    window.GOOGLE_ADS_CONVERSION_LABEL = "";
    window.META_PIXEL_ID = "";

    window.AGENT_EMAIL = "securechoicein@gmail.com";

    // === ClickFunnels (recommended for "Check My Options") ===
    window.CLICKFUNNEL_URL = "";
  </script>

  <!-- Preload hero images for smoother first paint -->
  <link rel="preload" as="image" href="hero-house.jpg">
  <link rel="preload" as="image" href="hero-auto.jpg">
  <link rel="preload" as="image" href="hero-business.jpg">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --card:#0f172a;
      --line:rgba(148,196,255,.35);
      --brand:#38bdf8;
      --brand2:#0ea5e9;
      --ok:#22c55e;
      --warn:#facc15;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:#0b1323;
      color:#e5e7eb;
      overflow-x:hidden;
    }

    /* HERO */
    .hero{
      position:relative;
      min-height:90vh;
      display:flex;
      align-items:center;
      padding:48px;
      overflow:hidden;
      isolation:isolate;
    }

    /* Dark overlay so text stays readable on photos */
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(rgba(5,10,25,.74),rgba(5,10,25,.74));
      z-index:1;
      pointer-events:none;
    }

    /* Rotating background slides (Option A: pure CSS) */
    .hero-rotator{
      position:absolute;
      inset:0;
      z-index:0;
      pointer-events:none;
    }
    .hero-slide{
      position:absolute;
      inset:0;
      background-size:cover;
      background-position:center;
      opacity:0;
      transform:scale(1.03);
      filter:saturate(1.05) contrast(1.05);
      animation:heroFade 9s infinite linear;
    }
    .hero-slide:nth-child(1){ animation-delay:0s; }
    .hero-slide:nth-child(2){ animation-delay:3s; }
    .hero-slide:nth-child(3){ animation-delay:6s; }

    @keyframes heroFade{
      0%{ opacity:0; }
      10%{ opacity:1; }
      30%{ opacity:1; }
      40%{ opacity:0; }
      100%{ opacity:0; }
    }

    /* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce){
      .hero-slide{ animation:none; opacity:0; }
      .hero-slide:nth-child(1){ opacity:1; }
    }

    .hero-content{position:relative;max-width:680px;z-index:2}
    .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:rgba(56,189,248,.15);border:1px solid rgba(56,189,248,.4);font-size:12px;font-weight:700;color:#c7e9ff}
    h1{font-size:clamp(32px,5vw,52px);margin:18px 0;line-height:1.1}

    /* Hero header (uses the same font as the PP mark) */
    .hero-headline{
      margin:0 0 18px;
      font-size:clamp(40px,6vw,72px);
      line-height:1.02;
      letter-spacing:.01em;
      color:#ffffff;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
      font-weight:700;
      text-shadow:0 18px 70px rgba(0,0,0,.55);
    }

    /* (Hero paragraph removed per request) */
    .cta{margin-top:24px;padding:14px 28px;font-size:16px;font-weight:800;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(180deg,#38bdf8,#0ea5e9);color:#020617}

    /* Alert */
    .alert-box{position:absolute;right:10%;bottom:35%;width:240px;background:rgba(15,23,42,.92);border-radius:14px;padding:14px;border:1px solid rgba(148,196,255,.55);box-shadow:0 20px 50px rgba(0,0,0,.6);z-index:2}
    .alert-title{font-size:11px;text-transform:uppercase;letter-spacing:.14em;color:#facc15;margin-bottom:6px}
    .alert-text{font-size:13px;color:#e5e7eb;line-height:1.35}

    /* ================== CHAT: Channel.io-like launcher ==================
       Bottom-right floating bubble + subtle label.
    */

    .chat-launcher{
      position:fixed;
      right:20px;
      bottom:22px;
      z-index:26000;
      display:flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .chat-peek{
      display:flex;
      flex-direction:column;
      gap:2px;
      padding:10px 12px;
      border-radius:14px;
      background:#ffffff; /* match chatbox */
      border:1px solid #e5e7eb;
      backdrop-filter:blur(10px);
      box-shadow:0 18px 55px rgba(0,0,0,.25);
    }
    .chat-peek .chat-label{
      font-size:11px;
      opacity:.85;
      font-weight:700;
      color:#0b1120; /* black lettering */
      letter-spacing:.01em;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
    }
    .chat-peek .chat-name{
      font-weight:700;
      font-size:13px;
      letter-spacing:.01em;
      color:#0b1120; /* black lettering */
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
    }

    .chat-bubble{
      width:56px;height:56px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      background:#ffffff;
      border:1px solid #e5e7eb;
      box-shadow:0 22px 70px rgba(0,0,0,.25);
      position:relative;
      transition:transform .18s ease, filter .18s ease;
      animation: chatPulse 2.6s ease-in-out infinite;
    }
    .chat-bubble:hover{transform:translateY(-2px) scale(1.03);filter:brightness(1.06)}
    .chat-bubble:active{transform:translateY(0) scale(0.99)}

    .chat-avatar{
      width:44px;height:44px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      font-family:'Playfair Display', 'Didot', 'Bodoni MT', serif;
      font-weight:600;
      font-size:22px;
      color:#020617;
      background:#ffffff;
    }

    @keyframes chatPulse{
      0%{ box-shadow:0 22px 70px rgba(0,0,0,.25), 0 0 0 0 rgba(2,6,23,.15); }
      50%{ box-shadow:0 22px 70px rgba(0,0,0,.25), 0 0 0 12px rgba(2,6,23,0); }
      100%{ box-shadow:0 22px 70px rgba(0,0,0,.25), 0 0 0 0 rgba(2,6,23,0); }
    }

    /* ================== CHAT WIDGET (ChannelTalk-like) ==================
       Compact widget with:
       - Photo header
       - White rounded body
       - Bottom tabs: Home / Messages / Settings
       - Separate round close button bottom-right
    */

    .chat-window{
      display:none;
      position:fixed;
      right:20px;
      bottom:96px;
      width:360px;
      max-height:78vh;
      z-index:25000;
    }

    .pp-widget{
      width:100%;
      background:#fff;
      color:#0b1120;
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.10);
      box-shadow:0 40px 120px rgba(0,0,0,.42);
    }

    .pp-top{
      position:relative;
      height:150px;
      background:
        linear-gradient(180deg, rgba(2,6,23,0) 40%, rgba(2,6,23,.45) 100%),
        url('hero-house.jpg') center/cover no-repeat;
    }

    .pp-topbar{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:14px 14px 12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }

    .pp-brand{
      color:#fff;
      font-weight:900;
      letter-spacing:.01em;
      font-size:18px;
      text-shadow:0 8px 30px rgba(0,0,0,.55);
    }

    .pp-body{padding:12px 14px 10px;background:#fff;}

    .pp-screen{ display:none; }
    .pp-screen.active{ display:block; }

    .pp-home-card{
      border:1px solid #eef2f7;
      border-radius:18px;
      padding:12px 12px;
      background:#fff;
      box-shadow:0 14px 40px rgba(2,6,23,.06);
    }

    .pp-home-row{display:flex;gap:10px;align-items:flex-start}
    .pp-avatar{
      width:38px;height:38px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      border:1px solid #e5e7eb;
      background:#fff;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
      font-weight:700;
      color:#0b1120;
      flex:0 0 auto;
    }

    .pp-home-title{margin:0;font-weight:900;font-size:13.5px;line-height:1.25}
    .pp-home-sub{margin:6px 0 0;color:#475569;font-weight:700;font-size:12px;line-height:1.35}

    .pp-primary{
      width:100%;
      margin-top:12px;
      padding:12px 12px;
      border-radius:999px;
      border:1px solid #eef2f7;
      background:#f3f4f6;
      color:#0b1120;
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .pp-primary:hover{filter:brightness(1.01)}

    .pp-footer-note{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      color:#94a3b8;
      font-weight:800;
      font-size:11px;
    }

    .pp-messages-wrap{
      border:1px solid #eef2f7;
      border-radius:18px;
      overflow:hidden;
      background:#fff;
    }

    .chat-main{
      display:flex;
      flex-direction:column;
      height:360px;
      min-height:320px;
    }

    .chat-messages{
      padding:12px;
      overflow:auto;
      flex:1;
      background:#ffffff;
    }

    .msg{display:flex;margin:10px 0}
    .msg.user{justify-content:flex-end}
    .msg.bot{justify-content:flex-start}
    .bubble{max-width:86%;padding:10px 12px;border-radius:14px;font-size:13.5px;line-height:1.45;box-shadow:0 10px 26px rgba(0,0,0,.06)}
    .bubble.user{background:#0b1120;color:#e5e7eb;border-top-right-radius:6px}
    .bubble.bot{background:#ffffff;color:#0f172a;border:1px solid #e5e7eb;border-top-left-radius:6px}
    .meta{font-size:10px;color:#64748b;font-weight:900;margin-top:6px}

    .chat-inputbar{padding:10px;border-top:1px solid #eef2f7;background:#fff;display:flex;gap:10px;align-items:center}
    .chat-input{flex:1;padding:12px 12px;border-radius:14px;border:1px solid #cbd5e1;font-size:14px;outline:none}
    .chat-input:focus{border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.12)}
    .send-btn{padding:12px 14px;border-radius:14px;border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;font-weight:1000;cursor:pointer}
    .send-btn:disabled{opacity:.55;cursor:not-allowed}

    /* Suggested question chips (ChannelTalk-like) */
    .pp-suggest-wrap{padding:14px 14px 10px;}
    .pp-suggest-title{
      font-weight:1000;
      font-size:12px;
      color:#0b1120;
      margin:0 0 12px;
      letter-spacing:.01em;
      text-align:left;
    }

    .pp-suggest-section{display:grid;gap:10px;margin-bottom:14px;}
    .pp-suggest-label{
      font-weight:1000;
      font-size:11px;
      color:#94a3b8;
      letter-spacing:.08em;
    }

    .pp-suggest-grid{display:flex;flex-wrap:wrap;gap:10px;}

    .pp-suggest-chip{
      border:1px solid #e2e8f0;
      background:#f8fafc;
      color:#0b1120;
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      font-size:12.5px;
      cursor:pointer;
      line-height:1.25;
      box-shadow:0 12px 26px rgba(2,6,23,.06);
      transition:transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }
    .pp-suggest-chip:hover{filter:brightness(1.01);transform:translateY(-1px)}
    .pp-suggest-chip:active{transform:translateY(0)}

    @media (max-width: 420px){
      .pp-suggest-grid{gap:8px;}
      .pp-suggest-chip{width:100%;text-align:left;}
    }

    .pp-tabs{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      border-top:1px solid #eef2f7;
      background:#fff;
      padding:8px 6px;
    }

    .pp-tab{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      padding:8px 6px;
      border-radius:14px;
      border:0;
      background:transparent;
      cursor:pointer;
      color:#64748b;
      font-weight:900;
      font-size:11px;
    }

    .pp-tab svg{width:18px;height:18px;opacity:.75;transition:transform .15s ease, opacity .15s ease}

    /* Nicer Settings gear */
    .pp-tab#ppTabSettings svg{
      width:19px;
      height:19px;
      stroke-width:1.8;
    }
    .pp-tab#ppTabSettings:hover svg{opacity:.95;transform:rotate(20deg)}
    .pp-tab#ppTabSettings.active svg{opacity:1;transform:rotate(0deg)}

    .pp-tab.active{color:#0b1120;background:#f8fafc;}
    .pp-tab:hover{color:#0b1120;background:#f8fafc}

    .pp-close-fab{
      position:absolute;
      right:10px;
      bottom:-62px;
      width:48px;height:48px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#fff;
      color:#0b1120;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      font-weight:900;
    }
    .pp-close-fab:hover{filter:brightness(1.02)}

    .pp-settings{
      border:1px solid #eef2f7;
      border-radius:18px;
      padding:12px 12px;
      background:#fff;
    }
    .pp-settings h3{margin:0 0 10px;font-size:13.5px;font-weight:1000;color:#0b1120}
    .pp-setting-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 10px;border:1px solid #eef2f7;border-radius:14px;background:#fff;margin-bottom:10px}
    .pp-select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      border:1px solid #e2e8f0;
      background:#f8fafc;
      color:#0b1120;
      font-weight:900;
      font-size:12px;
      border-radius:12px;
      padding:10px 34px 10px 12px;
      cursor:pointer;
      line-height:1;
      box-shadow:0 10px 22px rgba(2,6,23,.05);
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23647569' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 10px center;
      background-size:18px 18px;
    }
    .pp-select:focus{outline:none;border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.12)}
    .pp-select:hover{filter:brightness(1.01)}
    .pp-setting-item .k{font-weight:900;color:#0b1120;font-size:12px}
    .pp-setting-item .v{font-weight:900;color:#64748b;font-size:12px}
    .pp-setting-link{display:block;text-align:center;margin-top:6px;color:#0ea5e9;font-weight:1000;text-decoration:none}

    .typing{display:inline-flex;gap:4px;align-items:center}
    .dot{width:6px;height:6px;border-radius:999px;background:#94a3b8;animation:bounce 1.1s infinite}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.3s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.5}40%{transform:translateY(-4px);opacity:1}}

    @media (max-width: 900px){
      .hero{padding:18px;min-height:100vh;align-items:flex-start;padding-top:72px;}
      .hero-content{max-width:100%;padding-bottom:90px;}
      h1{font-size:clamp(28px,8vw,42px);margin:14px 0 12px;}
      p{font-size:16px;line-height:1.55;margin-bottom:18px;}

      .cta{width:100%;max-width:520px;margin-top:10px;margin-bottom:18px;}
      .alert-box{position:relative;right:auto;bottom:auto;width:100%;max-width:520px;margin-top:18px;}

      .chat-launcher{right:14px;bottom:calc(14px + env(safe-area-inset-bottom));}
      .chat-peek{display:none;}

      .chat-window{left:12px;right:12px;width:auto;bottom:calc(86px + env(safe-area-inset-bottom));max-height:78vh;}

      .disc-btn{left:14px;right:auto;bottom:calc(14px + env(safe-area-inset-bottom));padding:8px 12px;font-size:11px;z-index:26000;opacity:.92;}
    }

    /* Funnel modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:20000;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:21000;}
    .card{width:min(760px,96vw);background:#ffffff;color:#0b1323;border-radius:18px;box-shadow:0 40px 100px rgba(0,0,0,.8);overflow:hidden;border:1px solid #e5e7eb;}
    .card-head{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:#f8fafc;border-bottom:1px solid #e5e7eb;}
    .card-head h2{margin:0;font-size:16px;font-weight:900;}
    .card-head p{margin:2px 0 0;font-size:12px;color:#475569;max-width:none;}
    .icon-btn{background:transparent;border:none;font-size:18px;cursor:pointer;color:#475569;}
    .card-body{padding:14px 16px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:740px){.grid{grid-template-columns:1fr;}}
    .field{display:grid;gap:6px;}
    .field label{font-size:12px;font-weight:900;color:#0f172a;}
    .field input,.field select,.field textarea{padding:12px;border-radius:12px;border:1px solid #cbd5e1;font-size:14px;}
    .field textarea{resize:vertical;min-height:90px;}
    .hint{font-size:11px;color:#64748b;font-weight:700;}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px;}
    .btn{padding:12px 14px;border-radius:12px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:900;}
    .btn-primary{border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;}
    .status{display:none;margin-top:10px;font-size:12px;font-weight:800;}
    .status.ok{color:#166534;}
    .status.err{color:#b91c1c;}

    /* Disclaimer button */
    .disc-btn{position:fixed;left:18px;bottom:18px;z-index:15000;background:rgba(15,23,42,.85);backdrop-filter:blur(10px);border:1px solid rgba(148,196,255,.45);color:#e5e7eb;padding:10px 14px;border-radius:999px;font-weight:900;font-size:12px;cursor:pointer;box-shadow:0 16px 50px rgba(0,0,0,.6)}
    .disc-btn:hover{filter:brightness(1.06)}

    /* Disclaimer modal */
    .disc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:30000;}
    .disc-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:31000;overflow:auto;}
    .disc-card{width:min(880px,96vw);max-height:86vh;background:#ffffff;color:#0b1323;border-radius:22px;box-shadow:0 50px 130px rgba(0,0,0,.85);overflow:hidden;border:1px solid rgba(148,196,255,.35);position:relative;}
    .disc-card::before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(1200px 500px at 20% -10%, rgba(56,189,248,.18), transparent 55%),radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.14), transparent 55%);}
    .disc-head{position:relative;display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:linear-gradient(180deg,#0b1120,#0f172a);border-bottom:1px solid rgba(148,196,255,.25);color:#e5e7eb;}
    .disc-head h2{margin:0;font-size:16px;font-weight:900;letter-spacing:.01em;}
    .disc-kicker{margin:4px 0 0;font-size:12px;color:rgba(226,232,240,.9);font-weight:800;max-width:66ch;line-height:1.35;}
    .disc-icon{width:34px;height:34px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;border:1px solid rgba(148,196,255,.45);background:rgba(15,23,42,.5);box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:900;}
    .disc-head-left{display:flex;gap:12px;align-items:flex-start;}
    .disc-close{background:rgba(248,250,252,.06);border:1px solid rgba(148,196,255,.35);color:#e5e7eb;border-radius:12px;padding:8px 10px;font-weight:900;cursor:pointer;}
    .disc-close:hover{filter:brightness(1.08)}

    .disc-body{position:relative;padding:14px 16px 12px;font-size:14px;line-height:1.55;color:#0b1120;overflow:auto;max-height:calc(86vh - 62px - 74px);font-weight:700;}
    .disc-body p{margin:0 0 10px;font-weight:700;color:#0b1120;}
    .disc-body strong{font-weight:900;color:#020617;}
    .disc-sections{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:860px){.disc-sections{grid-template-columns:1fr;}}

    .disc-section{border:1px solid #e5e7eb;border-radius:16px;background:#ffffff;box-shadow:0 10px 26px rgba(0,0,0,.06);overflow:hidden;}
    .disc-sec-head{display:flex;gap:10px;align-items:flex-start;padding:12px 12px;background:linear-gradient(180deg,#ffffff,#f8fafc);border-bottom:1px solid #e5e7eb;}
    .disc-sec-badge{width:30px;height:30px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#0b1120;border:1px solid rgba(56,189,248,.35);background:rgba(56,189,248,.12);}
    .disc-sec-title{margin:0;font-size:13px;font-weight:900;color:#0b1120;}
    .disc-sec-sub{margin:2px 0 0;font-size:11px;color:#64748b;font-weight:800;line-height:1.35;}
    .disc-sec-body{padding:12px 12px 10px;font-size:13px;color:#0b1120;}
    .disc-sec-body ul{margin:0;padding-left:18px;display:grid;gap:8px;}
    .disc-sec-body li{margin:0;}

    .disc-footer-note{margin-top:12px;padding:12px;border-radius:16px;border:1px dashed rgba(15,23,42,.25);background:rgba(248,250,252,.9);font-size:12px;color:#0f172a;font-weight:800;}

    .disc-actions{position:relative;display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;background:linear-gradient(180deg,#f8fafc,#ffffff);border-top:1px solid #e5e7eb;}
    .disc-actions .btn{min-width:140px}
    .btn-accept{border:1px solid rgba(34,197,94,.35);background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.08));color:#0b1120;}
    .btn-accept:hover{filter:brightness(1.03)}
  </style>
</head>

<body>

<section class="hero">
  <!-- Rotating background images -->
  <div class="hero-rotator" aria-hidden="true">
    <div class="hero-slide" style="background-image:url('hero-house.jpg')"></div>
    <div class="hero-slide" style="background-image:url('hero-auto.jpg')"></div>
    <div class="hero-slide" style="background-image:url('hero-business.jpg')"></div>
  </div>

  <div class="hero-content">
    <h1 class="hero-headline" id="heroHeader" data-i18n="hero_header_home">Home Insurance</h1>
    <button class="cta" id="openFunnel" type="button" data-i18n="cta_check">Check My Options</button>
  </div>
</section>

<!-- Lead Funnel Modal (fallback if CLICKFUNNEL_URL is blank) -->
<div class="modal-overlay" id="modalOverlay"></div>
<div class="modal" id="modal">
  <div class="card" role="dialog" aria-label="Options pre-check form">
    <div class="card-head">
      <div>
        <h2>Quick Options Pre-Check</h2>
        <p>2 minutes. Not a quote. A licensed agent reviews and follows up with carrier-agnostic options.</p>
      </div>
      <button class="icon-btn" id="closeModal" type="button">‚úï</button>
    </div>
    <div class="card-body">
      <form id="leadForm">
        <div class="grid">
          <div class="field">
            <label for="firstName">First name *</label>
            <input id="firstName" name="firstName" autocomplete="given-name" required />
          </div>
          <div class="field">
            <label for="lastName">Last name *</label>
            <input id="lastName" name="lastName" autocomplete="family-name" required />
          </div>
          <div class="field">
            <label for="zip">ZIP *</label>
            <input id="zip" name="zip" inputmode="numeric" pattern="[0-9]{5}" placeholder="81501" required />
            <div class="hint">Example reference ZIP: 81501</div>
          </div>
          <div class="field">
            <label for="email">Email *</label>
            <input id="email" name="email" type="email" autocomplete="email" required />
          </div>
          <div class="field">
            <label for="phone">Mobile phone *</label>
            <input id="phone" name="phone" type="tel" autocomplete="tel" required />
          </div>
          <div class="field">
            <label for="homeowner">Home status *</label>
            <select id="homeowner" name="homeowner" required>
              <option value="">Select‚Ä¶</option>
              <option>Own</option>
              <option>Rent</option>
              <option>Buying soon</option>
            </select>
          </div>
          <div class="field">
            <label for="roofAge">Roof age</label>
            <select id="roofAge" name="roofAge">
              <option value="">Select‚Ä¶</option>
              <option>0-5</option><option>6-10</option><option>11-15</option><option>16-20</option><option>21+</option><option>Not sure</option>
            </select>
          </div>
          <div class="field">
            <label for="vehicles">Vehicles insured *</label>
            <select id="vehicles" name="vehicles" required>
              <option value="">Select‚Ä¶</option>
              <option>1</option><option>2</option><option>3</option><option>4+</option>
            </select>
          </div>
          <div class="field">
            <label for="timeframe">When do you need this? *</label>
            <select id="timeframe" name="timeframe" required>
              <option value="">Select‚Ä¶</option>
              <option>ASAP</option>
              <option>Within 7 days</option>
              <option>Within 30 days</option>
              <option>Just exploring</option>
            </select>
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" name="notes" placeholder="Any details that help (hail claim history, wildfire concerns, bundling, etc.)"></textarea>
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label style="display:flex;gap:10px;align-items:flex-start;font-weight:800;color:#0f172a;">
              <input id="consent" type="checkbox" required style="margin-top:2px;" />
              I agree to be contacted by phone, SMS, and email about insurance options. Msg &amp; data rates may apply.
            </label>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="cancelBtn" type="button">Cancel</button>
          <button class="btn btn-primary" id="submitBtn" type="submit">Submit</button>
        </div>
        <div class="status" id="formStatus"></div>
      </form>
    </div>
  </div>
</div>

<!-- Disclaimer launcher -->
<button class="disc-btn" id="openDisclaimer" type="button" data-i18n="disclaimer_btn">Disclaimer</button>

<!-- Disclaimer modal -->
<div class="disc-overlay" id="discOverlay"></div>
<div class="disc-modal" id="discModal" role="dialog" aria-label="Legal disclaimer">
  <div class="disc-card">
    <div class="disc-head">
      <div class="disc-head-left">
        <div class="disc-icon">‚öñ</div>
        <div>
          <h2>Legal Disclaimer</h2>
          <div class="disc-kicker">Please review. This site includes AI-assisted information. <b>Human review is required</b> before any quote, application, binding, or policy change.</div>
        </div>
      </div>
      <button class="disc-close" id="discClose" type="button" aria-label="Close disclaimer">Close ‚úï</button>
    </div>
    <div class="disc-body">
      <div class="disc-sections">
        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">i</div>
            <div>
              <p class="disc-sec-title">General information only</p>
              <p class="disc-sec-sub">Not legal, tax, or financial advice</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>This page and <strong>PolicyPro‚Ñ¢</strong> provide <strong>general educational information</strong> about insurance concepts.</li>
              <li>Nothing here is legal advice, tax advice, or a substitute for professional guidance.</li>
              <li>Examples (including ZIP <strong>81501</strong>) are <strong>illustrative only</strong>.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">AI</div>
            <div>
              <p class="disc-sec-title">AI disclosure</p>
              <p class="disc-sec-sub">AI output can be wrong or incomplete</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li><strong>PolicyPro‚Ñ¢</strong> includes automated and artificial-intelligence‚Äìgenerated responses for general informational purposes.</li>
              <li>AI output may be incomplete, inaccurate, or outdated and must not be relied upon as a definitive statement of coverage, pricing, underwriting eligibility, or claim outcome.</li>
              <li>AI responses do <strong>not</strong> replace advice from a licensed insurance producer.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">‚úì</div>
            <div>
              <p class="disc-sec-title">Human review required</p>
              <p class="disc-sec-sub">Before quotes, applications, or changes</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Any quote indications, coverage discussions, or next steps require <strong>review and confirmation</strong> by a licensed insurance agent before any application is submitted or coverage is bound.</li>
              <li>Nothing on this page constitutes an offer to sell insurance or bind coverage.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">üõ°</div>
            <div>
              <p class="disc-sec-title">Coverage &amp; claims limitations</p>
              <p class="disc-sec-sub">Carrier rules and policy terms control</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Coverage, eligibility, rates, discounts, underwriting, and availability vary by carrier and are subject to policy terms, conditions, exclusions, limits, and deductibles.</li>
              <li>Claim scenario walkthroughs are general and may not apply to your situation. Always follow your policy and carrier instructions. If there is immediate danger, call emergency services.</li>
            </ul>
          </div>
        </section>
      </div>

      <div class="disc-footer-note">
        <strong>Consent &amp; privacy:</strong> By submitting your information, you authorize contact by phone, SMS, and email about insurance options (msg &amp; data rates may apply). Information may be stored in a secure Google Sheet and emailed to the business inbox for follow-up. Do not submit sensitive information you do not want transmitted electronically.
      </div>
    </div>

    <div class="disc-actions">
      <button class="btn btn-accept" id="discAccept" type="button">I Accept</button>
      <button class="btn btn-primary" id="discClose2" type="button">Close</button>
    </div>
  </div>
</div>

<!-- Channel.io-style launcher -->
<div class="chat-launcher" id="chatBtn" aria-label="Open PolicyPro chat" title="Ask PolicyPro‚Ñ¢ a question">
  <div class="chat-peek" aria-hidden="true">
    <div class="chat-label" data-i18n="chat_peek_label">Need help?</div>
    <div class="chat-name" data-i18n="chat_peek_name">Chat with PolicyPro‚Ñ¢</div>
  </div>
  <div class="chat-bubble" role="button" aria-label="Chat bubble">
    <div class="chat-avatar">PP</div>
  </div>
</div>

<div class="chat-window" id="chatWindow" aria-label="PolicyPro widget" role="dialog">
  <div class="pp-widget">
    <div class="pp-top" aria-hidden="true">
      <div class="pp-topbar">
        <div class="pp-brand">PolicyPro‚Ñ¢</div>
      </div>
    </div>

    <div class="pp-body">
      <!-- HOME -->
      <div class="pp-screen active" id="ppScreenHome">
        <div class="pp-home-card">
          <div class="pp-home-row">
            <div class="pp-avatar">PP</div>
            <div>
              <p class="pp-home-title" data-i18n="pp_home_title">Hi ‚Äî how can we help?</p>
              <p class="pp-home-sub" data-i18n="pp_home_sub">Ask a Colorado home or auto insurance question. General info only ‚Äî a licensed agent reviews before any quote, application, or binding.</p>
            </div>
          </div>
          <button class="pp-primary" id="ppStartChat" type="button"><span data-i18n="pp_start_chat">Start a chat</span> <span aria-hidden="true">‚û§</span></button>
        </div>
        <div class="pp-footer-note" data-i18n="pp_powered">Powered by PolicyPro</div>
      </div>

      <!-- MESSAGES -->
      <div class="pp-screen" id="ppScreenMessages">
        <div class="pp-messages-wrap">
          <div class="chat-main">
            <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

            <form class="chat-inputbar" id="chatForm" autocomplete="off">
              <input class="chat-input" id="chatInput" type="text" placeholder="Ask about hail deductibles, wildfire coverage, bundling‚Ä¶" data-i18n-placeholder="chat_placeholder" />
              <button class="send-btn" id="chatSend" type="submit" data-i18n="chat_send">Send</button>
            </form>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div class="pp-screen" id="ppScreenSettings">
        <div class="pp-settings">
          <h3 data-i18n="settings_title">Settings</h3>
          <div class="pp-setting-item"><div class="k" data-i18n="settings_contact">Contact</div><div class="v" id="ppAgentEmail">securechoicein@gmail.com</div></div>
          <div class="pp-setting-item">
            <div class="k" data-i18n="settings_language">Language</div>
            <div class="v">
              <select id="ppLangSelect" class="pp-select" aria-label="Select language">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="ja">Japanese</option>
                <option value="zh">Chinese</option>
                <option value="fr">French</option>
                <option value="ru">Russian</option>
              </select>
            </div>
          </div>
          <div class="pp-setting-item"><div class="k" data-i18n="settings_disclaimer">Disclaimer</div><div class="v" data-i18n="settings_available">Available</div></div>
          <a class="pp-setting-link" href="#" id="ppOpenDisclaimerLink" data-i18n="settings_open_disclaimer">Open legal disclaimer</a>
        </div>
      </div>
    </div>

    <div class="pp-tabs" role="tablist" aria-label="Widget tabs">
      <button class="pp-tab active" id="ppTabHome" type="button" role="tab" aria-selected="true" aria-controls="ppScreenHome">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5"/><path d="M5 10v10h14V10"/></svg>
        <span data-i18n="tab_home">Home</span>
      </button>
      <button class="pp-tab" id="ppTabMessages" type="button" role="tab" aria-selected="false" aria-controls="ppScreenMessages">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg>
        <span data-i18n="tab_messages">Messages</span>
      </button>
      <button class="pp-tab" id="ppTabSettings" type="button" role="tab" aria-selected="false" aria-controls="ppScreenSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/><path d="M19.4 15a1.7 1.7 0 0 0 .3 1.8l.1.1a2 2 0 0 1-1.4 3.4h-.2a1.8 1.8 0 0 0-1.7 1.3 2 2 0 0 1-3.8 0 1.8 1.8 0 0 0-1.7-1.3H9a2 2 0 0 1-1.4-3.4l.1-.1A1.7 1.7 0 0 0 8.6 15a1.8 1.8 0 0 0-.7-1.7 2 2 0 0 1 0-3.1 1.8 1.8 0 0 0 .7-1.7 1.7 1.7 0 0 0-.3-1.8l-.1-.1A2 2 0 0 1 9.6 3h.2a1.8 1.8 0 0 0 1.7-1.3 2 2 0 0 1 3.8 0 1.8 1.8 0 0 0 1.7 1.3h.2a2 2 0 0 1 1.4 3.4l-.1.1a1.7 1.7 0 0 0-.3 1.8 1.8 1.8 0 0 0 .7 1.7 2 2 0 0 1 0 3.1 1.8 1.8 0 0 0-.7 1.7z"/></svg>
        <span data-i18n="tab_settings">Settings</span>
      </button>
    </div>
  </div>

  <button class="pp-close-fab" id="closeChat" aria-label="Close chat" type="button">‚úï</button>
</div>

<script>
  // ===== Lead funnel + Google Apps Script backend =====
  var GAS = window.GAS_WEBAPP_URL || "";
  var CLICKFUNNEL_URL = (window.CLICKFUNNEL_URL || '').trim();

  var openFunnelBtn = document.getElementById('openFunnel');
  var modalOverlay = document.getElementById('modalOverlay');
  var modal = document.getElementById('modal');
  var closeModalBtn = document.getElementById('closeModal');
  var cancelBtn = document.getElementById('cancelBtn');
  var leadForm = document.getElementById('leadForm');
  var formStatus = document.getElementById('formStatus');

  function showModal(){ if(modalOverlay) modalOverlay.style.display='block'; if(modal) modal.style.display='flex'; }
  function hideModal(){ if(modalOverlay) modalOverlay.style.display='none'; if(modal) modal.style.display='none'; }

  if(closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
  if(cancelBtn) cancelBtn.addEventListener('click', hideModal);
  if(modalOverlay) modalOverlay.addEventListener('click', hideModal);

  function postToGAS(url, payload){
    var params = new URLSearchParams();
    params.set('payload', JSON.stringify(payload || {}));

    return fetch(url, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: params.toString()
    });
  }

  function leadScore(zip, timeframe){
    var score = 0;
    if(timeframe === 'ASAP') score += 35;
    else if(timeframe === 'Within 7 days') score += 25;
    else if(timeframe === 'Within 30 days') score += 10;

    if(zip === '81501') score += 20;
    else if(zip && zip.length === 5) score += 8;

    if(score > 100) score = 100;
    var label = (score >= 70) ? 'HOT' : (score >= 40 ? 'WARM' : 'COOL');
    return { score: score, label: label };
  }

  function openOptionsFlow_(){
    if(CLICKFUNNEL_URL && CLICKFUNNEL_URL.indexOf('http') === 0){
      window.location.href = CLICKFUNNEL_URL;
      return;
    }
    showModal();
  }

  // ‚úÖ CTA behavior: NEVER show disclaimer/toast on click
  if(openFunnelBtn){
    openFunnelBtn.addEventListener('click', function(){
      openOptionsFlow_();
    });
  }

  // ===== PolicyPro chat (UI + optional backend) =====
  var chatBtn = document.getElementById('chatBtn');
  var chatWindow = document.getElementById('chatWindow');
  var closeChat = document.getElementById('closeChat');
  var chatMessages = document.getElementById('chatMessages');
  var chatForm = document.getElementById('chatForm');
  var chatInput = document.getElementById('chatInput');
  var chatSend = document.getElementById('chatSend');

  // Widget tabs + screens
  var ppScreenHome = document.getElementById('ppScreenHome');
  var ppScreenMessages = document.getElementById('ppScreenMessages');
  var ppScreenSettings = document.getElementById('ppScreenSettings');
  var ppTabHome = document.getElementById('ppTabHome');
  var ppTabMessages = document.getElementById('ppTabMessages');
  var ppTabSettings = document.getElementById('ppTabSettings');
  var ppStartChat = document.getElementById('ppStartChat');
  var ppOpenDisclaimerLink = document.getElementById('ppOpenDisclaimerLink');
  var ppLangSelect = document.getElementById('ppLangSelect');

  var ppSeeded = false;

  function setTab_(which){
    var homeOn = which === 'home';
    var msgOn = which === 'messages';
    var setOn = which === 'settings';

    if(ppScreenHome) ppScreenHome.classList.toggle('active', homeOn);
    if(ppScreenMessages) ppScreenMessages.classList.toggle('active', msgOn);
    if(ppScreenSettings) ppScreenSettings.classList.toggle('active', setOn);

    if(ppTabHome){ ppTabHome.classList.toggle('active', homeOn); ppTabHome.setAttribute('aria-selected', homeOn ? 'true' : 'false'); }
    if(ppTabMessages){ ppTabMessages.classList.toggle('active', msgOn); ppTabMessages.setAttribute('aria-selected', msgOn ? 'true' : 'false'); }
    if(ppTabSettings){ ppTabSettings.classList.toggle('active', setOn); ppTabSettings.setAttribute('aria-selected', setOn ? 'true' : 'false'); }

    if(msgOn){
      if(!ppSeeded){ seedChat_(); ppSeeded = true; }
      setTimeout(function(){ if(chatInput) chatInput.focus(); }, 30);
    }
  }

  var POLICYPRO_MODE = ((window.POLICYPRO_MODE || '') + '').trim().toLowerCase() || 'local';
  var CHAT_ENDPOINT = (POLICYPRO_MODE === 'remote')
    ? (((window.POLICYPRO_LLM_ENDPOINT || '').trim() || (window.GAS_WEBAPP_URL || '').trim()))
    : '';

  var chatHistory = [];

  // =========================
  // i18n: Language selection + translate landing page + widget
  // =========================
  var PP_LANG_KEY = 'pp_lang_v1';

  function getLang_(){
    try{ return (localStorage.getItem(PP_LANG_KEY) || 'en'); }catch(e){ return 'en'; }
  }
  function setLang_(v){
    try{ localStorage.setItem(PP_LANG_KEY, String(v||'en')); }catch(e){}
  }

  function i18nDict_(){
    return {
      en:{$1hero_header_home:'Home Insurance',
        hero_header_auto:'Car Insurance',
        hero_header_business:'Business Insurance',
        s_home_3:'What should I check for wildfire/smoke coverage?',
        s_auto_1:'Is hail damage covered on auto insurance?',
        s_auto_2:'What does comprehensive vs collision cover?',
        s_auto_3:'How can I lower my auto premium without losing coverage?'
      },
      es:{$1hero_header_home:'Seguro de hogar',
        hero_header_auto:'Seguro de auto',
        hero_header_business:'Seguro para negocios',
        s_home_3:'¬øQu√© debo revisar para cobertura de incendio/humo?',
        s_auto_1:'¬øEl granizo est√° cubierto en el seguro de auto?',
        s_auto_2:'¬øQu√© cubre comprensivo vs colisi√≥n?',
        s_auto_3:'¬øC√≥mo bajo mi prima sin perder cobertura?'
      },
      ja:{$1hero_header_home:'‰ΩèÂÆÖ‰øùÈô∫',
        hero_header_auto:'Ëá™ÂãïËªä‰øùÈô∫',
        hero_header_business:'‰∫ãÊ•≠‰øùÈô∫',
        s_home_3:'Â±±ÁÅ´‰∫ã/ÁÖô„ÅÆË£úÂÑü„ÅßÁ¢∫Ë™ç„Åô„Åπ„ÅçÁÇπ„ÅØÔºü',
        s_auto_1:'ÈõπË¢´ÂÆ≥„ÅØËá™ÂãïËªä‰øùÈô∫„ÅßË£úÂÑü„Åï„Çå„ÇãÔºü',
        s_auto_2:'ÂåÖÊã¨ÔºàComprehensiveÔºâ„Å®Ë°ùÁ™ÅÔºàCollisionÔºâ„ÅÆÈÅï„ÅÑ„ÅØÔºü',
        s_auto_3:'Ë£úÂÑü„ÇíËêΩ„Å®„Åï„Åö‰øùÈô∫Êñô„Çí‰∏ã„Åí„ÇãÊñπÊ≥ï„ÅØÔºü'
      },
      zh:{$1hero_header_home:'ÊàøÂ±ã‰øùÈô©',
        hero_header_auto:'Ê±ΩËΩ¶‰øùÈô©',
        hero_header_business:'ÂïÜ‰∏ö‰øùÈô©',
        s_home_3:'ÈáéÁÅ´/ÁÉüÈõæ‰øùÈöúÂ∫îÈáçÁÇπÊü•Áúã‰ªÄ‰πàÔºü',
        s_auto_1:'Ê±ΩËΩ¶‰øùÈô©ÊòØÂê¶Ê∂µÁõñÂÜ∞ÈõπÊçüÂ§±Ôºü',
        s_auto_2:'ÁªºÂêàÈô© vs Á¢∞ÊíûÈô©ÂàÜÂà´‰øù‰ªÄ‰πàÔºü',
        s_auto_3:'‰∏çÈôç‰Ωé‰øùÈöúÁöÑÊÉÖÂÜµ‰∏ãÂ¶Ç‰ΩïÈôç‰øùË¥πÔºü'
      },
      fr:{$1hero_header_home:'Assurance habitation',
        hero_header_auto:'Assurance auto',
        hero_header_business:'Assurance entreprise',
        s_home_3:'Que v√©rifier pour la couverture feu/fum√©e ?',
        s_auto_1:'La gr√™le est-elle couverte en assurance auto ?',
        s_auto_2:'Que couvre ‚Äúcomprehensive‚Äù vs ‚Äúcollision‚Äù ?',
        s_auto_3:'Comment baisser ma prime sans perdre de garanties ?'
      },
      ru:{$1hero_header_home:'–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –¥–æ–º–∞',
        hero_header_auto:'–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ',
        hero_header_business:'–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞',
        s_home_3:'–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é –ø–æ–∂–∞—Ä–∞/–¥—ã–º–∞?',
        s_auto_1:'–ü–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ –≥—Ä–∞–¥ –∞–≤—Ç–æ—Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π?',
        s_auto_2:'–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è comprehensive –æ—Ç collision?',
        s_auto_3:'–ö–∞–∫ —Å–Ω–∏–∑–∏—Ç—å –ø–ª–∞—Ç–µ–∂ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø–æ–∫—Ä—ã—Ç–∏—è?'
      }
    };
  }

  function getStrings_(lang){
    var dict = i18nDict_();
    return dict[lang] || dict.en;
  }

  function translatePage_(lang){
    var s = getStrings_(lang);

    // Document metadata
    try{ document.documentElement.lang = lang || 'en'; }catch(e){}
    try{ document.title = s.doc_title; }catch(e){}
    try{
      var m = document.querySelector('meta[name="description"]');
      if(m) m.setAttribute('content', s.meta_desc);
    }catch(e){}

    // Text nodes
    try{
      var nodes = document.querySelectorAll('[data-i18n]');
      for(var i=0;i<nodes.length;i++){
        var key = nodes[i].getAttribute('data-i18n');
        if(key && s[key]) nodes[i].innerHTML = String(s[key]);
      }
    }catch(e){}

    // Placeholders
    try{
      var ph = document.querySelectorAll('[data-i18n-placeholder]');
      for(var j=0;j<ph.length;j++){
        var k = ph[j].getAttribute('data-i18n-placeholder');
        if(k && s[k]) ph[j].setAttribute('placeholder', String(s[k]));
      }
    }catch(e){}

    // Re-render suggested questions title/labels if suggestions are currently showing
    try{
      if(chatMessages){
        var t = chatMessages.querySelector('.pp-suggest-title');
        if(t) t.textContent = s.suggest_title;
        var labs = chatMessages.querySelectorAll('.pp-suggest-label');
        if(labs && labs.length >= 2){
          labs[0].textContent = s.suggest_home;
          labs[1].textContent = s.suggest_auto;
        }
      }
    }catch(e){}

    // Keep hero header synced to language + current slide
    try{ syncHeroHeader_(); }catch(e){}
  }

  function applyLanguage_(lang){
    lang = (lang || 'en');
    setLang_(lang);
    if(ppLangSelect) ppLangSelect.value = lang;
    translatePage_(lang);
  }

  // Initialize language dropdown + apply language to whole page
  (function(){
    var lang = getLang_();
    if(ppLangSelect){
      ppLangSelect.value = lang;
      ppLangSelect.addEventListener('change', function(){
        applyLanguage_(ppLangSelect.value);
      });
    }
    applyLanguage_(lang);
  })();

  // =========================
  // Hero header sync with rotating images (every 3s)
  // =========================
  var __heroIndex = 0;
  function heroKeys_(){
    return ['hero_header_home','hero_header_auto','hero_header_business'];
  }
  function syncHeroHeader_(){
    var el = document.getElementById('heroHeader');
    if(!el) return;

    // If reduced motion, pin to first slide.
    var reduce = false;
    try{ reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches; }catch(e){ reduce = false; }
    var idx = reduce ? 0 : (__heroIndex % 3);

    var s = getStrings_(getLang_());
    var key = heroKeys_()[idx];
    var txt = s[key] || (idx === 0 ? 'Home Insurance' : (idx === 1 ? 'Car Insurance' : 'Business Insurance'));
    el.textContent = txt;
  }

  // Start ticking the header exactly on the 3s cadence used by the CSS rotator.
  (function(){
    // Initialize immediately
    __heroIndex = 0;
    syncHeroHeader_();

    // Advance every 3 seconds
    setInterval(function(){
      __heroIndex = (__heroIndex + 1) % 3;
      syncHeroHeader_();
    }, 3000);
  })();

  function isEmail_(email){
    email = String(email||'').trim();
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function esc_(s){
    s = String(s == null ? '' : s);
    return s.replace(/[&<>"']/g, function(c){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c] || c;
    });
  }

  function addMsg_(role, html){
    if(!chatMessages) return;
    var wrap = document.createElement('div');
    wrap.className = 'msg ' + (role === 'user' ? 'user' : 'bot');

    var b = document.createElement('div');
    b.className = 'bubble ' + (role === 'user' ? 'user' : 'bot');
    b.innerHTML = html;

    wrap.appendChild(b);
    chatMessages.appendChild(wrap);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function addTyping_(){
    addMsg_('bot', '<span class="typing" aria-label="PolicyPro is typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>');
  }

  function replaceLastBot_(html){
    if(!chatMessages) return;
    var items = chatMessages.querySelectorAll('.msg.bot .bubble');
    if(!items || !items.length) return;
    items[items.length-1].innerHTML = html;
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function seedChat_(){
    // Messages screen: all-white, with starter question chips.
    renderSuggestedQuestions_();
  }

  function renderSuggestedQuestions_(){
    if(!chatMessages) return;

    // If user already has messages, don't overwrite.
    if(chatMessages.childElementCount) return;

    var wrap = document.createElement('div');
    wrap.className = 'pp-suggest-wrap';

    var title = document.createElement('p');
    title.className = 'pp-suggest-title';
    title.textContent = getStrings_(getLang_()).suggest_title;

    var lang = getLang_();
    var s = getStrings_(lang);

    var suggestionsHome = [
      s.s_home_1,
      s.s_home_2,
      s.s_home_3
    ];

    var suggestionsAuto = [
      s.s_auto_1,
      s.s_auto_2,
      s.s_auto_3
    ];

    function section_(label, items){
      var sec = document.createElement('div');
      sec.className = 'pp-suggest-section';

      var l = document.createElement('div');
      l.className = 'pp-suggest-label';
      l.textContent = label;

      var grid = document.createElement('div');
      grid.className = 'pp-suggest-grid';

      items.forEach(function(text){
        var b = document.createElement('button');
        b.type = 'button';
        b.className = 'pp-suggest-chip';
        b.textContent = text;
        b.addEventListener('click', function(){
          try{ wrap.remove(); }catch(e){}
          sendChat_(text);
        });
        grid.appendChild(b);
      });

      sec.appendChild(l);
      sec.appendChild(grid);
      return sec;
    }

    wrap.appendChild(title);
    var s2 = getStrings_(getLang_());
    wrap.appendChild(section_(s2.suggest_home, suggestionsHome));
    wrap.appendChild(section_(s2.suggest_auto, suggestionsAuto));

    chatMessages.appendChild(wrap);
  }

  function openChat_(){
    if(chatWindow) chatWindow.style.display = 'block';
    if(chatBtn) chatBtn.style.display = 'none';
    setTab_('home');
  }

  function closeChat_(){
    if(chatWindow) chatWindow.style.display = 'none';
    if(chatBtn) chatBtn.style.display = 'flex';
  }

  if(chatBtn) chatBtn.addEventListener('click', openChat_);
  if(closeChat) closeChat.addEventListener('click', closeChat_);

  // Tabs + actions
  if(ppTabHome) ppTabHome.addEventListener('click', function(){ setTab_('home'); });
  if(ppTabMessages) ppTabMessages.addEventListener('click', function(){ setTab_('messages'); });
  if(ppTabSettings) ppTabSettings.addEventListener('click', function(){ setTab_('settings'); });

  // Expected behavior:
  // When clicking Start a chat -> open Messages tab + show the suggestion chips on an all-white screen.
  // If you want it to ALSO clear any prior messages each time Start a chat is clicked, tell me.
  if(ppStartChat) ppStartChat.addEventListener('click', function(){
    setTab_('messages');
    setTimeout(function(){ renderSuggestedQuestions_(); }, 0);
  });

  if(ppOpenDisclaimerLink) ppOpenDisclaimerLink.addEventListener('click', function(e){
    if(e) e.preventDefault();
    setTab_('settings');
    if(typeof showDisclaimer === 'function') showDisclaimer();
  });

  function classifyIntent_(q){
    var s = String(q||'').toLowerCase();
    var has = function(){
      for(var i=0;i<arguments.length;i++){
        if(s.indexOf(String(arguments[i]).toLowerCase()) !== -1) return true;
      }
      return false;
    };

    if(has('hail')) return 'hail';
    if(has('wildfire','fire','smoke','embers')) return 'wildfire';
    if(has('claim','claims','file a claim','denied')) return 'claims';
    if(has('bundle','multi-policy')) return 'bundle';
    if(has('deductible')) return 'deductible';
    if(has('cheapest','save','lower','rate','premium','expensive')) return 'price';
    if(has('comprehensive','collision')) return 'auto_terms';
    return 'general';
  }

  function fallbackAnswer_(q){
    var intent = classifyIntent_(q);

    if(intent === 'hail'){
      return (
        '<b>Hail coverage‚Äîwhat to check first:</b><br>' +
        '‚Ä¢ <b>Home:</b> many CO policies use a separate <b>wind/hail deductible</b> (often a % of Coverage A). Also check roof settlement: <b>Replacement Cost</b> vs <b>ACV/roof schedule</b>.<br>' +
        '‚Ä¢ <b>Auto:</b> hail is typically under <b>Comprehensive</b>, subject to your comp deductible.<br><br>' +
        '<b>1 question:</b> Is your home wind/hail deductible a flat $ amount or a %?'
      );
    }

    if(intent === 'wildfire'){
      return (
        '<b>Wildfire/smoke‚Äîfocus on these coverage parts:</b><br>' +
        '‚Ä¢ <b>Dwelling (Coverage A)</b> adequacy + any <b>extended replacement</b><br>' +
        '‚Ä¢ <b>Loss of use / ALE</b> for temporary housing<br>' +
        '‚Ä¢ <b>Ordinance or Law</b> (code upgrades)<br><br>' +
        '<b>1 question:</b> Homeowner, condo, or renter?'
      );
    }

    if(intent === 'auto_terms'){
      return (
        '<b>Comprehensive vs Collision (simple):</b><br>' +
        '‚Ä¢ <b>Comprehensive</b>: theft, vandalism, hail, animal hits, weather (not a crash).<br>' +
        '‚Ä¢ <b>Collision</b>: damage from a crash (your vehicle hitting something / being hit).<br><br>' +
        '<b>1 question:</b> Are you asking about hail specifically, or a crash/accident?'
      );
    }

    if(intent === 'price'){
      return (
        '<b>Ways people usually lower premium (without wrecking coverage):</b><br>' +
        '‚Ä¢ Right-size deductibles (especially wind/hail vs all-other-perils)<br>' +
        '‚Ä¢ Bundle home + auto where it doesn‚Äôt weaken roof terms<br>' +
        '‚Ä¢ Verify discounts (claim-free, paid-in-full, telematics if comfortable)<br><br>' +
        '<b>1 question:</b> Is your goal lower monthly payment or better hail/roof terms?'
      );
    }

    return (
      '<b>I can help with general home &amp; auto insurance questions.</b><br><br>' +
      '<b>Common Colorado topics:</b> wind/hail deductibles, wildfire, bundling, and switching without a lapse.<br><br>' +
      '<b>1 question:</b> Are you asking about home, auto, renters, or umbrella?'
    );
  }

  function sendChat_(text){
    var q = (text||'').trim();
    if(!q) return;

    addMsg_('user', esc_(q));
    chatHistory.push({ role:'user', content:q });

    addTyping_();

    if(CHAT_ENDPOINT && CHAT_ENDPOINT.indexOf('http') === 0){
      var payloadChat = {
        action: 'chat',
        message: q,
        history: chatHistory.slice(-12),
        channel: 'PolicyPro Chat',
        policy: 'GENERAL_INFO_ONLY'
      };

      fetch(CHAT_ENDPOINT, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payloadChat)
      }).then(function(res){
        return res.text().then(function(t){
          var obj;
          try{ obj = JSON.parse(t); }catch(e){ obj = null; }
          if(!res.ok) throw new Error('HTTP ' + res.status);

          var reply = '';
          if(obj){
            if(typeof obj.reply === 'string') reply = obj.reply;
            else if(typeof obj.message === 'string') reply = obj.message;
            else if(typeof obj.output_text === 'string') reply = obj.output_text;
            else if(obj.choices && obj.choices[0] && obj.choices[0].message && typeof obj.choices[0].message.content === 'string') reply = obj.choices[0].message.content;
          }
          if(!reply) reply = fallbackAnswer_(q);

          chatHistory.push({ role:'assistant', content: String(reply) });
          replaceLastBot_(esc_(reply).replace(/\r?\n/g, '<br>') + '<div class="meta">General info ‚Ä¢ Not a quote ‚Ä¢ Human review required</div>');
        });
      }).catch(function(){
        var ansRemoteFail = fallbackAnswer_(q);
        chatHistory.push({ role:'assistant', content: ansRemoteFail.replace(/<[^>]*>/g,'') });
        replaceLastBot_(ansRemoteFail + '<div class="meta">General info ‚Ä¢ Not a quote ‚Ä¢ Human review required</div>');
      });
      return;
    }

    var ans = fallbackAnswer_(q);
    chatHistory.push({ role:'assistant', content: ans.replace(/<[^>]*>/g,'') });
    replaceLastBot_(ans + '<div class="meta">General info ‚Ä¢ Not a quote ‚Ä¢ Human review required</div>');
  }

  if(chatForm){
    chatForm.addEventListener('submit', function(e){
      e.preventDefault();
      if(chatSend) chatSend.disabled = true;
      var q = chatInput ? chatInput.value : '';
      if(chatInput) chatInput.value = '';
      sendChat_(q);
      setTimeout(function(){ if(chatSend) chatSend.disabled = false; if(chatInput) chatInput.focus(); }, 50);
    });
  }

  // ===== Disclaimer modal (manual only; no auto popups) =====
  var openDisclaimer = document.getElementById('openDisclaimer');
  var discOverlay = document.getElementById('discOverlay');
  var discModal = document.getElementById('discModal');
  var discClose = document.getElementById('discClose');
  var discClose2 = document.getElementById('discClose2');
  var discAccept = document.getElementById('discAccept');

  function showDisclaimer(){
    if(discOverlay) discOverlay.style.display = 'block';
    if(discModal) discModal.style.display = 'flex';
  }
  function hideDisclaimer(){
    if(discOverlay) discOverlay.style.display = 'none';
    if(discModal) discModal.style.display = 'none';
  }
  function acceptDisclaimer_(){
    try{ sessionStorage.setItem('sc_disclaimer_accepted_session','1'); }catch(e){}
    hideDisclaimer();
  }

  if(openDisclaimer) openDisclaimer.addEventListener('click', showDisclaimer);
  if(discOverlay) discOverlay.addEventListener('click', hideDisclaimer);
  if(discClose) discClose.addEventListener('click', hideDisclaimer);
  if(discClose2) discClose2.addEventListener('click', hideDisclaimer);
  if(discAccept) discAccept.addEventListener('click', acceptDisclaimer_);

  // ===== Lead form submit =====
  if(leadForm){
    leadForm.addEventListener('submit', function(e){
      e.preventDefault();
      if(formStatus){
        formStatus.style.display='block';
        formStatus.className='status';
      }

      if(!GAS || GAS.indexOf('http') !== 0){
        if(formStatus){
          formStatus.className='status err';
          formStatus.textContent='Backend not connected yet. Paste your Apps Script Web App URL into window.GAS_WEBAPP_URL at the top of this file.';
        }
        return;
      }

      var payloadLead = {
        action: 'lead',
        source: 'GitHub Landing Page',
        channel: 'CTA Funnel',
        timestamp: new Date().toISOString(),
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        homeowner: document.getElementById('homeowner').value,
        roofAge: document.getElementById('roofAge').value,
        vehicles: document.getElementById('vehicles').value,
        timeframe: document.getElementById('timeframe').value,
        notes: document.getElementById('notes').value.trim(),
        consent: true,
        aiConsent: true,
        deliverKit: true,
        kitType: 'FIRE_HAIL_ENDORSEMENTS'
      };

      var scored = leadScore(payloadLead.zip, payloadLead.timeframe);
      payloadLead.leadScore = scored.score;
      payloadLead.leadLabel = scored.label;

      if(formStatus) formStatus.textContent='Submitting‚Ä¶';

      postToGAS(GAS, payloadLead).then(function(){
        if(formStatus){
          formStatus.className='status ok';
          formStatus.textContent='‚úÖ Submitted! Check your email for your coverage guide.';
        }
        leadForm.reset();
        setTimeout(hideModal, 900);
      }).catch(function(err){
        if(formStatus){
          formStatus.className='status err';
          formStatus.textContent='‚ö† Could not submit (network error). Double-check the Apps Script URL and that it is deployed as a Web App. (' + (err && err.message ? err.message : 'Error') + ')';
        }
      });
    });
  }

  // ===== Tiny self-tests (safe in production; only logs to console) =====
  (function(){
    try{
      console.assert(isEmail_('a@b.co') === true, 'isEmail_ basic should pass');
      console.assert(isEmail_('nope') === false, 'isEmail_ basic should fail');

      console.assert(typeof openOptionsFlow_ === 'function', 'openOptionsFlow_ should exist');
      console.assert(!!openFunnelBtn, 'openFunnelBtn should exist');

      console.assert(typeof showDisclaimer === 'function', 'showDisclaimer should exist');
      console.assert(typeof hideDisclaimer === 'function', 'hideDisclaimer should exist');

      console.assert(!!chatBtn, 'chatBtn should exist');
      console.assert(!!chatWindow, 'chatWindow should exist');
      console.assert(typeof renderSuggestedQuestions_ === 'function', 'renderSuggestedQuestions_ should exist');
      console.assert(typeof seedChat_ === 'function', 'seedChat_ should exist');
      console.assert(!ppLangSelect || ppLangSelect.tagName === 'SELECT', 'ppLangSelect should be a select when present');
      console.assert(typeof applyLanguage_ === 'function', 'applyLanguage_ should exist');
      console.assert(typeof translatePage_ === 'function', 'translatePage_ should exist');
      console.assert(typeof getStrings_ === 'function', 'getStrings_ should exist');
      console.assert(!!getStrings_('en').hero_h1, 'English strings should include hero_h1');
      console.assert(!!getStrings_('es').hero_h1, 'Spanish strings should include hero_h1');
      if(ppLangSelect){
        console.assert(ppLangSelect.options.length >= 6, 'Language dropdown should have 6 options');
      }

      // Suggestions: should render when empty
      if(chatMessages){
        var before = chatMessages.childElementCount;
        renderSuggestedQuestions_();
        var after = chatMessages.childElementCount;
        console.assert(after >= before, 'renderSuggestedQuestions_ should not reduce children');
      }

      console.assert(typeof leadScore === 'function', 'leadScore should exist');
      console.assert(leadScore('81501','ASAP').score >= 0, 'leadScore should return a score');
    }catch(e){ /* no-op */ }
  })();
</script>

</body>
</html>
