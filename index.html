<!DOCTYPE html>
<html lang="en" id="docHtml">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colorado Relief Options â€” Home &amp; Auto Insurance</title>
  <meta name="description" content="Colorado residents: explore flexible home &amp; auto insurance options designed to protect your budget and peace of mind. Bundle, save, and see if you qualify for custom rate relief or flexible payments." />

  <!-- ================= QUICK SETUP =================
  REQUIRED FILES IN SAME FOLDER:
  - index.html
  - hero-house.png
  - hero-auto.png
  - hero-business.png
  ================================================== -->

  <script>
    // === REQUIRED: paste your deployed Google Apps Script Web App URL here ===
    window.GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxOABgbT0lL3a3sLNdt-IVkE-Tf6j7WdIdlrdEoZuxfUbCgKc0aZbXOrpXJbnQGtwqtWQ/exec";

    // Optional separate LLM endpoint (usually leave blank to reuse GAS)
    window.POLICYPRO_LLM_ENDPOINT = "";

    // âœ… Default: run PolicyPro in LOCAL mode (no API keys required)
    window.POLICYPRO_MODE = "local";

    // Tracking (optional)
    window.GA4_MEASUREMENT_ID = "";
    window.GOOGLE_ADS_ID = "";
    window.GOOGLE_ADS_CONVERSION_LABEL = "";
    window.META_PIXEL_ID = "";

    window.AGENT_EMAIL = "securechoicein@gmail.com";

    // === ClickFunnels (recommended for "Check My Options") ===
    window.CLICKFUNNEL_URL = "";
  </script>

  <!-- Preload hero images for smoother first paint (PNG only) -->
  <link rel="preload" as="image" href="hero-house.png">
  <link rel="preload" as="image" href="hero-auto.png">
  <link rel="preload" as="image" href="hero-business.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --card:#0f172a;
      --line:rgba(148,196,255,.35);
      --brand:#38bdf8;
      --brand2:#0ea5e9;
      --ok:#22c55e;
      --warn:#facc15;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:#0b1323;
      color:#e5e7eb;
      overflow-x:hidden;
    }

    /* HERO */
    .hero{
      position:relative;
      min-height:90vh;
      display:flex;
      align-items:center;
      padding:48px;
      overflow:hidden;
      isolation:isolate;
    }

    /* Dark overlay so text stays readable on photos */
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(rgba(5,10,25,.74),rgba(5,10,25,.74));
      z-index:1;
      pointer-events:none;
    }

    /* Rotating background slides (mobile-safe): JS-driven crossfade */
    .hero-rotator{
      position:absolute;
      inset:0;
      height:100%; /* mobile paint safety */
      z-index:0;
      pointer-events:none;
    }

    .hero-slide{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;         /* ALWAYS fill the hero */
      object-position:50% 50%;  /* per-slide focal point set via [data-pos] */
      opacity:0;
      filter:saturate(1.05) contrast(1.05);
      transition:opacity 900ms ease;
      will-change:opacity;
    }

    /* Optional per-slide focal points */
    .hero-slide[data-pos]{ object-position: var(--pos, 50% 50%); }
    .hero-slide[data-pos="center"][style]{ }


    .hero-slide.active{ opacity:1; }

    /* Desktop: show the full PNG hero (less cropping than object-fit:cover) */
    @media (min-width: 901px){
      .hero{ min-height:100vh; padding:72px 72px; }
      .hero-content{ max-width:760px; }

      /* If your PNGs have any empty/transparent padding, scaling helps them fully fill */
      .hero-rotator{ background:#000; }
      .hero-slide{
        transform:scale(1.12);
        transform-origin:center;
        /* Slightly bias up so heads donâ€™t get cropped on wide screens */
        object-position:50% 35%;
      }
    }
      .hero-content{ max-width:760px; }
      /* Slightly bias up so heads donâ€™t get cropped on wide screens */
      .hero-slide{ object-position:50% 35%; }
    }

/* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce){
      .hero-slide{ transition:none; }
    }

    .hero-content{position:relative;max-width:680px;z-index:2}
    .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:rgba(56,189,248,.15);border:1px solid rgba(56,189,248,.4);font-size:12px;font-weight:700;color:#c7e9ff}
    h1{font-size:clamp(32px,5vw,52px);margin:18px 0;line-height:1.1}

    /* Hero header (uses the same font as the PP mark) */
    .hero-headline{
      margin:0 0 18px;
      font-size:clamp(40px,6vw,72px);
      line-height:1.02;
      letter-spacing:.01em;
      color:#ffffff;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
      font-weight:700;
      text-shadow:0 18px 70px rgba(0,0,0,.55);
    }

    /* Primary CTA â€“ ChannelTalk-style (white, PP font) */
    .cta{
      margin-top:24px;
      padding:14px 28px;
      font-size:16px;
      font-weight:700;
      border-radius:999px;
      border:1px solid #e5e7eb;
      cursor:pointer;
      background:#ffffff;
      color:#0b1120;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
      box-shadow:0 18px 55px rgba(0,0,0,.25);
      transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }
    .cta:hover{
      transform:translateY(-1px);
      box-shadow:0 22px 70px rgba(0,0,0,.28);
      filter:brightness(1.01);
    }
    .cta:active{transform:translateY(0);box-shadow:0 14px 40px rgba(0,0,0,.22);}

    /* Alert */
    .alert-box{position:absolute;right:10%;bottom:35%;width:240px;background:rgba(15,23,42,.92);border-radius:14px;padding:14px;border:1px solid rgba(148,196,255,.55);box-shadow:0 20px 50px rgba(0,0,0,.6);z-index:2}
    .alert-title{font-size:11px;text-transform:uppercase;letter-spacing:.14em;color:#facc15;margin-bottom:6px}
    .alert-text{font-size:13px;color:#e5e7eb;line-height:1.35}

    /* ================== CHAT: Channel.io-like launcher ==================
       Bottom-right floating bubble + subtle label.
    */

    .chat-launcher{
      position:fixed;
      right:20px;
      bottom:22px;
      z-index:26000;
      display:flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .chat-peek{
      display:flex;
      flex-direction:column;
      gap:2px;
      padding:10px 12px;
      border-radius:14px;
      background:#ffffff; /* match chatbox */
      border:1px solid #e5e7eb;
      backdrop-filter:blur(10px);
      box-shadow:0 18px 55px rgba(0,0,0,.25);
    }
    .chat-peek .chat-label{
      font-size:11px;
      opacity:.85;
      font-weight:700;
      color:#0b1120; /* black lettering */
      letter-spacing:.01em;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
    }
    .chat-peek .chat-name{
      font-weight:700;
      font-size:13px;
      letter-spacing:.01em;
      color:#0b1120; /* black lettering */
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
    }

    .chat-bubble{
      width:56px;height:56px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      background:#ffffff;
      border:1px solid #e5e7eb;
      box-shadow:0 22px 70px rgba(0,0,0,.25);
      position:relative;
      transition:transform .18s ease, filter .18s ease;
      animation: chatPulse 2.6s ease-in-out infinite;
    }
    .chat-bubble:hover{transform:translateY(-2px) scale(1.03);filter:brightness(1.06)}
    .chat-bubble:active{transform:translateY(0) scale(0.99)}

    .chat-avatar{
      width:44px;height:44px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      font-family:'Playfair Display', 'Didot', 'Bodoni MT', serif;
      font-weight:600;
      font-size:22px;
      color:#020617;
      background:#ffffff;
    }

    @keyframes chatPulse{
      0%{ box-shadow:0 22px 70px rgba(0,0,0,.25), 0 0 0 0 rgba(2,6,23,.15); }
      50%{ box-shadow:0 22px 70px rgba(0,0,0,.25), 0 0 0 12px rgba(2,6,23,0); }
      100%{ box-shadow:0 22px 70px rgba(0,0,0,.25), 0 0 0 0 rgba(2,6,23,0); }
    }

    /* ================== CHAT WIDGET (ChannelTalk-like) ==================
       Compact widget with:
       - Photo header
       - White rounded body
       - Bottom tabs: Home / Messages / Settings
       - Separate round close button bottom-right
    */

    .chat-window{
      display:none;
      position:fixed;
      right:20px;
      bottom:96px;
      width:360px;
      max-height:78vh;
      z-index:25000;
    }

    .pp-widget{
      width:100%;
      background:#fff;
      color:#0b1120;
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.10);
      box-shadow:0 40px 120px rgba(0,0,0,.42);
    }

    .pp-top{
      position:relative;
      height:150px;
      background:
        linear-gradient(180deg, rgba(2,6,23,0) 40%, rgba(2,6,23,.45) 100%),
        url('hero-house.png') center/cover no-repeat;
    }

    .pp-topbar{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:14px 14px 12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }

    .pp-brand{
      color:#fff;
      font-weight:900;
      letter-spacing:.01em;
      font-size:18px;
      text-shadow:0 8px 30px rgba(0,0,0,.55);
    }

    .pp-body{padding:12px 14px 10px;background:#fff;}

    .pp-screen{ display:none; }
    .pp-screen.active{ display:block; }

    .pp-home-card{
      border:1px solid #eef2f7;
      border-radius:18px;
      padding:12px 12px;
      background:#fff;
      box-shadow:0 14px 40px rgba(2,6,23,.06);
    }

    .pp-home-row{display:flex;gap:10px;align-items:flex-start}
    .pp-avatar{
      width:38px;height:38px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      border:1px solid #e5e7eb;
      background:#fff;
      font-family:'Playfair Display','Didot','Bodoni MT',serif;
      font-weight:700;
      color:#0b1120;
      flex:0 0 auto;
    }

    .pp-home-title{margin:0;font-weight:900;font-size:13.5px;line-height:1.25}
    .pp-home-sub{margin:6px 0 0;color:#475569;font-weight:700;font-size:12px;line-height:1.35}

    .pp-primary{
      width:100%;
      margin-top:12px;
      padding:12px 12px;
      border-radius:999px;
      border:1px solid #eef2f7;
      background:#f3f4f6;
      color:#0b1120;
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .pp-primary:hover{filter:brightness(1.01)}

    .pp-footer-note{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      color:#94a3b8;
      font-weight:800;
      font-size:11px;
    }

    .pp-messages-wrap{
      border:1px solid #eef2f7;
      border-radius:18px;
      overflow:hidden;
      background:#fff;
    }

    .chat-main{
      display:flex;
      flex-direction:column;
      height:360px;
      min-height:320px;
    }

    .chat-messages{
      padding:12px;
      overflow:auto;
      flex:1;
      background:#ffffff;
    }

    .msg{display:flex;margin:10px 0}
    .msg.user{justify-content:flex-end}
    .msg.bot{justify-content:flex-start}
    .bubble{max-width:86%;padding:10px 12px;border-radius:14px;font-size:13.5px;line-height:1.45;box-shadow:0 10px 26px rgba(0,0,0,.06)}
    .bubble.user{background:#0b1120;color:#e5e7eb;border-top-right-radius:6px}
    .bubble.bot{background:#ffffff;color:#0f172a;border:1px solid #e5e7eb;border-top-left-radius:6px}
    .meta{font-size:10px;color:#64748b;font-weight:900;margin-top:6px}

    .chat-inputbar{padding:10px;border-top:1px solid #eef2f7;background:#fff;display:flex;gap:10px;align-items:center}
    .chat-input{flex:1;padding:12px 12px;border-radius:14px;border:1px solid #cbd5e1;font-size:14px;outline:none}
    .chat-input:focus{border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.12)}
    .send-btn{padding:12px 14px;border-radius:14px;border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;font-weight:1000;cursor:pointer}
    .send-btn:disabled{opacity:.55;cursor:not-allowed}

    /* Suggested question chips (ChannelTalk-like) */
    .pp-suggest-wrap{padding:14px 14px 10px;}
    .pp-suggest-title{
      font-weight:1000;
      font-size:12px;
      color:#0b1120;
      margin:0 0 12px;
      letter-spacing:.01em;
      text-align:left;
    }

    .pp-suggest-section{display:grid;gap:10px;margin-bottom:14px;}
    .pp-suggest-label{
      font-weight:1000;
      font-size:11px;
      color:#94a3b8;
      letter-spacing:.08em;
    }

    .pp-suggest-grid{display:flex;flex-wrap:wrap;gap:10px;}

    .pp-suggest-chip{
      border:1px solid #e2e8f0;
      background:#f8fafc;
      color:#0b1120;
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      font-size:12.5px;
      cursor:pointer;
      line-height:1.25;
      box-shadow:0 12px 26px rgba(2,6,23,.06);
      transition:transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }
    .pp-suggest-chip:hover{filter:brightness(1.01);transform:translateY(-1px)}
    .pp-suggest-chip:active{transform:translateY(0)}

    /* Policy Health Check chips */
    .phc-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
    .phc-chip{display:inline-flex;align-items:center;gap:10px;padding:12px 14px;border-radius:16px;border:1px solid #e2e8f0;background:#f8fafc;color:#0b1120;font-weight:900;font-size:12.5px;cursor:pointer;box-shadow:0 12px 26px rgba(2,6,23,.06);}
    .phc-chip input{transform:scale(1.05);}
    @media (max-width: 420px){.phc-chip{width:100%;justify-content:flex-start;}}

    @media (max-width: 420px){
      .pp-suggest-grid{gap:8px;}
      .pp-suggest-chip{width:100%;text-align:left;}
    }

    .pp-tabs{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      border-top:1px solid #eef2f7;
      background:#fff;
      padding:8px 6px;
    }

    .pp-tab{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      padding:8px 6px;
      border-radius:14px;
      border:0;
      background:transparent;
      cursor:pointer;
      color:#64748b;
      font-weight:900;
      font-size:11px;
    }

    .pp-tab svg{width:18px;height:18px;opacity:.75;transition:transform .15s ease, opacity .15s ease}

    /* Nicer Settings gear */
    .pp-tab#ppTabSettings svg{
      width:19px;
      height:19px;
      stroke-width:1.8;
    }
    .pp-tab#ppTabSettings:hover svg{opacity:.95;transform:rotate(20deg)}
    .pp-tab#ppTabSettings.active svg{opacity:1;transform:rotate(0deg)}

    .pp-tab.active{color:#0b1120;background:#f8fafc;}
    .pp-tab:hover{color:#0b1120;background:#f8fafc}

    .pp-close-fab{
      position:absolute;
      right:10px;
      bottom:-62px;
      width:48px;height:48px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#fff;
      color:#0b1120;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      font-weight:900;
    }
    .pp-close-fab:hover{filter:brightness(1.02)}

    .pp-settings{
      border:1px solid #eef2f7;
      border-radius:18px;
      padding:12px 12px;
      background:#fff;
    }
    .pp-settings h3{margin:0 0 10px;font-size:13.5px;font-weight:1000;color:#0b1120}
    .pp-setting-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 10px;border:1px solid #eef2f7;border-radius:14px;background:#fff;margin-bottom:10px}
    .pp-select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      border:1px solid #e2e8f0;
      background:#f8fafc;
      color:#0b1120;
      font-weight:900;
      font-size:12px;
      border-radius:12px;
      padding:10px 34px 10px 12px;
      cursor:pointer;
      line-height:1;
      box-shadow:0 10px 22px rgba(2,6,23,.05);
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23647569' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 10px center;
      background-size:18px 18px;
    }
    .pp-select:focus{outline:none;border-color:rgba(56,189,248,.9);box-shadow:0 0 0 4px rgba(56,189,248,.12)}
    .pp-select:hover{filter:brightness(1.01)}
    .pp-setting-item .k{font-weight:900;color:#0b1120;font-size:12px}
    .pp-setting-item .v{font-weight:900;color:#64748b;font-size:12px}
    .pp-setting-link{display:block;text-align:center;margin-top:6px;color:#0ea5e9;font-weight:1000;text-decoration:none}

    .typing{display:inline-flex;gap:4px;align-items:center}
    .dot{width:6px;height:6px;border-radius:999px;background:#94a3b8;animation:bounce 1.1s infinite}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.3s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.5}40%{transform:translateY(-4px);opacity:1}}

    @media (max-width: 900px){
      .hero{padding:18px;min-height:100vh;align-items:flex-start;padding-top:72px;}
      .hero-content{max-width:100%;padding-bottom:90px;}
      h1{font-size:clamp(28px,8vw,42px);margin:14px 0 12px;}
      p{font-size:16px;line-height:1.55;margin-bottom:18px;}

      .cta{width:100%;max-width:520px;margin-top:10px;margin-bottom:18px;}
      .alert-box{position:relative;right:auto;bottom:auto;width:100%;max-width:520px;margin-top:18px;}

      .chat-launcher{right:14px;bottom:calc(14px + env(safe-area-inset-bottom));}
      .chat-peek{display:none;}

      .chat-window{left:12px;right:12px;width:auto;bottom:calc(86px + env(safe-area-inset-bottom));max-height:78vh;}

      .disc-btn{left:14px;right:auto;bottom:calc(14px + env(safe-area-inset-bottom));padding:8px 12px;font-size:11px;z-index:26000;opacity:.92;}
    }

    /* Funnel modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:20000;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:21000;}
    .card{width:min(760px,96vw);background:#ffffff;color:#0b1323;border-radius:18px;box-shadow:0 40px 100px rgba(0,0,0,.8);overflow:hidden;border:1px solid #e5e7eb;}

/* Mobile-friendly CTA modal (bottom-sheet style) */
@media (max-width: 600px){
  .modal{align-items:flex-end;}
  .card{
    width:100%;
    max-width:100%;
    max-height:85vh;
    border-radius:18px 18px 0 0;
  }
  .card-head{position:sticky;top:0;z-index:2;}
  .card-body{overflow:auto;-webkit-overflow-scrolling:touch;}
}

/* Stepper (used mainly on mobile) */
.stepper{
  display:none;
  padding:12px 2px 10px;
  margin:0 0 8px;
}
.stepper-top{display:flex;align-items:baseline;justify-content:space-between;gap:10px;}
.stepper-kicker{font-size:11px;font-weight:900;color:#64748b;letter-spacing:.02em;}
.stepper-title{font-size:12px;font-weight:1000;color:#0b1120;}
.stepper-dots{display:flex;gap:8px;margin-top:10px;}
.dotx{width:10px;height:10px;border-radius:999px;background:#e2e8f0;}
.dotx.active{background:#0b1120;}
.stepper-bar{height:6px;border-radius:999px;background:#eef2f7;margin-top:10px;overflow:hidden;}
.stepper-bar-fill{display:block;height:100%;width:33.33%;background:#0b1120;transition:width .2s ease;}

.steps{margin-top:6px;}
.step{display:none;}
.step.active{display:block;}

/* Desktop keeps the original two-column feel */
@media (min-width: 601px){
  .stepper{display:none;}
  .step{display:block;}
  .row-mobile{display:none !important;}
}

/* Mobile: one step at a time + sticky step controls */
@media (max-width: 600px){
  .stepper{display:block;}
  .grid{grid-template-columns:1fr !important;}
  .row-desktop{display:none !important;}
  .row-mobile{
    position:sticky;
    bottom:0;
    left:0;right:0;
    padding:12px 0 0;
    background:linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,1) 28%);
    gap:10px;
    justify-content:space-between;
  }
  .row-mobile .btn{flex:1;}
}


    .card-head{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:#f8fafc;border-bottom:1px solid #e5e7eb;}
    .card-head h2{margin:0;font-size:16px;font-weight:900;}
    .card-head p{margin:2px 0 0;font-size:12px;color:#475569;max-width:none;}
    .icon-btn{background:transparent;border:none;font-size:18px;cursor:pointer;color:#475569;}
    .card-body{padding:14px 16px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:740px){.grid{grid-template-columns:1fr;}}
    .field{display:grid;gap:6px;}
    .field label{font-size:12px;font-weight:900;color:#0f172a;}
    .field input,.field select,.field textarea{padding:12px;border-radius:12px;border:1px solid #cbd5e1;font-size:14px;}
    .field textarea{resize:vertical;min-height:90px;}
    .hint{font-size:11px;color:#64748b;font-weight:700;}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px;}
    .btn{padding:12px 14px;border-radius:12px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:900;}
    .btn-primary{border:1px solid #0b1120;background:#0b1120;color:#e5e7eb;}
    .status{display:none;margin-top:10px;font-size:12px;font-weight:800;}
    .status.ok{color:#166534;}
    .status.err{color:#b91c1c;}

    /* Disclaimer button */
    .disc-btn{position:fixed;left:18px;bottom:18px;z-index:15000;background:rgba(15,23,42,.85);backdrop-filter:blur(10px);border:1px solid rgba(148,196,255,.45);color:#e5e7eb;padding:10px 14px;border-radius:999px;font-weight:900;font-size:12px;cursor:pointer;box-shadow:0 16px 50px rgba(0,0,0,.6)}
    .disc-btn:hover{filter:brightness(1.06)}

    /* Disclaimer modal */
    .disc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.72);backdrop-filter:blur(6px);display:none;z-index:30000;}
    .disc-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:31000;overflow:auto;}
    .disc-card{width:min(880px,96vw);max-height:86vh;background:#ffffff;color:#0b1323;border-radius:22px;box-shadow:0 50px 130px rgba(0,0,0,.85);overflow:hidden;border:1px solid rgba(148,196,255,.35);position:relative;}
    .disc-card::before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(1200px 500px at 20% -10%, rgba(56,189,248,.18), transparent 55%),radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.14), transparent 55%);}
    .disc-head{position:relative;display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:14px 16px;background:linear-gradient(180deg,#0b1120,#0f172a);border-bottom:1px solid rgba(148,196,255,.25);color:#e5e7eb;}
    .disc-head h2{margin:0;font-size:16px;font-weight:900;letter-spacing:.01em;}
    .disc-kicker{margin:4px 0 0;font-size:12px;color:rgba(226,232,240,.9);font-weight:800;max-width:66ch;line-height:1.35;}
    .disc-icon{width:34px;height:34px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;border:1px solid rgba(148,196,255,.45);background:rgba(15,23,42,.5);box-shadow:0 10px 30px rgba(0,0,0,.35);font-weight:900;}
    .disc-head-left{display:flex;gap:12px;align-items:flex-start;}
    .disc-close{background:rgba(248,250,252,.06);border:1px solid rgba(148,196,255,.35);color:#e5e7eb;border-radius:12px;padding:8px 10px;font-weight:900;cursor:pointer;}
    .disc-close:hover{filter:brightness(1.08)}

    .disc-body{position:relative;padding:14px 16px 12px;font-size:14px;line-height:1.55;color:#0b1120;overflow:auto;max-height:calc(86vh - 62px - 74px);font-weight:700;}
    .disc-body p{margin:0 0 10px;font-weight:700;color:#0b1120;}
    .disc-body strong{font-weight:900;color:#020617;}
    .disc-sections{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:860px){.disc-sections{grid-template-columns:1fr;}}

    .disc-section{border:1px solid #e5e7eb;border-radius:16px;background:#ffffff;box-shadow:0 10px 26px rgba(0,0,0,.06);overflow:hidden;}
    .disc-sec-head{display:flex;gap:10px;align-items:flex-start;padding:12px 12px;background:linear-gradient(180deg,#ffffff,#f8fafc);border-bottom:1px solid #e5e7eb;}
    .disc-sec-badge{width:30px;height:30px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#0b1120;border:1px solid rgba(56,189,248,.35);background:rgba(56,189,248,.12);}
    .disc-sec-title{margin:0;font-size:13px;font-weight:900;color:#0b1120;}
    .disc-sec-sub{margin:2px 0 0;font-size:11px;color:#64748b;font-weight:800;line-height:1.35;}
    .disc-sec-body{padding:12px 12px 10px;font-size:13px;color:#0b1120;}
    .disc-sec-body ul{margin:0;padding-left:18px;display:grid;gap:8px;}
    .disc-sec-body li{margin:0;}

    .disc-footer-note{margin-top:12px;padding:12px;border-radius:16px;border:1px dashed rgba(15,23,42,.25);background:rgba(248,250,252,.9);font-size:12px;color:#0f172a;font-weight:800;}

    .disc-actions{position:relative;display:flex;gap:10px;justify-content:flex-end;padding:12px 16px;background:linear-gradient(180deg,#f8fafc,#ffffff);border-top:1px solid #e5e7eb;}
    .disc-actions .btn{min-width:140px}
    .btn-accept{border:1px solid rgba(34,197,94,.35);background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.08));color:#0b1120;}
    .btn-accept:hover{filter:brightness(1.03)}
  </style>
</head>

<body>

<section class="hero">
  <!-- Rotating background images (PNG) -->
  <div class="hero-rotator" aria-hidden="true">
    <img class="hero-slide active" id="heroImg0" data-pos="house" alt="" loading="eager" decoding="async" src="hero-house.png">
    <img class="hero-slide" id="heroImg1" data-pos="auto" alt="" loading="eager" decoding="async" src="hero-auto.png">
    <img class="hero-slide" id="heroImg2" data-pos="business" alt="" loading="eager" decoding="async" src="hero-business.png">
  </div>

  <div class="hero-content">
    <h1 class="hero-headline" id="heroHeader" data-i18n="hero_header_home">Home Insurance</h1>
    <button class="cta" id="openFunnel" type="button" data-i18n="cta_check">Check My Options</button>
  </div>
</section>

<!-- Hidden iframe used to post leads to Google Apps Script without CORS issues -->
<iframe id="gas_iframe" name="gas_iframe" style="display:none;"></iframe>

<!-- Lead Funnel Modal (fallback if CLICKFUNNEL_URL is blank) -->
<div class="modal-overlay" id="modalOverlay"></div>
<div class="modal" id="modal">
  <div class="card" role="dialog" aria-label="Options pre-check form">
    <div class="card-head">
      <div>
        <h2>Quick Options Pre-Check</h2>
        <p>2 minutes. Not a quote. A licensed agent reviews and follows up with carrier-agnostic options.</p>
      </div>
      <button class="icon-btn" id="closeModal" type="button">âœ•</button>
    </div>
    <div class="card-body">
      <form id="leadForm">
        <!-- Stepper (mobile-first) -->
        <div class="stepper" id="stepper" aria-label="Form progress">
          <div class="stepper-top">
            <div class="stepper-kicker" id="stepperKicker">Step 1 of 3</div>
            <div class="stepper-title">A quick pre-check</div>
          </div>
          <div class="stepper-dots" role="presentation">
            <span class="dotx active" data-dot="0"></span>
            <span class="dotx" data-dot="1"></span>
            <span class="dotx" data-dot="2"></span>
            <span class="dotx" data-dot="3"></span>
          </div>
          <div class="stepper-bar" aria-hidden="true"><span class="stepper-bar-fill" id="stepperBarFill"></span></div>
        </div>

        <!-- Steps: keep the SAME field IDs so GAS submit still works -->
        <div class="steps" id="steps">
          <!-- STEP 1 -->
          <section class="step active" data-step="0" aria-label="Step 1">
            <div class="grid">
              <div class="field">
                <label for="firstName">First name *</label>
                <input id="firstName" name="firstName" autocomplete="given-name" required />
              </div>
              <div class="field">
                <label for="lastName">Last name *</label>
                <input id="lastName" name="lastName" autocomplete="family-name" required />
              </div>
              <div class="field" style="grid-column:1 / -1;">
                <label for="zip">ZIP *</label>
                <input id="zip" name="zip" inputmode="numeric" pattern="[0-9]{5}" placeholder="81501" required />
                <div class="hint">Example reference ZIP: 81501</div>
              </div>
            </div>
          </section>

          <!-- STEP 2 -->
          <section class="step" data-step="1" aria-label="Step 2">
            <div class="grid">
              <div class="field">
                <label for="email">Email *</label>
                <input id="email" name="email" type="email" autocomplete="email" required />
              </div>
              <div class="field">
                <label for="phone">Mobile phone *</label>
                <input id="phone" name="phone" type="tel" autocomplete="tel" required />
              </div>
              <div class="field">
                <label for="homeowner">Home status *</label>
                <select id="homeowner" name="homeowner" required>
                  <option value="">Selectâ€¦</option>
                  <option>Own</option>
                  <option>Rent</option>
                  <option>Buying soon</option>
                </select>
              </div>
              <div class="field">
                <label for="vehicles">Vehicles insured *</label>
                <select id="vehicles" name="vehicles" required>
                  <option value="">Selectâ€¦</option>
                  <option>1</option><option>2</option><option>3</option><option>4+</option>
                </select>
              </div>
              <div class="field" style="grid-column:1 / -1;">
                <label for="timeframe">When do you need this? *</label>
                <select id="timeframe" name="timeframe" required>
                  <option value="">Selectâ€¦</option>
                  <option>ASAP</option>
                  <option>Within 7 days</option>
                  <option>Within 30 days</option>
                  <option>Just exploring</option>
                </select>
              </div>
            </div>
          </section>

          <!-- STEP 3: Policy Health Check (3â€“5 quick questions) -->
          <section class="step" data-step="2" aria-label="Step 3">
            <div class="grid">
              <div class="field" style="grid-column:1 / -1;">
                <label style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
                  <span>Policy Health Check</span>
                  <span class="hint" style="margin:0;">Takes ~30 seconds</span>
                </label>
                <div class="hint">Answer a few simple questions so we can spot common coverage gaps (general info; agent review required).</div>
              </div>

              <div class="field" style="grid-column:1 / -1;">
                <label>1) Any life changes in the last 12 months? (select all)</label>
                <div class="hint">Changes are the #1 reason policies stop matching real life.</div>
                <div class="phc-grid" id="phcChanges">
                  <label class="phc-chip"><input type="checkbox" value="Moved/bought home">Moved/bought home</label>
                  <label class="phc-chip"><input type="checkbox" value="New driver/teen driver">New driver/teen driver</label>
                  <label class="phc-chip"><input type="checkbox" value="New vehicle/financed/leased">New vehicle/financed/leased</label>
                  <label class="phc-chip"><input type="checkbox" value="Marriage/divorce/new baby">Marriage/divorce/new baby</label>
                  <label class="phc-chip"><input type="checkbox" value="Work from home/home business">Work from home/home business</label>
                  <label class="phc-chip"><input type="checkbox" value="Major remodel/new roof/solar">Major remodel/new roof/solar</label>
                  <label class="phc-chip"><input type="checkbox" value="None">None</label>
                </div>
              </div>

              <div class="field">
                <label for="phcProperty">2) Property situation *</label>
                <select id="phcProperty" name="phcProperty" required>
                  <option value="">Selectâ€¦</option>
                  <option>Own a home</option>
                  <option>Rent</option>
                  <option>Condo/Townhome</option>
                  <option>Landlord/Rental property</option>
                  <option>Not sure</option>
                </select>
              </div>

              <div class="field">
                <label for="phcDeductible">3) Comfortable out-of-pocket if a claim happened tomorrow? *</label>
                <select id="phcDeductible" name="phcDeductible" required>
                  <option value="">Selectâ€¦</option>
                  <option>$500â€“$1,000</option>
                  <option>$1,000â€“$2,500</option>
                  <option>$2,500â€“$5,000+</option>
                  <option>Not sure</option>
                </select>
              </div>

              <div class="field">
                <label for="phcLiability">4) If you were sued after an accident/injury, how protected do you feel? *</label>
                <select id="phcLiability" name="phcLiability" required>
                  <option value="">Selectâ€¦</option>
                  <option>Very protected (high liability / umbrella)</option>
                  <option>Somewhat protected</option>
                  <option>Not protected / Not sure</option>
                </select>
              </div>

              <div class="field">
                <label for="phcReview">5) Last full policy review with a licensed agent? *</label>
                <select id="phcReview" name="phcReview" required>
                  <option value="">Selectâ€¦</option>
                  <option>Within 12 months</option>
                  <option>1â€“3 years ago</option>
                  <option>3+ years ago / never</option>
                  <option>Not sure</option>
                </select>
              </div>

              <div class="field" style="grid-column:1 / -1;">
                <label>Optional: Any property risk flags? (select all)</label>
                <div class="phc-grid" id="phcRisks">
                  <label class="phc-chip"><input type="checkbox" value="Wildfire/brush nearby">Wildfire/brush nearby</label>
                  <label class="phc-chip"><input type="checkbox" value="Hail-prone / roof 10+ yrs">Hail-prone / roof 10+ yrs</label>
                  <label class="phc-chip"><input type="checkbox" value="Basement/sump pump">Basement/sump pump</label>
                  <label class="phc-chip"><input type="checkbox" value="Pool/trampoline/dog">Pool/trampoline/dog</label>
                  <label class="phc-chip"><input type="checkbox" value="Not sure">Not sure</label>
                  <label class="phc-chip"><input type="checkbox" value="None">None</label>
                </div>
              </div>
            </div>
          </section>

          <!-- STEP 4 -->
          <section class="step" data-step="3" aria-label="Step 4">
            <div class="grid">
              <div class="field" style="grid-column:1 / -1;">
                <label for="roofAge">Roof age</label>
                <select id="roofAge" name="roofAge">
                  <option value="">Selectâ€¦</option>
                  <option>0-5</option><option>6-10</option><option>11-15</option><option>16-20</option><option>21+</option><option>Not sure</option>
                </select>
              </div>
              <div class="field" style="grid-column:1 / -1;">
                <label for="notes">Notes (optional)</label>
                <textarea id="notes" name="notes" placeholder="Any details that help (hail claim history, wildfire concerns, bundling, etc.)"></textarea>
              </div>
              <div class="field" style="grid-column:1 / -1;">
                <label style="display:flex;gap:10px;align-items:flex-start;font-weight:800;color:#0f172a;">
                  <input id="consent" type="checkbox" required style="margin-top:2px;" />
                  I agree to be contacted by phone, SMS, and email about insurance options. Msg &amp; data rates may apply.
                </label>
              </div>
            </div>
          </section>
        </div>

        <!-- Desktop buttons (unchanged) -->
        <div class="row row-desktop" id="rowDesktop">
          <button class="btn" id="cancelBtn" type="button">Cancel</button>
          <button class="btn btn-primary" id="submitBtn" type="submit">Submit</button>
        </div>

        <!-- Mobile step buttons -->
        <div class="row row-mobile" id="rowMobile" aria-label="Step controls">
          <button class="btn" id="stepBack" type="button">Back</button>
          <button class="btn btn-primary" id="stepNext" type="button">Next</button>
          <button class="btn btn-primary" id="stepSubmit" type="submit" style="display:none;">Submit</button>
        </div>

        <div class="status" id="formStatus"></div>
      </form>
    </div>
  </div>
</div>

<!-- Disclaimer launcher -->
<button class="disc-btn" id="openDisclaimer" type="button" data-i18n="disclaimer_btn">Disclaimer</button>

<!-- Disclaimer modal -->
<div class="disc-overlay" id="discOverlay"></div>
<div class="disc-modal" id="discModal" role="dialog" aria-label="Legal disclaimer">
  <div class="disc-card">
    <div class="disc-head">
      <div class="disc-head-left">
        <div class="disc-icon">âš–</div>
        <div>
          <h2>Legal Disclaimer</h2>
          <div class="disc-kicker">Please review. This site includes AI-assisted information. <b>Human review is required</b> before any quote, application, binding, or policy change.</div>
        </div>
      </div>
      <button class="disc-close" id="discClose" type="button" aria-label="Close disclaimer">Close âœ•</button>
    </div>
    <div class="disc-body">
      <div class="disc-sections">
        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">i</div>
            <div>
              <p class="disc-sec-title">General information only</p>
              <p class="disc-sec-sub">Not legal, tax, or financial advice</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>This page and <strong>PolicyProâ„¢</strong> provide <strong>general educational information</strong> about insurance concepts.</li>
              <li>Nothing here is legal advice, tax advice, or a substitute for professional guidance.</li>
              <li>Examples (including ZIP <strong>81501</strong>) are <strong>illustrative only</strong>.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">AI</div>
            <div>
              <p class="disc-sec-title">AI disclosure</p>
              <p class="disc-sec-sub">AI output can be wrong or incomplete</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li><strong>PolicyProâ„¢</strong> includes automated and artificial-intelligenceâ€“generated responses for general informational purposes.</li>
              <li>AI output may be incomplete, inaccurate, or outdated and must not be relied upon as a definitive statement of coverage, pricing, underwriting eligibility, or claim outcome.</li>
              <li>AI responses do <strong>not</strong> replace advice from a licensed insurance producer.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">âœ“</div>
            <div>
              <p class="disc-sec-title">Human review required</p>
              <p class="disc-sec-sub">Before quotes, applications, or changes</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Any quote indications, coverage discussions, or next steps require <strong>review and confirmation</strong> by a licensed insurance agent before any application is submitted or coverage is bound.</li>
              <li>Nothing on this page constitutes an offer to sell insurance or bind coverage.</li>
            </ul>
          </div>
        </section>

        <section class="disc-section">
          <div class="disc-sec-head">
            <div class="disc-sec-badge">ðŸ›¡</div>
            <div>
              <p class="disc-sec-title">Coverage &amp; claims limitations</p>
              <p class="disc-sec-sub">Carrier rules and policy terms control</p>
            </div>
          </div>
          <div class="disc-sec-body">
            <ul>
              <li>Coverage, eligibility, rates, discounts, underwriting, and availability vary by carrier and are subject to policy terms, conditions, exclusions, limits, and deductibles.</li>
              <li>Claim scenario walkthroughs are general and may not apply to your situation. Always follow your policy and carrier instructions. If there is immediate danger, call emergency services.</li>
            </ul>
          </div>
        </section>
      </div>

      <div class="disc-footer-note">
        <strong>Consent &amp; privacy:</strong> By submitting your information, you authorize contact by phone, SMS, and email about insurance options (msg &amp; data rates may apply). Information may be stored in a secure Google Sheet and emailed to the business inbox for follow-up. Do not submit sensitive information you do not want transmitted electronically.
      </div>
    </div>

    <div class="disc-actions">
      <button class="btn btn-accept" id="discAccept" type="button">I Accept</button>
      <button class="btn btn-primary" id="discClose2" type="button">Close</button>
    </div>
  </div>
</div>

<!-- Channel.io-style launcher -->
<div class="chat-launcher" id="chatBtn" aria-label="Open PolicyPro chat" title="Ask PolicyProâ„¢ a question">
  <div class="chat-peek" aria-hidden="true">
    <div class="chat-label" data-i18n="chat_peek_label">Need help?</div>
    <div class="chat-name" data-i18n="chat_peek_name">Chat with PolicyProâ„¢</div>
  </div>
  <div class="chat-bubble" role="button" aria-label="Chat bubble">
    <div class="chat-avatar">PP</div>
  </div>
</div>

<div class="chat-window" id="chatWindow" aria-label="PolicyPro widget" role="dialog">
  <div class="pp-widget">
    <div class="pp-top" aria-hidden="true">
      <div class="pp-topbar">
        <div class="pp-brand">PolicyProâ„¢</div>
      </div>
    </div>

    <div class="pp-body">
      <!-- HOME -->
      <div class="pp-screen active" id="ppScreenHome">
        <div class="pp-home-card">
          <div class="pp-home-row">
            <div class="pp-avatar">PP</div>
            <div>
              <p class="pp-home-title" data-i18n="pp_home_title">Hi â€” how can we help?</p>
              <p class="pp-home-sub" data-i18n="pp_home_sub">Ask a Colorado home or auto insurance question. General info only â€” a licensed agent reviews before any quote, application, or binding.</p>
            </div>
          </div>
          <button class="pp-primary" id="ppStartChat" type="button"><span data-i18n="pp_start_chat">Start a chat</span> <span aria-hidden="true">âž¤</span></button>
        </div>
        <div class="pp-footer-note" data-i18n="pp_powered">Powered by PolicyPro</div>
      </div>

      <!-- MESSAGES -->
      <div class="pp-screen" id="ppScreenMessages">
        <div class="pp-messages-wrap">
          <div class="chat-main">
            <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

            <form class="chat-inputbar" id="chatForm" autocomplete="off">
              <input class="chat-input" id="chatInput" type="text" placeholder="Ask about hail deductibles, wildfire coverage, bundlingâ€¦" data-i18n-placeholder="chat_placeholder" />
              <button class="send-btn" id="chatSend" type="submit" data-i18n="chat_send">Send</button>
            </form>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div class="pp-screen" id="ppScreenSettings">
        <div class="pp-settings">
          <h3 data-i18n="settings_title">Settings</h3>
          <div class="pp-setting-item"><div class="k" data-i18n="settings_contact">Contact</div><div class="v" id="ppAgentEmail">securechoicein@gmail.com</div></div>
          <div class="pp-setting-item">
            <div class="k" data-i18n="settings_language">Language</div>
            <div class="v">
              <select id="ppLangSelect" class="pp-select" aria-label="Select language">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="ja">Japanese</option>
                <option value="zh">Chinese</option>
                <option value="fr">French</option>
                <option value="ru">Russian</option>
              </select>
            </div>
          </div>
          <div class="pp-setting-item"><div class="k" data-i18n="settings_disclaimer">Disclaimer</div><div class="v" data-i18n="settings_available">Available</div></div>
          <a class="pp-setting-link" href="#" id="ppOpenDisclaimerLink" data-i18n="settings_open_disclaimer">Open legal disclaimer</a>
        </div>
      </div>
    </div>

    <div class="pp-tabs" role="tablist" aria-label="Widget tabs">
      <button class="pp-tab active" id="ppTabHome" type="button" role="tab" aria-selected="true" aria-controls="ppScreenHome">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5"/><path d="M5 10v10h14V10"/></svg>
        <span data-i18n="tab_home">Home</span>
      </button>
      <button class="pp-tab" id="ppTabMessages" type="button" role="tab" aria-selected="false" aria-controls="ppScreenMessages">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg>
        <span data-i18n="tab_messages">Messages</span>
      </button>
      <button class="pp-tab" id="ppTabSettings" type="button" role="tab" aria-selected="false" aria-controls="ppScreenSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/><path d="M19.4 15a1.7 1.7 0 0 0 .3 1.8l.1.1a2 2 0 0 1-1.4 3.4h-.2a1.8 1.8 0 0 0-1.7 1.3 2 2 0 0 1-3.8 0 1.8 1.8 0 0 0-1.7-1.3H9a2 2 0 0 1-1.4-3.4l.1-.1A1.7 1.7 0 0 0 8.6 15a1.8 1.8 0 0 0-.7-1.7 2 2 0 0 1 0-3.1 1.8 1.8 0 0 0 .7-1.7 1.7 1.7 0 0 0-.3-1.8l-.1-.1A2 2 0 0 1 9.6 3h.2a1.8 1.8 0 0 0 1.7-1.3 2 2 0 0 1 3.8 0 1.8 1.8 0 0 0 1.7 1.3h.2a2 2 0 0 1 1.4 3.4l-.1.1a1.7 1.7 0 0 0-.3 1.8 1.8 1.8 0 0 0 .7 1.7 2 2 0 0 1 0 3.1 1.8 1.8 0 0 0-.7 1.7z"/></svg>
        <span data-i18n="tab_settings">Settings</span>
      </button>
    </div>
  </div>

  <button class="pp-close-fab" id="closeChat" aria-label="Close chat" type="button">âœ•</button>
</div>

<script>
  // ===== Lead funnel + Google Apps Script backend =====
  var GAS = window.GAS_WEBAPP_URL || "";
  var CLICKFUNNEL_URL = (window.CLICKFUNNEL_URL || '').trim();

  var openFunnelBtn = document.getElementById('openFunnel');
  var modalOverlay = document.getElementById('modalOverlay');
  var modal = document.getElementById('modal');
  var closeModalBtn = document.getElementById('closeModal');
  var cancelBtn = document.getElementById('cancelBtn');
  var leadForm = document.getElementById('leadForm');
  var formStatus = document.getElementById('formStatus');

  function showModal(){ if(modalOverlay) modalOverlay.style.display='block'; if(modal) modal.style.display='flex'; try{ resetStepper_(); }catch(e){} }
  function hideModal(){ if(modalOverlay) modalOverlay.style.display='none'; if(modal) modal.style.display='none'; try{ resetStepper_(); }catch(e){} }

  if(closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
  if(cancelBtn) cancelBtn.addEventListener('click', hideModal);
  if(modalOverlay) modalOverlay.addEventListener('click', hideModal);

  // ===== Step-based mobile funnel (3 steps) =====
  var stepper = document.getElementById('stepper');
  var stepsWrap = document.getElementById('steps');
  var stepKicker = document.getElementById('stepperKicker');
  var stepBarFill = document.getElementById('stepperBarFill');
  var stepDots = document.querySelectorAll('.dotx');
  var stepBack = document.getElementById('stepBack');
  var stepNext = document.getElementById('stepNext');
  var stepSubmit = document.getElementById('stepSubmit');

  var __stepIndex = 0;
  var __stepTotal = 4;

  function isMobile_(){ return window.matchMedia && window.matchMedia('(max-width: 600px)').matches; }

  function setStep_(idx){
    __stepIndex = Math.max(0, Math.min(__stepTotal-1, idx|0));

    if(stepsWrap){
      var stepEls = stepsWrap.querySelectorAll('.step');
      for(var i=0;i<stepEls.length;i++){
        stepEls[i].classList.toggle('active', i === __stepIndex);
      }
    }

    if(stepDots && stepDots.length){
      for(var d=0;d<stepDots.length;d++) stepDots[d].classList.toggle('active', d === __stepIndex);
    }

    if(stepKicker) stepKicker.textContent = 'Step ' + (__stepIndex+1) + ' of ' + __stepTotal;
    if(stepBarFill) stepBarFill.style.width = (( (__stepIndex+1) / __stepTotal) * 100) + '%';

    if(stepBack) stepBack.style.display = (__stepIndex === 0) ? 'none' : 'inline-flex';
    if(stepNext) stepNext.style.display = (__stepIndex === __stepTotal-1) ? 'none' : 'inline-flex';
    if(stepSubmit) stepSubmit.style.display = (__stepIndex === __stepTotal-1) ? 'inline-flex' : 'none';

    // Focus first input in step (mobile UX)
    try{
      if(isMobile_() && stepsWrap){
        var cur = stepsWrap.querySelector('.step.active');
        if(cur){
          var focusEl = cur.querySelector('input,select,textarea');
          if(focusEl) setTimeout(function(){ focusEl.focus(); }, 50);
        }
      }
    }catch(e){}
  }

  function validateStep_(idx){
    if(!stepsWrap) return true;
    var stepEls = stepsWrap.querySelectorAll('.step');
    var cur = stepEls && stepEls[idx];
    if(!cur) return true;

    // Validate only visible/required fields in this step
    var fields = cur.querySelectorAll('input,select,textarea');
    for(var i=0;i<fields.length;i++){
      var el = fields[i];
      if(el && typeof el.reportValidity === 'function'){
        if(!el.checkValidity()){
          el.reportValidity();
          return false;
        }
      }
    }
    return true;
  }

  function resetStepper_(){
    // Only enforce step UI on mobile; desktop shows all sections
    if(!isMobile_()) return;
    setStep_(0);
  }

  if(stepBack) stepBack.addEventListener('click', function(){ setStep_(__stepIndex - 1); });
  if(stepNext) stepNext.addEventListener('click', function(){
    if(validateStep_(__stepIndex)) setStep_(__stepIndex + 1);
  });

  // Ensure step state correct on resize/orientation
  window.addEventListener('resize', function(){
    try{ if(isMobile_()) resetStepper_(); }catch(e){}
  });


  function postToGAS(url, payload){
    // GitHub Pages -> Apps Script often hits CORS/preflight issues.
    // Most reliable: submit a hidden form to a hidden iframe (no CORS needed).
    return new Promise(function(resolve, reject){
      try{
        if(!url || url.indexOf('http') !== 0){
          reject(new Error('Invalid GAS URL'));
          return;
        }

        // Create (or reuse) hidden iframe
        var iframeId = 'gas_post_iframe_v1';
        var iframe = document.getElementById(iframeId);
        if(!iframe){
          iframe = document.createElement('iframe');
          iframe.id = iframeId;
          iframe.name = iframeId;
          iframe.style.display = 'none';
          document.body.appendChild(iframe);
        }

        // Create (or reuse) hidden form
        var formId = 'gas_post_form_v1';
        var form = document.getElementById(formId);
        if(!form){
          form = document.createElement('form');
          form.id = formId;
          form.method = 'POST';
          form.style.display = 'none';

          var input = document.createElement('input');
          input.type = 'hidden';
          input.name = 'payload';
          input.id = 'gas_payload_input_v1';
          form.appendChild(input);

          document.body.appendChild(form);
        }

        form.action = url;
        form.target = iframeId;

        var payloadInput = document.getElementById('gas_payload_input_v1');
        payloadInput.value = JSON.stringify(payload || {});

        // Submit
        form.submit();

        // We can't read the iframe response due to cross-origin, so treat as success
        // after a short delay (Apps Script receives it server-side).
        setTimeout(function(){ resolve({ ok:true, opaque:true }); }, 650);
      }catch(e){
        reject(e);
      }
    });
  }

  var POLICYPRO_MODE = ((window.POLICYPRO_MODE || '') + '').trim().toLowerCase() || 'local';
  var CHAT_ENDPOINT = (POLICYPRO_MODE === 'remote')
    ? (((window.POLICYPRO_LLM_ENDPOINT || '').trim() || (window.GAS_WEBAPP_URL || '').trim()))
    : '';

  var chatHistory = [];

  // Persist chat
  var PP_CHAT_KEY = 'pp_chat_state_v1';

  function loadChatState_(){
    try{
      var raw = localStorage.getItem(PP_CHAT_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch(e){ return null; }
  }

  function saveChatState_(){
    try{
      var state = {
        history: chatHistory.slice(-60),
        rendered: []
      };
      if(chatMessages){
        var msgEls = chatMessages.querySelectorAll('.msg');
        for(var i=0;i<msgEls.length;i++){
          var isUser = msgEls[i].classList.contains('user');
          var bub = msgEls[i].querySelector('.bubble');
          state.rendered.push({ role: isUser ? 'user' : 'bot', html: bub ? bub.innerHTML : '' });
        }
        var suggest = chatMessages.querySelector('.pp-suggest-wrap');
        if(suggest && !state.rendered.length){
          state.suggest = true;
        }
      }
      localStorage.setItem(PP_CHAT_KEY, JSON.stringify(state));
    }catch(e){}
  }

  function restoreChatUI_(){
    var state = loadChatState_();
    if(!state || !chatMessages) return;

    try{
      chatMessages.innerHTML = '';
      if(Array.isArray(state.rendered) && state.rendered.length){
        state.rendered.forEach(function(m){
          var wrap = document.createElement('div');
          wrap.className = 'msg ' + (m.role === 'user' ? 'user' : 'bot');
          var b = document.createElement('div');
          b.className = 'bubble ' + (m.role === 'user' ? 'user' : 'bot');
          b.innerHTML = m.html || '';
          wrap.appendChild(b);
          chatMessages.appendChild(wrap);
        });
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      if(Array.isArray(state.history)) chatHistory = state.history;
    }catch(e){}
  }

  restoreChatUI_();

  // =========================
  // i18n
  // =========================
  var PP_LANG_KEY = 'pp_lang_v1';

  function getLang_(){
    try{ return (localStorage.getItem(PP_LANG_KEY) || 'en'); }catch(e){ return 'en'; }
  }
  function setLang_(v){
    try{ localStorage.setItem(PP_LANG_KEY, String(v||'en')); }catch(e){}
  }

  function i18nDict_(){
    return {
      en:{
        doc_title:'Colorado Relief Options â€” Home & Auto Insurance',
        meta_desc:'Colorado residents: explore flexible home & auto insurance options designed to protect your budget and peace of mind.',
        hero_h1:'Get flexible home & auto options that fit your budget and protect what matters.',
        hero_header_home:'Home Insurance',
        hero_header_auto:'Car Insurance',
        hero_header_business:'Business Insurance',
        cta_check:'Check My Options',
        disclaimer_btn:'Disclaimer',
        chat_peek_label:'Need help?',
        chat_peek_name:'Chat with PolicyProâ„¢',
        pp_home_title:'Hi â€” how can we help?',
        pp_home_sub:'Ask a Colorado home or auto insurance question. General info only â€” a licensed agent reviews before any quote, application, or binding.',
        pp_start_chat:'Start a chat',
        tab_home:'Home',
        tab_messages:'Messages',
        tab_settings:'Settings',
        settings_title:'Settings',
        settings_contact:'Contact',
        settings_language:'Language',
        settings_disclaimer:'Disclaimer',
        settings_available:'Available',
        settings_open_disclaimer:'Open legal disclaimer',
        chat_placeholder:'Ask about hail deductibles, wildfire coverage, bundlingâ€¦',
        chat_send:'Send',
        suggest_title:'Popular questions',
        suggest_home:'HOME INSURANCE',
        suggest_auto:'CAR INSURANCE',
        s_home_1:'Does home insurance cover hail and roof damage?',
        s_home_2:'What is a wind/hail deductible (and why is it different)?',
        s_home_3:'What should I check for wildfire/smoke coverage?',
        s_auto_1:'Is hail damage covered on auto insurance?',
        s_auto_2:'What does comprehensive vs collision cover?',
        s_auto_3:'How can I lower my auto premium without losing coverage?'
      },
      es:{
        doc_title:'Opciones en Colorado â€” Seguro de hogar y auto',
        meta_desc:'Residentes de Colorado: explore opciones flexibles de seguro de hogar y auto para proteger su presupuesto y tranquilidad.',
        hero_h1:'ObtÃ©n opciones flexibles de hogar y auto que se ajusten a tu presupuesto y protejan lo importante.',
        hero_header_home:'Seguro de hogar',
        hero_header_auto:'Seguro de auto',
        hero_header_business:'Seguro para negocios',
        cta_check:'Ver mis opciones',
        disclaimer_btn:'Aviso legal',
        chat_peek_label:'Â¿Necesitas ayuda?',
        chat_peek_name:'Chatea con PolicyProâ„¢',
        pp_home_title:'Hola â€” Â¿en quÃ© podemos ayudar?',
        pp_home_sub:'Haz una pregunta sobre seguro de hogar o auto en Colorado. Solo info general â€” un agente con licencia revisa antes de cualquier cotizaciÃ³n o contrataciÃ³n.',
        pp_start_chat:'Iniciar chat',
        tab_home:'Inicio',
        tab_messages:'Mensajes',
        tab_settings:'Ajustes',
        settings_title:'Ajustes',
        settings_contact:'Contacto',
        settings_language:'Idioma',
        settings_disclaimer:'Aviso',
        settings_available:'Disponible',
        settings_open_disclaimer:'Abrir aviso legal',
        chat_placeholder:'Pregunta sobre deducibles por granizo, cobertura de incendios, paquetesâ€¦',
        chat_send:'Enviar',
        suggest_title:'Preguntas populares',
        suggest_home:'SEGURO DE HOGAR',
        suggest_auto:'SEGURO DE AUTO',
        s_home_1:'Â¿El seguro de hogar cubre granizo y daÃ±o del techo?',
        s_home_2:'Â¿QuÃ© es un deducible por viento/granizo?',
        s_home_3:'Â¿QuÃ© debo revisar para cobertura de incendio/humo?',
        s_auto_1:'Â¿El granizo estÃ¡ cubierto en el seguro de auto?',
        s_auto_2:'Â¿QuÃ© cubre comprensivo vs colisiÃ³n?',
        s_auto_3:'Â¿CÃ³mo bajo mi prima sin perder cobertura?'
      },
      ja:{
        doc_title:'ã‚³ãƒ­ãƒ©ãƒ‰ä¿é™ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ â€” ä½å®…ãƒ»è‡ªå‹•è»Š',
        meta_desc:'ã‚³ãƒ­ãƒ©ãƒ‰å·žå‘ã‘ã€‚ä½å®…ä¿é™ºãƒ»è‡ªå‹•è»Šä¿é™ºã®æŸ”è»Ÿãªé¸æŠžè‚¢ã‚’ç¢ºèªã§ãã¾ã™ã€‚',
        hero_h1:'äºˆç®—ã«åˆã†ä½å®…ãƒ»è‡ªå‹•è»Šã®æŸ”è»Ÿãªé¸æŠžè‚¢ã€‚å¤§åˆ‡ãªã‚‚ã®ã‚’å®ˆã‚‹ã€‚',
        hero_header_home:'ä½å®…ä¿é™º',
        hero_header_auto:'è‡ªå‹•è»Šä¿é™º',
        hero_header_business:'äº‹æ¥­ä¿é™º',
        cta_check:'ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¦‹ã‚‹',
        disclaimer_btn:'å…è²¬äº‹é …',
        chat_peek_label:'ãŠå›°ã‚Šã§ã™ã‹ï¼Ÿ',
        chat_peek_name:'PolicyProâ„¢ ã«è³ªå•',
        pp_home_title:'ã“ã‚“ã«ã¡ã¯ â€” ã©ã†ã—ã¾ã—ãŸã‹ï¼Ÿ',
        pp_home_sub:'ã‚³ãƒ­ãƒ©ãƒ‰ã®ä½å®…/è‡ªå‹•è»Šä¿é™ºã«ã¤ã„ã¦è³ªå•ã§ãã¾ã™ï¼ˆä¸€èˆ¬æƒ…å ±ï¼‰ã€‚è¦‹ç©ã‚„åŠ å…¥å‰ã«æœ‰è³‡æ ¼è€…ãŒç¢ºèªã—ã¾ã™ã€‚',
        pp_start_chat:'ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹',
        tab_home:'ãƒ›ãƒ¼ãƒ ',
        tab_messages:'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
        tab_settings:'è¨­å®š',
        settings_title:'è¨­å®š',
        settings_contact:'é€£çµ¡å…ˆ',
        settings_language:'è¨€èªž',
        settings_disclaimer:'å…è²¬äº‹é …',
        settings_available:'åˆ©ç”¨å¯èƒ½',
        settings_open_disclaimer:'å…è²¬äº‹é …ã‚’é–‹ã',
        chat_placeholder:'é›¹ã®å…è²¬ã€å±±ç«äº‹è£œå„Ÿã€ãƒãƒ³ãƒ‰ãƒ«â€¦',
        chat_send:'é€ä¿¡',
        suggest_title:'ã‚ˆãã‚ã‚‹è³ªå•',
        suggest_home:'ä½å®…ä¿é™º',
        suggest_auto:'è‡ªå‹•è»Šä¿é™º',
        s_home_1:'é›¹ã‚„å±‹æ ¹ã®æå®³ã¯è£œå„Ÿã•ã‚Œã‚‹ï¼Ÿ',
        s_home_2:'é¢¨/é›¹ã®å…è²¬ï¼ˆï¼…ï¼‰ã£ã¦ä½•ï¼Ÿ',
        s_home_3:'å±±ç«äº‹/ç…™ã®è£œå„Ÿã§ç¢ºèªã™ã¹ãç‚¹ã¯ï¼Ÿ',
        s_auto_1:'é›¹è¢«å®³ã¯è‡ªå‹•è»Šä¿é™ºã§è£œå„Ÿã•ã‚Œã‚‹ï¼Ÿ',
        s_auto_2:'åŒ…æ‹¬ï¼ˆComprehensiveï¼‰ã¨è¡çªï¼ˆCollisionï¼‰ã®é•ã„ã¯ï¼Ÿ',
        s_auto_3:'è£œå„Ÿã‚’è½ã¨ã•ãšä¿é™ºæ–™ã‚’ä¸‹ã’ã‚‹æ–¹æ³•ã¯ï¼Ÿ'
      },
      zh:{
        doc_title:'ç§‘ç½—æ‹‰å¤šæ–¹æ¡ˆ â€” æˆ¿å±‹ä¸Žæ±½è½¦ä¿é™©',
        meta_desc:'ç§‘ç½—æ‹‰å¤šå±…æ°‘ï¼šäº†è§£æ›´çµæ´»çš„æˆ¿å±‹ä¸Žæ±½è½¦ä¿é™©æ–¹æ¡ˆï¼Œä¿æŠ¤é¢„ç®—ä¸Žå®‰å¿ƒã€‚',
        hero_h1:'èŽ·å–é€‚åˆé¢„ç®—çš„æˆ¿å±‹ä¸Žæ±½è½¦ä¿é™©æ–¹æ¡ˆï¼Œå®ˆæŠ¤é‡è¦èµ„äº§ã€‚',
        hero_header_home:'æˆ¿å±‹ä¿é™©',
        hero_header_auto:'æ±½è½¦ä¿é™©',
        hero_header_business:'å•†ä¸šä¿é™©',
        cta_check:'æŸ¥çœ‹æˆ‘çš„é€‰é¡¹',
        disclaimer_btn:'å…è´£å£°æ˜Ž',
        chat_peek_label:'éœ€è¦å¸®åŠ©ï¼Ÿ',
        chat_peek_name:'å’¨è¯¢ PolicyProâ„¢',
        pp_home_title:'ä½ å¥½ â€” æˆ‘ä»¬èƒ½å¸®ä»€ä¹ˆï¼Ÿ',
        pp_home_sub:'å¯å’¨è¯¢ç§‘ç½—æ‹‰å¤šæˆ¿å±‹/æ±½è½¦ä¿é™©é—®é¢˜ï¼ˆä»…ä¸€èˆ¬ä¿¡æ¯ï¼‰ã€‚æŠ¥ä»·/æŠ•ä¿å‰ç”±æŒç‰Œä»£ç†å¤æ ¸ã€‚',
        pp_start_chat:'å¼€å§‹èŠå¤©',
        tab_home:'ä¸»é¡µ',
        tab_messages:'æ¶ˆæ¯',
        tab_settings:'è®¾ç½®',
        settings_title:'è®¾ç½®',
        settings_contact:'è”ç³»',
        settings_language:'è¯­è¨€',
        settings_disclaimer:'å…è´£å£°æ˜Ž',
        settings_available:'å¯ç”¨',
        settings_open_disclaimer:'æ‰“å¼€å…è´£å£°æ˜Ž',
        chat_placeholder:'è¯¢é—®å†°é›¹å…èµ”ã€é‡Žç«ä¿éšœã€æ‰“åŒ…ä¼˜æƒ â€¦',
        chat_send:'å‘é€',
        suggest_title:'å¸¸è§é—®é¢˜',
        suggest_home:'æˆ¿å±‹ä¿é™©',
        suggest_auto:'æ±½è½¦ä¿é™©',
        s_home_1:'æˆ¿å±‹ä¿é™©æ˜¯å¦æ¶µç›–å†°é›¹ä¸Žå±‹é¡¶æŸå¤±ï¼Ÿ',
        s_home_2:'ä»€ä¹ˆæ˜¯é£Ž/å†°é›¹å…èµ”é¢ï¼ˆ%ï¼‰ï¼Ÿ',
        s_home_3:'é‡Žç«/çƒŸé›¾ä¿éšœåº”é‡ç‚¹æŸ¥çœ‹ä»€ä¹ˆï¼Ÿ',
        s_auto_1:'æ±½è½¦ä¿é™©æ˜¯å¦æ¶µç›–å†°é›¹æŸå¤±ï¼Ÿ',
        s_auto_2:'ç»¼åˆé™© vs ç¢°æ’žé™©åˆ†åˆ«ä¿ä»€ä¹ˆï¼Ÿ',
        s_auto_3:'ä¸é™ä½Žä¿éšœçš„æƒ…å†µä¸‹å¦‚ä½•é™ä¿è´¹ï¼Ÿ'
      },
      fr:{
        doc_title:'Options Colorado â€” Assurance habitation & auto',
        meta_desc:'RÃ©sidents du Colorado : explorez des options flexibles dâ€™assurance habitation et auto pour protÃ©ger votre budget et votre tranquillitÃ©.',
        hero_h1:"Obtenez des options habitation & auto flexibles, adaptÃ©es Ã  votre budget et Ã  ce qui compte.",
        hero_header_home:'Assurance habitation',
        hero_header_auto:'Assurance auto',
        hero_header_business:"Assurance entreprise",
        cta_check:'Voir mes options',
        disclaimer_btn:'Avertissement',
        chat_peek_label:'Besoin dâ€™aide ?',
        chat_peek_name:'Discuter avec PolicyProâ„¢',
        pp_home_title:'Bonjour â€” comment pouvons-nous aider ?',
        pp_home_sub:"Posez une question sur lâ€™assurance habitation/auto au Colorado (info gÃ©nÃ©rale). Un agent agrÃ©Ã© vÃ©rifie avant toute offre ou souscription.",
        pp_start_chat:'DÃ©marrer le chat',
        tab_home:'Accueil',
        tab_messages:'Messages',
        tab_settings:'RÃ©glages',
        settings_title:'RÃ©glages',
        settings_contact:'Contact',
        settings_language:'Langue',
        settings_disclaimer:'Avertissement',
        settings_available:'Disponible',
        settings_open_disclaimer:"Ouvrir lâ€™avertissement lÃ©gal",
        chat_placeholder:'GrÃªle, incendies, franchises, regroupementâ€¦',
        chat_send:'Envoyer',
        suggest_title:'Questions frÃ©quentes',
        suggest_home:'ASSURANCE HABITATION',
        suggest_auto:'ASSURANCE AUTO',
        s_home_1:'La grÃªle et le toit sont-ils couverts ?',
        s_home_2:'Quâ€™est-ce quâ€™une franchise vent/grÃªle (en %)?',
        s_home_3:'Que vÃ©rifier pour la couverture feu/fumÃ©e ?',
        s_auto_1:'La grÃªle est-elle couverte en assurance auto ?',
        s_auto_2:'Que couvre â€œcomprehensiveâ€ vs â€œcollisionâ€ ?',
        s_auto_3:'Comment baisser ma prime sans perdre de garanties ?'
      },
      ru:{
        doc_title:'Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð² ÐšÐ¾Ð»Ð¾Ñ€Ð°Ð´Ð¾ â€” Ð”Ð¾Ð¼ Ð¸ Ð°Ð²Ñ‚Ð¾',
        meta_desc:'Ð–Ð¸Ñ‚ÐµÐ»Ð¸ ÐšÐ¾Ð»Ð¾Ñ€Ð°Ð´Ð¾: Ð³Ð¸Ð±ÐºÐ¸Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð¾Ð¼Ð° Ð¸ Ð°Ð²Ñ‚Ð¾ Ð´Ð»Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð±ÑŽÐ´Ð¶ÐµÑ‚Ð° Ð¸ ÑÐ¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¸Ñ.',
        hero_h1:'Ð“Ð¸Ð±ÐºÐ¸Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð¾Ð¼Ð° Ð¸ Ð°Ð²Ñ‚Ð¾ Ð¿Ð¾Ð´ Ð²Ð°Ñˆ Ð±ÑŽÐ´Ð¶ÐµÑ‚ â€” Ð·Ð°Ñ‰Ð¸Ñ‚Ð¸Ñ‚Ðµ Ð²Ð°Ð¶Ð½Ð¾Ðµ.',
        hero_header_home:'Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð¾Ð¼Ð°',
        hero_header_auto:'Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°Ð²Ñ‚Ð¾',
        hero_header_business:'Ð¡Ñ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð±Ð¸Ð·Ð½ÐµÑÐ°',
        cta_check:'ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹',
        disclaimer_btn:'Ð”Ð¸ÑÐºÐ»ÐµÐ¹Ð¼ÐµÑ€',
        chat_peek_label:'ÐÑƒÐ¶Ð½Ð° Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ?',
        chat_peek_name:'Ð§Ð°Ñ‚ Ñ PolicyProâ„¢',
        pp_home_title:'Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ â€” Ñ‡ÐµÐ¼ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?',
        pp_home_sub:'Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²Ð°Ð½Ð¸ÑŽ Ð´Ð¾Ð¼Ð°/Ð°Ð²Ñ‚Ð¾ Ð² ÐšÐ¾Ð»Ð¾Ñ€Ð°Ð´Ð¾ (Ð¾Ð±Ñ‰Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ). ÐŸÐµÑ€ÐµÐ´ Ð»ÑŽÐ±Ñ‹Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð³ÐµÐ½Ñ‚.',
        pp_start_chat:'ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‡Ð°Ñ‚',
        tab_home:'Ð”Ð¾Ð¼Ð¾Ð¹',
        tab_messages:'Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ',
        tab_settings:'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸',
        settings_title:'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸',
        settings_contact:'ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚',
        settings_language:'Ð¯Ð·Ñ‹Ðº',
        settings_disclaimer:'Ð”Ð¸ÑÐºÐ»ÐµÐ¹Ð¼ÐµÑ€',
        settings_available:'Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾',
        settings_open_disclaimer:'ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð´Ð¸ÑÐºÐ»ÐµÐ¹Ð¼ÐµÑ€',
        chat_placeholder:'Ð“Ñ€Ð°Ð´, Ð¿Ð¾Ð¶Ð°Ñ€Ñ‹, Ñ„Ñ€Ð°Ð½ÑˆÐ¸Ð·Ñ‹, Ð¿Ð°ÐºÐµÑ‚â€¦',
        chat_send:'ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ',
        suggest_title:'ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹',
        suggest_home:'Ð¡Ð¢Ð ÐÐ¥ÐžÐ’ÐÐÐ˜Ð• Ð”ÐžÐœÐ',
        suggest_auto:'Ð¡Ð¢Ð ÐÐ¥ÐžÐ’ÐÐÐ˜Ð• ÐÐ’Ð¢Ðž',
        s_home_1:'ÐŸÐ¾ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð»Ð¸ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²ÐºÐ° Ð´Ð¾Ð¼Ð° Ð³Ñ€Ð°Ð´ Ð¸ ÐºÑ€Ñ‹ÑˆÑƒ?',
        s_home_2:'Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Ñ„Ñ€Ð°Ð½ÑˆÐ¸Ð·Ð° Ð¿Ð¾ Ð²ÐµÑ‚Ñ€Ñƒ/Ð³Ñ€Ð°Ð´Ñƒ (Ð² %)?',
        s_home_3:'Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ð¾ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸ÑŽ Ð¿Ð¾Ð¶Ð°Ñ€Ð°/Ð´Ñ‹Ð¼Ð°?',
        s_auto_1:'ÐŸÐ¾ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð»Ð¸ Ð³Ñ€Ð°Ð´ Ð°Ð²Ñ‚Ð¾ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²ÐºÐ¾Ð¹?',
        s_auto_2:'Ð§ÐµÐ¼ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÐµÑ‚ÑÑ comprehensive Ð¾Ñ‚ collision?',
        s_auto_3:'ÐšÐ°Ðº ÑÐ½Ð¸Ð·Ð¸Ñ‚ÑŒ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ Ð±ÐµÐ· Ð¿Ð¾Ñ‚ÐµÑ€Ð¸ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ?'
      }
    };
  }

  function getStrings_(lang){
    var dict = i18nDict_();
    return dict[lang] || dict.en;
  }

  function heroKeys_(){
    return ['hero_header_home','hero_header_auto','hero_header_business'];
  }

  var __heroIndex = 0;

  function syncHeroHeader_(){
    var el = document.getElementById('heroHeader');
    if(!el) return;

    var reduce = false;
    try{ reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches; }catch(e){ reduce = false; }
    var idx = reduce ? 0 : (__heroIndex % 3);

    var s = getStrings_(getLang_());
    var key = heroKeys_()[idx];
    var txt = s[key] || (idx === 0 ? 'Home Insurance' : (idx === 1 ? 'Car Insurance' : 'Business Insurance'));
    el.textContent = txt;
  }

  function translatePage_(lang){
    var s = getStrings_(lang);

    try{ document.documentElement.lang = lang || 'en'; }catch(e){}
    try{ document.title = s.doc_title; }catch(e){}
    try{
      var m = document.querySelector('meta[name="description"]');
      if(m) m.setAttribute('content', s.meta_desc);
    }catch(e){}

    try{
      var nodes = document.querySelectorAll('[data-i18n]');
      for(var i=0;i<nodes.length;i++){
        var key = nodes[i].getAttribute('data-i18n');
        if(key && s[key]) nodes[i].innerHTML = String(s[key]);
      }
    }catch(e){}

    try{
      var ph = document.querySelectorAll('[data-i18n-placeholder]');
      for(var j=0;j<ph.length;j++){
        var k = ph[j].getAttribute('data-i18n-placeholder');
        if(k && s[k]) ph[j].setAttribute('placeholder', String(s[k]));
      }
    }catch(e){}

    try{ syncHeroHeader_(); }catch(e){}
  }

  function applyLanguage_(lang){
    lang = (lang || 'en');
    setLang_(lang);
    if(ppLangSelect) ppLangSelect.value = lang;
    translatePage_(lang);
  }

  (function(){
    var lang = getLang_();
    if(ppLangSelect){
      ppLangSelect.value = lang;
      ppLangSelect.addEventListener('change', function(){
        applyLanguage_(ppLangSelect.value);
      });
    }
    applyLanguage_(lang);
  })();

  // =========================
  // Hero rotation (every 3s)
  // =========================
  function heroEls_(){
    return [
      document.getElementById('heroImg0'),
      document.getElementById('heroImg1'),
      document.getElementById('heroImg2')
    ];
  }

  function setActiveHero_(idx){
    var els = heroEls_();
    for(var i=0;i<els.length;i++){
      if(els[i]) els[i].classList.toggle('active', i === idx);
    }
  }

  // PNG-only sources
  var HERO_SRCS = ['hero-house.png','hero-auto.png','hero-business.png'];

  function setHeroImgs_(srcs){
    var ids = ['heroImg0','heroImg1','heroImg2'];
    for(var i=0;i<ids.length;i++){
      var el = document.getElementById(ids[i]);
      if(el) el.src = srcs[i] || '';
    }

    // Per-slide focal points (helps desktop crop look intentional)
    try{
      var h0 = document.getElementById('heroImg0');
      var h1 = document.getElementById('heroImg1');
      var h2 = document.getElementById('heroImg2');
      if(h0) h0.style.objectPosition = '50% 40%';       // house
      if(h1) h1.style.objectPosition = '50% 55%';       // auto
      if(h2) h2.style.objectPosition = '50% 35%';       // business
    }catch(e){}

    // Update widget header image to match first hero (home)
    try{
      var top = document.querySelector('.pp-top');
      if(top && srcs[0]){
        top.style.background =
          "linear-gradient(180deg, rgba(2,6,23,0) 40%, rgba(2,6,23,.45) 100%), url('" + srcs[0] + "') center/cover no-repeat";
      }
    }catch(e){}
  }

  (function(){
    __heroIndex = 0;
    setActiveHero_(0);
    syncHeroHeader_();

    setHeroImgs_(HERO_SRCS);

    setInterval(function(){
      var reduce = false;
      try{ reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches; }catch(e){ reduce = false; }
      if(reduce) return;

      __heroIndex = (__heroIndex + 1) % 3;
      setActiveHero_(__heroIndex);
      syncHeroHeader_();
    }, 3000);
  })();

  function isEmail_(email){
    email = String(email||'').trim();
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function esc_(s){
    s = String(s == null ? '' : s);
    return s.replace(/[&<>"']/g, function(c){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c] || c;
    });
  }

  function addMsg_(role, html){
    if(!chatMessages) return;
    var wrap = document.createElement('div');
    wrap.className = 'msg ' + (role === 'user' ? 'user' : 'bot');

    var b = document.createElement('div');
    b.className = 'bubble ' + (role === 'user' ? 'user' : 'bot');
    b.innerHTML = html;

    wrap.appendChild(b);
    chatMessages.appendChild(wrap);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    saveChatState_();
  }

  function addTyping_(){
    addMsg_('bot', '<span class="typing" aria-label="PolicyPro is typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>');
  }

  function replaceLastBot_(html){
    if(!chatMessages) return;
    var items = chatMessages.querySelectorAll('.msg.bot .bubble');
    if(!items || !items.length) return;
    items[items.length-1].innerHTML = html;
    chatMessages.scrollTop = chatMessages.scrollHeight;

    saveChatState_();
  }

  function seedChat_(){
    renderSuggestedQuestions_();
  }

  function renderSuggestedQuestions_(){
    if(!chatMessages) return;

    if(chatMessages.childElementCount) return;
    if(chatHistory && chatHistory.length) return;

    var wrap = document.createElement('div');
    wrap.className = 'pp-suggest-wrap';

    var title = document.createElement('p');
    title.className = 'pp-suggest-title';
    title.textContent = getStrings_(getLang_()).suggest_title;

    var lang = getLang_();
    var s = getStrings_(lang);

    var suggestionsHome = [s.s_home_1, s.s_home_2, s.s_home_3];
    var suggestionsAuto = [s.s_auto_1, s.s_auto_2, s.s_auto_3];

    function section_(label, items){
      var sec = document.createElement('div');
      sec.className = 'pp-suggest-section';

      var l = document.createElement('div');
      l.className = 'pp-suggest-label';
      l.textContent = label;

      var grid = document.createElement('div');
      grid.className = 'pp-suggest-grid';

      items.forEach(function(text){
        var b = document.createElement('button');
        b.type = 'button';
        b.className = 'pp-suggest-chip';
        b.textContent = text;
        b.addEventListener('click', function(){
          try{ wrap.remove(); }catch(e){}
          sendChat_(text);
        });
        grid.appendChild(b);
      });

      sec.appendChild(l);
      sec.appendChild(grid);
      return sec;
    }

    wrap.appendChild(title);
    var s2 = getStrings_(getLang_());
    wrap.appendChild(section_(s2.suggest_home, suggestionsHome));
    wrap.appendChild(section_(s2.suggest_auto, suggestionsAuto));

    chatMessages.appendChild(wrap);
  }

  function openChat_(){
    if(chatWindow) chatWindow.style.display = 'block';
    if(chatBtn) chatBtn.style.display = 'none';
    setTab_('home');
  }

  function closeChat_(){
    if(chatWindow) chatWindow.style.display = 'none';
    if(chatBtn) chatBtn.style.display = 'flex';
  }

  if(chatBtn) chatBtn.addEventListener('click', openChat_);
  if(closeChat) closeChat.addEventListener('click', closeChat_);

  if(ppTabHome) ppTabHome.addEventListener('click', function(){ setTab_('home'); });
  if(ppTabMessages) ppTabMessages.addEventListener('click', function(){ setTab_('messages'); });
  if(ppTabSettings) ppTabSettings.addEventListener('click', function(){ setTab_('settings'); });

  if(ppStartChat) ppStartChat.addEventListener('click', function(){
    setTab_('messages');
    setTimeout(function(){ renderSuggestedQuestions_(); }, 0);
  });

  // ===== Disclaimer modal (manual only; no auto popups) =====
  var openDisclaimer = document.getElementById('openDisclaimer');
  var discOverlay = document.getElementById('discOverlay');
  var discModal = document.getElementById('discModal');
  var discClose = document.getElementById('discClose');
  var discClose2 = document.getElementById('discClose2');
  var discAccept = document.getElementById('discAccept');

  function showDisclaimer(){
    if(discOverlay) discOverlay.style.display = 'block';
    if(discModal) discModal.style.display = 'flex';
  }
  function hideDisclaimer(){
    if(discOverlay) discOverlay.style.display = 'none';
    if(discModal) discModal.style.display = 'none';
  }
  function acceptDisclaimer_(){
    try{ sessionStorage.setItem('sc_disclaimer_accepted_session','1'); }catch(e){}
    hideDisclaimer();
  }

  if(openDisclaimer) openDisclaimer.addEventListener('click', showDisclaimer);
  if(discOverlay) discOverlay.addEventListener('click', hideDisclaimer);
  if(discClose) discClose.addEventListener('click', hideDisclaimer);
  if(discClose2) discClose2.addEventListener('click', hideDisclaimer);
  if(discAccept) discAccept.addEventListener('click', acceptDisclaimer_);

  // ===== Policy Health Check scoring (first-principles) =====
  function collectCheckedValues_(containerId){
    var out = [];
    try{
      var c = document.getElementById(containerId);
      if(!c) return out;
      var boxes = c.querySelectorAll('input[type="checkbox"]');
      for(var i=0;i<boxes.length;i++){
        if(boxes[i].checked) out.push(String(boxes[i].value || '').trim());
      }
    }catch(e){}
    if(out.indexOf('None') >= 0) return ['None'];
    return out;
  }

  function policyHealthScore_(answers){
    answers = answers || {};
    var triggers = [];
    var score = 100;

    function has_(arr, v){ return Array.isArray(arr) && arr.indexOf(v) >= 0; }

    var changes = answers.changes || [];
    var risks = answers.risks || [];
    var property = String(answers.property || '');
    var deductible = String(answers.deductible || '');
    var liability = String(answers.liability || '');
    var review = String(answers.review || '');

    var unsureCount = 0;
    if(property === 'Not sure') unsureCount++;
    if(deductible === 'Not sure') unsureCount++;
    if(review === 'Not sure') unsureCount++;
    if(liability === 'Not protected / Not sure') unsureCount++;
    if(has_(changes,'None') === false && changes.length === 0) unsureCount++;
    if(has_(risks,'Not sure')) unsureCount++;

    if(unsureCount >= 2){
      score -= 18;
      triggers.push('Multiple unknowns');
    }

    var majorChange = false;
    var majorSet = ['Moved/bought home','New driver/teen driver','New vehicle/financed/leased','Marriage/divorce/new baby','Work from home/home business','Major remodel/new roof/solar'];
    for(var i=0;i<majorSet.length;i++){
      if(has_(changes, majorSet[i])){ majorChange = true; break; }
    }
    if(majorChange){
      score -= 14;
      triggers.push('Recent life change');
    }

    if(review === '1â€“3 years ago') score -= 8;
    if(review === '3+ years ago / never'){ score -= 18; triggers.push('No recent policy review'); }
    if(review === 'Not sure'){ score -= 10; triggers.push('Review date unknown'); }

    if(liability === 'Somewhat protected'){ score -= 8; triggers.push('Liability may be low'); }
    if(liability === 'Not protected / Not sure'){ score -= 18; triggers.push('Liability likely insufficient'); }

    if(deductible === '$500â€“$1,000'){ score -= 6; }
    if(deductible === 'Not sure'){ score -= 10; triggers.push('Deductible unknown'); }

    if(has_(risks,'Wildfire/brush nearby')){ score -= 6; triggers.push('Wildfire exposure'); }
    if(has_(risks,'Hail-prone / roof 10+ yrs')){ score -= 6; triggers.push('Hail/roof exposure'); }
    if(has_(risks,'Basement/sump pump')){ score -= 4; triggers.push('Water backup risk'); }
    if(has_(risks,'Pool/trampoline/dog')){ score -= 4; triggers.push('Higher liability exposure'); }

    if(score < 0) score = 0;
    if(score > 100) score = 100;

    var label = 'Green';
    if(score < 55) label = 'Red';
    else if(score < 80) label = 'Yellow';

    if((majorChange && (review === '3+ years ago / never' || review === 'Not sure')) || unsureCount >= 3){
      if(triggers.indexOf('High mismatch risk') < 0) triggers.push('High mismatch risk');
      label = 'Red';
    }

    return { score0to100: score, label: label, triggers: triggers };
  }

  function leadPriorityScore_(payloadLead, health){
    var score = 0;

    var tf = String(payloadLead.timeframe || '');
    if(tf === 'ASAP') score += 35;
    else if(tf === 'Within 7 days') score += 28;
    else if(tf === 'Within 30 days') score += 18;
    else if(tf === 'Just exploring') score += 8;

    if(payloadLead.zip) score += 6;
    if(payloadLead.phone) score += 6;
    if(payloadLead.email) score += 6;

    if(health && health.label === 'Red') score += 30;
    else if(health && health.label === 'Yellow') score += 18;
    else score += 10;

    try{
      if(health && Array.isArray(health.triggers) && health.triggers.indexOf('Recent life change') >= 0) score += 6;
    }catch(e){}

    if(score > 100) score = 100;

    var label = 'COOL';
    if(score >= 70) label = 'HOT';
    else if(score >= 45) label = 'WARM';

    return { score: score, label: label };
  }

  // ===== Lead form submit =====
  if(leadForm){
    leadForm.addEventListener('submit', function(e){
      e.preventDefault();
      if(formStatus){
        formStatus.style.display='block';
        formStatus.className='status';
      }

      if(!GAS || GAS.indexOf('http') !== 0){
        if(formStatus){
          formStatus.className='status err';
          formStatus.textContent='Backend not connected yet. Paste your Apps Script Web App URL into window.GAS_WEBAPP_URL at the top of this file.';
        }
        return;
      }

      var payloadLead = {
        action: 'lead',
        source: 'GitHub Landing Page',
        channel: 'CTA Funnel',
        timestamp: new Date().toISOString(),
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        homeowner: document.getElementById('homeowner').value,
        roofAge: document.getElementById('roofAge').value,
        vehicles: document.getElementById('vehicles').value,
        timeframe: document.getElementById('timeframe').value,
        notes: document.getElementById('notes').value.trim(),
        consent: true,
        aiConsent: true,
        deliverKit: true,
        kitType: 'FIRE_HAIL_ENDORSEMENTS'
      };

      // Collect Policy Health Check answers
      var phc = {
        changes: collectCheckedValues_('phcChanges'),
        property: (document.getElementById('phcProperty') ? document.getElementById('phcProperty').value : ''),
        deductible: (document.getElementById('phcDeductible') ? document.getElementById('phcDeductible').value : ''),
        liability: (document.getElementById('phcLiability') ? document.getElementById('phcLiability').value : ''),
        review: (document.getElementById('phcReview') ? document.getElementById('phcReview').value : ''),
        risks: collectCheckedValues_('phcRisks')
      };

      var health = policyHealthScore_(phc);
      payloadLead.policyHealthScore = health.score0to100;
      payloadLead.policyHealthLabel = health.label;
      payloadLead.policyHealthTriggers = (health.triggers || []).join(' | ');
      payloadLead.policyHealthAnswers = phc;

      var priority = leadPriorityScore_(payloadLead, health);
      payloadLead.leadScore = priority.score;
      payloadLead.leadLabel = priority.label;

      if(formStatus) formStatus.textContent='Submittingâ€¦';

      postToGAS(GAS, payloadLead).then(function(){
        if(formStatus){
          formStatus.className='status ok';
          formStatus.textContent='âœ… Submitted! Check your email for your coverage guide.';
        }
        leadForm.reset();
        setTimeout(hideModal, 900);
      }).catch(function(err){
        if(formStatus){
          formStatus.className='status err';
          formStatus.textContent='âš  Could not submit (network error). Double-check the Apps Script URL and that it is deployed as a Web App. (' + (err && err.message ? err.message : 'Error') + ')';
        }
      });
    });
  }
</script>

</body>
</html>
